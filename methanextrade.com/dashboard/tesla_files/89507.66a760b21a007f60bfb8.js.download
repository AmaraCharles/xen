"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[89507],{870045:(e,t,s)=>{var r=s(414879),i=s(297525).tzData;let n;function a(e){this._name=e;var t=i[e];if(t||(t={time:[],offset:[]},this._invalid=!0),t.time.length!==t.offset.length&&(t={time:[],offset:[]},this._invalid=!0),!t.time_utc){for(var s=t.time,r=t.offset,n=s.length,a=new Array(n),o=0;o<n;o++)s[o]*=1e3,r[o]*=1e3,a[o]=s[o]-r[o];t.time_utc=a}this.tz=t}function o(e,t){var s=e.length;if(0===s)return-1;if(isNaN(t))throw Error("Key is NaN");for(var r=0,i=s-1,n=_((r+i)/2);;){if(e[n]>t){if((i=n-1)<r)return n}else if(i<(r=n+1))return n<s-1?n+1:-1;n=_((r+i)/2)}}a.prototype.offset_utc=function(e){return a._offset(this.tz.time_utc,this.tz.offset,e)},a.prototype.offset_loc=function(e){return a._offset(this.tz.time,this.tz.offset,e)},a.prototype.name=function(){return this._name},a.prototype.correction_loc=function(e){var t=this.tz.time,s=this.tz.offset,r=o(t,e);if(r<1)return 0;var i=s[r]-s[r-1];if(i>0&&e-t[r-1]<=i)return i;return 0},a.prototype.is_valid=function(){return!this._invalid},a._offset=function(e,t,s){var r=o(e,s);return-1===r?0:t[r]};var _=function(e){return 0|e},d=function(e){return 60*e*1e3},u=function(e,t){return c(e)-c(t)},c=function(e){return e<0?_(e/1e3)-(e%1e3!=0?1:0):_(e/1e3)};function f(e){return e%4==0&&(e%100!=0||e%400==0)}var h={0:0,1:31,2:59,3:90,4:120,5:151,6:181,7:212,8:243,9:273,10:304,11:334},l={...r.WeekDays,...r.Months,YEAR:1,MONTH:2,WEEK_OF_YEAR:3,DAY_OF_MONTH:5,DAY_OF_YEAR:6,DAY_OF_WEEK:7,HOUR_OF_DAY:11,MINUTE:12,SECOND:13,FIRST_DAY_OF_WEEK:r.WeekDays.SUNDAY,LAST_DAY_OF_WEEK:r.WeekDays.SATURDAY,minutesPerDay:1440,minutesPerWeek:10080,millisecondsPerDay:d(1440),get_minutes_from_hhmm:function(e){return-1!==e.indexOf(":")&&(e=e.split(":").join("")),e%100+60*_(e/100)},get_year:function(e){return e.getUTCFullYear()},get_month:function(e){return e.getUTCMonth()},get_hours:function(e){return e.getUTCHours()},get_minutes:function(e){return e.getUTCMinutes()},get_seconds:function(e){return e.getUTCSeconds()},get_day_of_month:function(e){return e.getUTCDate()},get_day_of_week:function(e){return e.getUTCDay()+1},get_day_of_year:function(e){var t=e.getUTCMonth(),s=h[t];return t>l.JANUARY+1&&f(e.getUTCFullYear())&&(s+=1),s+e.getUTCDate()},get_week_of_year:function(e){var t=new Date(Date.UTC(e.getUTCFullYear(),0,1)).getUTCDay(),s=0===t?1:8-t,r=l.get_day_of_year(e)-s;return Math.ceil(r/7)+1},get_minutes_from_midnight:function(e){return 60*l.get_hours(e)+l.get_minutes(e)},get_minutes_with_hours:e=>l.get_minutes_from_midnight(e),set_hms:function(e,t,s,r,i,n){e.setUTCHours(t),e.setUTCMinutes(s),e.setUTCSeconds(r),e.setUTCMilliseconds(i),void 0!==n&&l.correct_time(e,n)},correct_time:function(e,t){var s=e.getTime(),r=t.correction_loc(s);e.setTime(s+r)},add_days_considering_dst:function(e,t,s){var r=e.offset_utc(t),i=this.clone(t);this.add_date(i,s);var n=e.offset_utc(i);return i.setTime(i.getTime()+r-n),i},add_years_considering_dst:function(e,t,s){let r=t
;for(let t=Math.abs(s);t>0;t--)r=this.add_days_considering_dst(e,r,this.get_days_per_year(r)*Math.sign(s));return r},add_date:function(e,t){e.setTime(e.getTime()+t*l.millisecondsPerDay)},add_minutes:function(e,t){e.setTime(e.getTime()+d(t))},set_seconds:function(e,t){const s=86400,r=t%s<0?-1:0,i=Math.trunc(t/s)+r,n=t-i*s,a=Math.trunc(n/3600),o=Math.trunc(n%3600/60),_=n-3600*a-60*o;l.set_hms(e,a,o,_,0),l.add_date(e,i)},clone:function(e){return new Date(e.getTime())},get_days_per_year:function(e){var t=e.getUTCFullYear();return this.days_per_year(t)},days_per_year:function(e){return f(e)?366:365},is_leap_year:f,get_days_in_month:function(e,t){let s;switch(e){case 0:case 2:case 4:case 6:case 7:case 9:case 11:s=31;break;case 1:s=28,f(t)&&s++;break;default:s=30}return s},get_part:function(e,t){switch(t){case l.YEAR:return l.get_year(e);case l.MONTH:return l.get_month(e);case l.DAY_OF_MONTH:return l.get_day_of_month(e);case l.WEEK_OF_YEAR:return l.get_week_of_year(e);case l.DAY_OF_WEEK:return l.get_day_of_week(e);case l.HOUR_OF_DAY:return l.get_hours(e);case l.MINUTE:return l.get_minutes(e);case l.DAY_OF_YEAR:return l.get_day_of_year(e);case l.SECOND:return l.get_seconds(e);default:return e.getTime()}},time_minutes:d,time_seconds:function(e){return 1e3*e},time_minutes_diff:function(e,t){return _(u(e,t)/60)},time_seconds_diff:u,utc_to_cal:function(e,t){return new Date(l.utc_to_cal_ts(e,t))},utc_to_cal_ts:function(e,t){return t+e.offset_utc(t)},get_cal:function(e,t,s,r,i,n,a){var o=new Date(Date.UTC(t,s,r,i||0,n||0,a||0)),_=e.offset_utc(+o);return new Date(o.valueOf()-_)},get_cal_from_unix_timestamp_ms:function(e,t){return new Date(t+e.offset_utc(t))},get_cal_utc:function(e,t,s,r=0,i=0,n=0){return new Date(Date.UTC(e,t,s,r,i,n))},cal_to_utc:function(e,t,s){var r=t.getTime();return s&&(r+=e.correction_loc(r)),r-e.offset_loc(r)},get_timezone:function(e){return new a(e)},shift_day:function(e,t){var s=e-1;return(s+=t)>6?s%=7:s<0&&(s=(7+s%7)%7),s+1},setCustomTimezones:function(e){n=e}};e.exports=l},477472:(e,t,s)=>{s.d(t,{BarBuilderBase:()=>o,SessionInfo:()=>a});var r=s(870045),i=s(316767),n=s(328296);class a{constructor(e,t,s,r){this.init(e,t,s,r),this._state={timezone:e,spec:t,holidays:s,corrections:r}}init(e,t,s,i){this.timezone=r.get_timezone(e),this.spec=new n.SessionsSpec(e,t,s,i)}state(){return this._state}static fromState(e){return new a(e.timezone,e.spec,e.holidays,e.corrections)}static wrap(e){const t=new a("Etc/UTC","24x7");return t.spec=e,t}static create(e,t,s,r){return new a(e,t,s,r)}}class o{alignTime(e){if(isNaN(e))return NaN;let t=this.indexOfBar(e);return t===i.SessionStage.POST_SESSION&&(this.moveTo(e),t=this.indexOfBar(e)),t<0?NaN:this.startOfBar(t)}}},323486:(e,t,s)=>{s.d(t,{BusinessDay:()=>n});var r=s(870045),i=s(836808);class n{constructor(e,t,s){this.year=e,this.month=t,this.day=s}toString(){return`${(0,i.addLeadingZeros)(this.year,4)}-${(0,i.addLeadingZero)(this.month)}-${(0,i.addLeadingZero)(this.day)}`}toyyyymmdd(){return`${(0,i.addLeadingZeros)(this.year,4)}${(0,i.addLeadingZero)(this.month)}${(0,
i.addLeadingZero)(this.day)}`}compareTo(e){return this.year>e.year||this.year===e.year&&this.month>e.month||this.year===e.year&&this.month===e.month&&this.day>e.day?1:this.year===e.year&&this.month===e.month&&this.day===e.day?0:-1}before(e){return-1===this.compareTo(e)}toCalendar(e){return r.get_cal(null!=e?e:r.get_timezone("Etc/UTC"),this.year,this.month-1,this.day)}addDays(e){const t=this.toCalendar(r.get_timezone("Etc/UTC"));return r.add_date(t,e),n.fromCalendar(t)}firstDayOfYear(){return new n(this.year,1,1)}getDayOfWeek(){const e=this.toCalendar();return r.get_day_of_week(e)}static fromCalendar(e){return new n(r.get_year(e),r.get_month(e)+1,r.get_day_of_month(e))}}},316767:(e,t,s)=>{var r;s.d(t,{SessionStage:()=>r}),function(e){e[e.PRE_SESSION=-1]="PRE_SESSION",e[e.POST_SESSION=-2]="POST_SESSION",e[e.LASTBAR_SESSION=-3]="LASTBAR_SESSION",e[e.LAST_SESSION_END=-4]="LAST_SESSION_END",e[e.FIRST_SESSION_START=-5]="FIRST_SESSION_START"}(r||(r={}))},119159:(e,t,s)=>{s.d(t,{IntradayBarBuilder:()=>o});var r=s(870045),i=s(750139),n=s(477472),a=s(316767);class o extends n.BarBuilderBase{constructor(e,t){super(),this._sessionStartMs=-Number.MAX_VALUE,this._sessionEndMs=-Number.MAX_VALUE,this._periodSec=e,this._session=t}alignTimeIfPossible(e){const t=this.alignTime(e);return isNaN(t)?e:t}indexOfBar(e){return e<this._sessionStartMs?a.SessionStage.PRE_SESSION:e>=this._sessionEndMs?a.SessionStage.POST_SESSION:(0,i.toInt)(r.time_seconds_diff(e,this._sessionStartMs)/this._periodSec)}startOfBar(e){if(e===a.SessionStage.PRE_SESSION){const e=r.get_cal_from_unix_timestamp_ms(this._session.timezone,this._sessionStartMs-1),t=this._session.spec.alignToNearestSessionEnd(e,-1);return r.cal_to_utc(this._session.timezone,t)}if(e===a.SessionStage.POST_SESSION)return this._sessionEndMs;if(e<0)throw new Error("Negative offset is not supported");return this._sessionStartMs+r.time_seconds(this._periodSec*e)}endOfBar(e){if(e<0)throw new Error("Index cannot be negative");const t=this.startOfBar(e)+1e3*this._periodSec;return t>this._sessionEndMs?this._sessionEndMs:t}isLastBar(e,t){return t>=this._sessionStartMs+r.time_seconds(this._periodSec*(e+1)-1)}moveTo(e){const t=this._session.timezone,s=r.utc_to_cal(t,e),i=this._session.spec.alignToSessionStart(s);this._sessionStartMs=r.cal_to_utc(t,s),r.add_minutes(s,i),this._sessionEndMs=r.cal_to_utc(t,s)}indexOfLastBarInSession(){return(0,i.toInt)((this._sessionEndMs-1-this._sessionStartMs)/1e3/this._periodSec)}moveNext(){this.moveTo(this._sessionEndMs)}}},409994:(e,t,s)=>{s.d(t,{DailyBuilder:()=>m,MonthlyBuilder:()=>T,MultidayBarBuilder:()=>f,WeeklyBuilder:()=>E});var r=s(650151),i=s(870045),n=s(750139),a=s(323486),o=s(316767),_=s(477472);const d=i.get_timezone("Etc/UTC");function u(e,t,s){const r=i.clone(t),n=e.businessDaysToCalendarDays(r,1);n>1&&i.add_date(r,n-1);const a=e.leftBorderOfDailyBar(r);if(null===a)throw new Error("Cannot calculate left border of daily bar");return i.cal_to_utc(s,a,!0)}class c{constructor(e,t){this.from=e,this.to=t}toString(){
return`${this.from.toString()} - ${this.to.toString()}`}}class f extends _.BarBuilderBase{constructor(e,t,s,i,n=!1){super(),this._periodStart=-Number.MAX_VALUE,this._periodEnd=-Number.MAX_VALUE,this._periodLastBarStart=-Number.MAX_VALUE,this._periodStartDay=new a.BusinessDay(0,0,0),this._periodEndDay=new a.BusinessDay(0,0,0),this._period=s,this._sessionTgt=e,this._builder=i,this._useBusinessDays=n,n?((0,r.assert)(null===t,"useBusinessDays and sessionSrc are mutually exclusive arguments"),this._sessionSrc=new _.SessionInfo("Etc/UTC","24x7")):this._sessionSrc=t||e}builder(){return this._builder}alignTimeIfPossible(e){return this.tradingDayToSessionStart(e)}tradingDayToSessionStart(e){return this.moveTo(e),this.startOfBar(0)}indexOfBar(e){if(this._useBusinessDays){const t=a.BusinessDay.fromCalendar(i.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e));return t.before(this._periodStartDay)?o.SessionStage.PRE_SESSION:this._periodEndDay.before(t)?o.SessionStage.POST_SESSION:0}return e<this._periodStart?o.SessionStage.PRE_SESSION:e>=this._periodEnd?o.SessionStage.POST_SESSION:0}startOfBar(e){if(e===o.SessionStage.PRE_SESSION){const e=i.get_cal_from_unix_timestamp_ms(this._sessionTgt.timezone,this._periodStart-1),t=this._sessionTgt.spec.alignToNearestSessionEnd(e,-1);return i.cal_to_utc(this._sessionTgt.timezone,t)-1}return e===o.SessionStage.POST_SESSION||e>0?this._periodEnd:e===o.SessionStage.LASTBAR_SESSION?this._periodLastBarStart:this._periodStart}moveTo(e){let t=i.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e);t=this._sessionSrc.spec.correctTradingDay(t);const s=i.get_year(t),r=this._indexOfPeriodInYear(t),n=r+this._period,o=this._sessionTgt.spec,_=this._sessionTgt.timezone,d=this._builder.startOfPeriod(r,s);this._periodStart=u(o,d,_);const c=o.businessDaysToCalendarDays(d,1);c>1&&i.add_date(d,c-1),this._periodStartDay=a.BusinessDay.fromCalendar(d);let f=this._builder.startOfPeriod(n,s);this._periodEnd=u(o,f,_);const h=i.clone(f);for(i.add_date(h,-1);o.isCalWeekEnd(h);)i.add_date(h,-1);this._periodEndDay=a.BusinessDay.fromCalendar(h),i.add_date(f,-1),f=function(e,t){const s=i.clone(t);for(;e.isCalWeekEnd(s);)i.add_date(s,-1);return s}(this._sessionTgt.spec,f),this._periodLastBarStart=u(o,f,_),(this._periodLastBarStart<this._periodStart||this._periodLastBarStart===this._periodEnd)&&(this._periodLastBarStart=this._periodStart)}endOfBar(e){return e===o.SessionStage.LAST_SESSION_END?this._getZonedDateTimeOfBorder(o.SessionStage.LAST_SESSION_END).getTime()+1e3:((0,r.assert)(0===e),this._periodEnd)}isLastBar(e,t){if(0!==e)throw new Error("index should be 0");return t>=this._periodLastBarStart}moveBarsForward(e,t){(0,r.assert)(t>0);const s=i.get_cal_from_unix_timestamp_ms(this._sessionTgt.timezone,e);let n=this._sessionTgt.spec.correctTradingDay(s);for(let e=0;e<t;e++){const e=this._period+this._builder.indexOfPeriod(n);n=this._builder.startOfPeriod(e,i.get_year(n)),n=this._sessionTgt.spec.correctTradingDay(n)}return this.moveTo(i.cal_to_utc(this._sessionTgt.timezone,n)),this.startOfBar(0)}
currentRange(){return new c(this._periodStartDay,this._periodEndDay)}indexOfBarInYear(e){const t=i.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e),s=i.get_year(t),r=this._builder.indexOfPeriod(t),a=this._sessionTgt.timezone;let o=this._builder.startOfPeriod(r,s),_=u(this._sessionTgt.spec,o,a);return o=i.get_cal_from_unix_timestamp_ms(d,_),s<i.get_year(o)?(o=this._builder.startOfPeriod(r-1,s),_=u(this._sessionTgt.spec,o,a),{index:(r-1)/this._period,time:_}):{index:(0,n.toInt)(r/this._period),time:_}}sessionSrc(){return this._sessionSrc}sessionTgt(){return this._sessionTgt}static days(e,t,s){return new f(t,s,e,new m(t),!1)}static weeks(e,t,s){return new f(t,s,e,new E(t),!1)}static months(e,t,s){return new f(t,s,e,new T(t),!1)}static daysFromBusinessDays(e,t){return new f(t,null,e,new m(t),!0)}static weeksFromBusinessDays(e,t){return new f(t,null,e,new E(t),!0)}static monthsFromBusinessDays(e,t){return new f(t,null,e,new T(t),!0)}_getZonedDateTimeOfBorder(e){(0,r.assert)(e===o.SessionStage.FIRST_SESSION_START||e===o.SessionStage.LAST_SESSION_END);const t=this._sessionTgt.spec.timezoneObj();if(e===o.SessionStage.FIRST_SESSION_START){const e=this.currentRange().from.toCalendar(t);return(0,r.ensureNotNull)(this._sessionTgt.spec.bordersOfDailyBar(e)).from}{const e=this.currentRange().to.toCalendar(t);return(0,r.ensureNotNull)(this._sessionTgt.spec.bordersOfDailyBar(e)).to}}_indexOfPeriodInYear(e){const t=this._builder.indexOfPeriod(e);let s=(0,n.toInt)(t/this._period)*this._period;return-1===t&&(s=-this._period),s}}function h(e,t){const s=e.getWeekIndex(t),r=i.get_day_of_week(t)-e.getEntriesForWeek(s).firstDayOfWeek();return r<0?r+7:r}function l(e,t){const s=i.get_day_of_year(t)-1;let r=h(e,t)-s%7;return 0===r?(0,n.toInt)(s/7):(r>=0&&(r-=7),(0,n.toInt)((r+s)/7))}class S{indexOfPeriod(e){return i.get_day_of_year(e)-1}startOfPeriod(e,t){const s=i.days_per_year(t);return i.get_cal(d,t,i.JANUARY,1+Math.min(e,s))}}class g extends S{constructor(e){super(),this._sessionsSpec=e}indexOfPeriod(e){return super.indexOfPeriod(e)-function(e,t){const s=l(e,t),r=i.get_cal(d,i.get_year(t),i.JANUARY,1);i.add_date(r,7*s);const n=s*e.weekEndsCountForSingleSession()+e.holidaysFromYearStart(r),a=i.get_day_of_year(t)-i.get_day_of_year(r);return n+a-e.calendarDaysToBusinessDays(r,a)}(this._sessionsSpec,e)}startOfPeriod(e,t){const s=7-this._sessionsSpec.weekEndsCountForSingleSession(),r=Math.max(0,Math.trunc(e/s)-1),n=i.get_cal(d,t,i.JANUARY,1),a=i.days_per_year(t);if(i.add_date(n,7*r),(e-=s*r-this._sessionsSpec.holidaysFromYearStart(n))>0){const t=this._sessionsSpec.businessDaysToCalendarDays(n,e);i.add_date(n,t)}let o=i.get_day_of_year(n)-1;return t<i.get_year(n)&&(o+=a),super.startOfPeriod(o,t)}}class y extends S{constructor(e){super(),this._sessionsSpec=e}indexOfPeriod(e){return super.indexOfPeriod(e)-this._sessionsSpec.daysOffFromYearStart(e)}startOfPeriod(e,t){const s=i.get_cal(d,t,i.JANUARY,1);i.add_date(s,e);const r=this._sessionsSpec.daysOffFromYearStart(s);i.add_date(s,r);const n=this._sessionsSpec.daysOffFromYearStart(s)-r
;if(n>0){const e=this._sessionsSpec.businessDaysToCalendarDays(s,n);i.add_date(s,e)}let a=i.get_day_of_year(s)-1;if(t<i.get_year(s)){a+=i.days_per_year(t)}return super.startOfPeriod(a,t)}}class m{constructor(e){this._builder=null,this._initialized=!1,this._session=e}indexOfPeriod(e){return this._getBuilder().indexOfPeriod(e)}startOfPeriod(e,t){return this._getBuilder().startOfPeriod(e,t)}_getBuilder(){return null!==this._builder&&this._initialized||(this._session.spec.hasWeekEnds()?this._builder=this._session.spec.hasHistoryCorrections()?new y(this._session.spec):new g(this._session.spec):this._builder=this._session.spec.hasHistoryCorrections()?new y(this._session.spec):new S),this._builder}}class O{constructor(e){this._spec=e}indexOfPeriod(e){let t=l(this._spec,e);return 0===t&&e.getTime()<this.startOfPeriod(0,i.get_year(e)).getTime()&&(t=-1),t}startOfPeriod(e,t){if(e<0){t--;const s=i.get_cal(d,t,i.DECEMBER,31,23,59,59),r=this.indexOfPeriod(s),n=-1*e,a=Math.trunc(r/n)*n;return this.startOfPeriod(a,t)}const s=i.get_cal(d,t,i.JANUARY,1),r=h(this._spec,s),n=0===r?7*e:7*(e+1)-r;return n>i.days_per_year(i.get_year(s))?this.startOfPeriod(0,t+1):(i.add_date(s,n),s)}}class p{constructor(e){this._yearStartDataHash=new Map,this._spec=e}startOfPeriod(e,t){if(e<0){t--;const s=i.get_cal(d,t,i.DECEMBER,31,23,59,59),r=this.indexOfPeriod(s),n=-1*e,a=Math.trunc(r/n)*n;return this.startOfPeriod(a,t)}const s=this._spec.getWeekIndicesWithAdditionalWeekBars(t),n=this._getStartOfYearData(t,s),a=this._moveToWeekIndexAccountingAdditional(n.firstWeekIndex,s,e),o=7*(a-n.firstWeekIndex);let _=i.clone((0,r.ensureNotNull)(n.startOfFirstBarInYear));if(i.add_date(_,o),i.get_year(_)>t){const e=t+1,s=this._spec.getWeekIndicesWithAdditionalWeekBars(e),i=this._getStartOfYearData(e,s);if(_.getTime()>=(0,r.ensureNotNull)(i.startOfFirstBarInYear).getTime())return this.startOfPeriod(0,e)}return _=this._calculateBarWeekStart(_,s,a,e),_}indexOfPeriod(e){const t=this._spec.getWeekIndex(e),s=this._spec.getWeekIndicesWithAdditionalWeekBars(i.get_year(e)),n=this._getStartOfYearData(i.get_year(e),s);if(e.getTime()<(0,r.ensureNotNull)(n.startOfFirstBarInYear).getTime())return-1;if(0===t&&p.isOnFirstCalendarWeekOfYear(e)||0!==t&&t===n.firstWeekIndex)return this._calculateLastWeek(e,t,s,n.firstWeekbarsCount)-1;let a=this._numberOfCalendarWeeks(e);return a+=n.firstWeekbarsCount-n.fullWeeksAdjustment,a+=this._calculateWeeksWithExtraBar(t,s,n.firstWeekIndex),a+=this._calculateLastWeek(e,t,s,p.fullWeekOfAdditionalBarsCount)-1,a}static isOnFirstCalendarWeekOfYear(e){if(i.get_day_of_year(e)>i.LAST_DAY_OF_WEEK)return!1;const t=i.get_cal(d,i.get_year(e),i.JANUARY,1,0,0),s=i.clone(t);return i.add_date(s,i.LAST_DAY_OF_WEEK-i.get_day_of_week(t)),e.getTime()<s.getTime()}_moveToWeekIndexAccountingAdditional(e,t,s){let r=e+s;for(const s of t)if(!(s.weekIndex<e)){if(s.weekIndex>=r)break;r--}return r}_calculateBarWeekStart(e,t,s,n){const a=this._getIndexOfWeekWithExtraBarIfExists(t,s);if(null===a){
const t=this._spec.getEntriesForWeek(s).firstDayOfWeek()-i.get_day_of_week(e),r=i.clone(e);return i.add_date(r,t),r}const o=this._spec.getHistoryByIndex(a.entryIndex);if(this.indexOfPeriod((0,r.ensureNotNull)(o.getStartDay()))===n)return i.clone((0,r.ensureNotNull)(o.getStartDay()));const _=this._spec.getHistoryByIndex(a.entryIndex-1).getEntries().firstDayOfWeek()-i.get_day_of_week(e),d=i.clone(e);return i.add_date(d,_),d}_numberOfCalendarWeeks(e){const t=i.get_day_of_year(e),s=i.get_day_of_week(e);return Math.trunc((t-s)/7)}_getStartOfYearData(e,t){let s=this._yearStartDataHash.get(e);if(void 0!==s)return s;let r=i.get_cal(d,e,i.JANUARY,1,0,0),n=this._spec.getWeekIndex(r),a=0;for(i.get_day_of_week(r)===i.FIRST_DAY_OF_WEEK&&(a=1),s=this._getYearStartDataFromWeek(t,n,r);null===s.startOfFirstBarInYear;)n++,a++,r=this._moveToNextCalendarWeekStart(r),s=this._getYearStartDataFromWeek(t,n,r);return s.fullWeeksAdjustment=a,this._yearStartDataHash.set(e,s),s}_moveToNextCalendarWeekStart(e){const t=i.get_day_of_week(e),s=i.clone(e);return i.add_date(s,i.LAST_DAY_OF_WEEK-t+1),s}_getYearStartDataFromWeek(e,t,s){const r=i.get_day_of_week(s);let n=null,a=0;const o=this._getIndexOfWeekWithExtraBarIfExists(e,t);if(null!==o){let e=this._spec.getHistoryByIndex(o.entryIndex-1).getEntries().firstDayOfWeek()-r;if(e>=0)n=i.clone(s),i.add_date(n,e),a=2;else{const t=this._spec.getHistoryByIndex(o.entryIndex);e=t.getEntries().firstDayOfWeek()-r,e>=0&&(n=t.getStartDay(),n&&(n=i.clone(n)),a=1)}}else{const e=this._spec.getEntriesForWeek(t),o=e.firstDayOfWeek()-r;o>=0&&(this._hasWorkingDays(e)||this._hasWorkingDaysNextWeek(t+1))&&(n=i.clone(s),i.add_date(n,o),a=1)}return{startOfFirstBarInYear:n,firstWeekIndex:t,firstWeekbarsCount:a,fullWeeksAdjustment:0}}_hasWorkingDays(e){if(0===e.entriesByDay().size)return!1;for(let t=e.firstDayOfWeek();t<=i.LAST_DAY_OF_WEEK;t++)if(void 0!==e.entriesByDay().get(t))return!0;return!1}_hasWorkingDaysNextWeek(e){const t=this._spec.getEntriesForWeek(e);for(let e=1;e<t.firstDayOfWeek();e++)if(void 0!==t.entriesByDay().get(e))return!0;return!1}_calculateWeeksWithExtraBar(e,t,s){let r=0;for(const i of t){if(i.weekIndex>=e)break;i.weekIndex>s&&r++}return r}_calculateLastWeek(e,t,s,r){const n=i.get_day_of_week(e),a=this._getIndexOfWeekWithExtraBarIfExists(s,t);if(null===a){return n-this._spec.getEntriesForWeek(t).firstDayOfWeek()>=0?1:0}const o=this._positionInsideWeekWithSeveralBars(a,n);return o===p.IsInNewSession?r:o===p.IsInMidSession?r-1:0}_getIndexOfWeekWithExtraBarIfExists(e,t){for(const s of e){if(s.weekIndex===t)return s;if(s.weekIndex>t)break}return null}_positionInsideWeekWithSeveralBars(e,t){let s=this._spec.getHistoryByIndex(e.entryIndex).getEntries().firstDayOfWeek()-t;if(s<=0)return p.IsInNewSession;return s=this._spec.getHistoryByIndex(e.entryIndex-1).getEntries().firstDayOfWeek()-t,s<=0?p.IsInMidSession:p.IsBeforeAnySession}}p.IsBeforeAnySession=-1,p.IsInMidSession=0,p.IsInNewSession=1,p.fullWeekOfAdditionalBarsCount=2;class E{constructor(e){this._builder=null,this._session=e}indexOfPeriod(e){
return this._getBuilder().indexOfPeriod(e)}startOfPeriod(e,t){return this._getBuilder().startOfPeriod(e,t)}_getBuilder(){return null==this._builder&&(this._builder=this._session.spec.hasHistoryCorrections()?new p(this._session.spec):new O(this._session.spec)),this._builder}}class T{constructor(e){this._session=e}indexOfPeriod(e){return i.get_month(e)}startOfPeriod(e,t){if(e<0){const s=(0,n.toInt)((11-e)/12);t-=s,e+=12*s}else e>i.DECEMBER&&(t++,e=i.JANUARY);return i.get_cal(d,t,e,1)}}}}]);