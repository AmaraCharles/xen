"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[17619],{846778:(e,t,i)=>{i.d(t,{showPasteLineToolHint:()=>c});var r=i(444372),n=i(62802),o=i(638456),s=i(470316),l=i(764829);const a=r.t(null,void 0,i(815402));function c(e,t){l.enabled("popup_hints")&&!o.CheckMobile.any()&&Promise.all([i.e(62093),i.e(32690),i.e(82321),i.e(26166)]).then(i.bind(i,410837)).then((i=>{const r=new i.ChartEventHintRenderer(e),o=a.format({shortcut:(0,s.humanReadableHash)(s.Modifiers.Mod+86)});let l=null;r.show(o,(()=>{null!==l&&(clearTimeout(l),l=null,n.setValue(t,!0,{forceFlush:!0}))})),l=setTimeout((()=>{l=null,r.hide()}),5e3)}))}},828473:(e,t,i)=>{i.d(t,{compareTwoCollectionsByIds:()=>g,findFirst:()=>v,indexOf:()=>m,intersect:()=>p,join:()=>_,lowerbound:()=>s,lowerboundExt:()=>o,mapEntriesGenerator:()=>y,moveAfter:()=>h,moveBefore:()=>d,moveToHead:()=>u,nestedMapGenerator:()=>T,removeItemFromArray:()=>P,subtract:()=>c,sum:()=>f,upperbound:()=>a});var r=i(650151);function n(e,t){return e<t}function o(e,t,i,r,n){let o=n-r;for(;0<o;){const n=o>>1,s=r+n;i(e(s),t)?(r=s+1,o-=n+1):o=n}return r}function s(e,t,i,r=0,n=e.length){return o((t=>e[t]),t,i,r,n)}function l(e,t,i=0,r=e.length){return s(e,t,n,i,r)}function a(e,t,i,r=0,n=e.length){let o=n-r;for(;0<o;){const n=o>>1,s=r+n;i(t,e[s])?o=n:(r=s+1,o-=n+1)}return r}function c(e,t){return e.filter((e=>!t.includes(e)))}function u(e,t){const i=e.indexOf(t);return i<0?e.slice():[t].concat(e.slice(0,i)).concat(e.slice(i+1))}function h(e,t,i){const r=new Set(t),n=[],o=[],s=[];return e.forEach(((e,t)=>{r.has(e)?o.push(e):(n.push(e),s.push(t))})),i=i<e.length-1?l(s,i+1):n.length,n.splice(i,0,...o),{newItems:n,movedItemsStartIndex:i}}function d(e,t,i){const r=new Set(t),n=[],o=[],s=[];return e.forEach(((e,t)=>{r.has(e)?o.push(e):(n.push(e),s.push(t))})),i=i<=e.length-1?l(s,i):n.length,n.splice(i,0,...o),{newItems:n,movedItemsStartIndex:i}}function p(e,t){const i=new Set;return e.forEach((e=>{t.has(e)&&i.add(e)})),i}function _(e,t){const i=new Set(e);return t.forEach((e=>i.add(e))),i}function P(e,t){const i=e.indexOf(t);(0,r.assert)(-1!==i,"Item is not found"),e.splice(i,1)}function v(e,t){for(const i of e)if(t(i))return i;return null}function m(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i;return-1}function g(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i].id()!==t[i].id())return!1;return!0}function f(e){return e.reduce(((e,t)=>e+t),0)}function*y(e){for(const[t,i]of e)yield[t,i]}function*T(e,t){for(const[i,r]of e)if(void 0===t)for(const[,e]of r)yield[i,e];else{const e=r.get(t);void 0!==e&&(yield[i,e])}}},370407:(e,t,i)=>{i.d(t,{TranslatedString:()=>r});class r{constructor(e,t){this._originalText=e,this._translatedText=t}originalText(){return this._originalText}translatedText(){return this._translatedText}format(e){const t={},i={};for(const n of Object.keys(e)){const o=e[n];o instanceof r?(t[n]=o.originalText(),i[n]=o.translatedText()):(t[n]=o.toString(),i[n]=o.toString())}const n=this._originalText.format(t),o=this._translatedText.format(i)
;return new r(n,o)}}},566238:(e,t,i)=>{i.d(t,{WatchedObject:()=>s});var r=i(375397),n=i(124829);function o(e,t){return(0,n.deepEquals)(e,t)[0]}class s extends r.WatchedValue{constructor(e,t=o){super(e),this._comparator=t}setValue(e,t){(t||!1===this._comparator(this.value(),e))&&super.setValue(e,t)}}},994157:(e,t,i)=>{i.d(t,{showCustomUrlEventDialog:()=>l});var r=i(444372),n=i(779923);const o=r.t(null,void 0,i(819295)),s=r.t(null,void 0,i(904543));async function l(e){const{onConfirm:t,onClose:i,title:r,placeholderText:l}=e;return(0,n.showRename)({title:r,text:"",placeholder:l,mainButtonText:o,cancelButtonText:s,onRename:({newValue:e,dialogClose:i})=>{t(e),i()},onClose:i})}},26829:(e,t,i)=>{i.d(t,{CHART_WIDGET_COLLECTION_SERVICE:()=>n,CollectionViewMode:()=>s,chartWidgetCollectionService:()=>o});var r=i(564894);const n={id:"ChartWidgetCollectionService"};function o(){return(0,r.hasService)(n)?(0,r.service)(n):null}var s;!function(e){e.Multichart="multichart",e.ForceFullscreen="force-fullscreen"}(s||(s={}))},937713:(e,t,i)=>{i.d(t,{lastMouseOrTouchEventInfo:()=>n,setLastMouseOrTouchEventInfo:()=>o});let r=(0,i(638456).supportTouch)()?{isTouch:!0,stylus:!1}:{isTouch:!1};function n(){return r}function o(e){r=e.isTouch?{isTouch:!0,stylus:e.stylus}:{isTouch:!1}}},259336:(e,t,i)=>{i.d(t,{PaneInvalidationMask:()=>n});var r=i(219849);class n{constructor(e=r.defaultInvalidationLevel){this._paneInvalidationLevel=r.defaultInvalidationLevel,this._leftPriceScalesInvalidationMap=new Map,this._rightPriceScalesInvalidationMap=new Map,this._legendWidgetInvalidated=!1,this._invalidationLevel=e}fullInvalidation(){return this._invalidationLevel}invalidateAll(e){this._invalidationLevel=Math.max(this._invalidationLevel,e)}invalidatePane(e){this._paneInvalidationLevel=Math.max(this._invalidationLevel,e)}invalidateLegendWidgetLayout(){this._legendWidgetInvalidated=!0}invalidatePriceScale(e,t,i){const n="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap,o=n.get(t)||r.defaultInvalidationLevel;n.set(t,Math.max(o,i))}invalidationLevelForPane(){return Math.max(this._paneInvalidationLevel,this._invalidationLevel)}legendWidgetLayoutInvalidated(){return this._legendWidgetInvalidated||this._invalidationLevel===r.InvalidationLevel.Full}getterForPriceScaleInvalidationLevelBySide(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;return e=>Math.max(t.get(e)||r.defaultInvalidationLevel,this._invalidationLevel)}priceScaleSideMaxLevel(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;let i=this._invalidationLevel;return t.size>0&&t.forEach((e=>{e>i&&(i=e)})),i}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._paneInvalidationLevel=Math.max(this._paneInvalidationLevel,e._paneInvalidationLevel),e._leftPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._leftPriceScalesInvalidationMap.get(t)||r.defaultInvalidationLevel;this._leftPriceScalesInvalidationMap.set(t,Math.max(i,e))})),
e._rightPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._rightPriceScalesInvalidationMap.get(t)||r.defaultInvalidationLevel;this._rightPriceScalesInvalidationMap.set(t,Math.max(i,e))})),this._legendWidgetInvalidated=this._legendWidgetInvalidated||e._legendWidgetInvalidated}}},631843:(e,t,i)=>{i.d(t,{alignToStep:()=>o});var r=i(960521),n=i.n(r);function o(e,t){return n()(e).div(t).round(0,n().roundHalfUp).mul(t).toNumber()}},831208:(e,t,i)=>{var r=i(694852).makeFont,n=i(694852).parseFont,o=i(338619).getLogger;const{drawPoly:s}=i(665798);var l=o("Model.ChartTradingUtils"),a={_fontHeightCache:{},_parsedColorCache:{},_parseColor:function(e){if(this._parsedColorCache[e])return this._parsedColorCache[e];var t=document.createElement("div");t.style.color=e;var i=t.style.color.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i)||t.style.color.match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*\.?\d+)\s*\)$/i),r={r:i[1],g:i[2],b:i[3],a:i[4]||"1"};return this._parsedColorCache[e]=r,r},getColorFromProperties:function(e,t){var i=1-t.value()/100,r=this._parseColor(e.value());return"rgba("+r.r+","+r.g+","+r.b+","+i+")"},setColorToProperties:function(e,t,i){var r=this._parseColor(e);t.setValue("rgb("+r.r+","+r.g+","+r.b+")");var n=100*(1-r.a);i.setValue(Math.max(0,Math.min(n,100)))},getFontFromProperties:function(e,t,i,n){return r(t.value(),e.value(),n.value()?"italic":"",i.value()?"bold":"")},setFontToProperties:function(e,t,i,r,o){var s=n(e);null!==s?(s.family.length>0&&t.setValue(s.family),i.setValue(s.size),r.setValue(s.bold),o.setValue(s.italic)):l.logError("Invalid font: "+e)},fontHeight:function(e){if(!this._fontHeightCache[e]){var t=document.createElement("span");t.appendChild(document.createTextNode("height")),document.body.appendChild(t),t.style.cssText="font: "+e+"; white-space: nowrap; display: inline;";var i=t.offsetHeight;document.body.removeChild(t),this._fontHeightCache[e]=Math.ceil(i)}return this._fontHeightCache[e]},drawPolyHoverOrPress:function(e,t,i,r){r?(e.save(),e.fillStyle="rgba(0, 0, 0, 0.15)",s(e,t,!0),e.restore()):i&&(e.save(),e.fillStyle="rgba(0, 0, 0, 0.1)",s(e,t,!0),e.restore())},repaint:function(e){e.lightUpdate()},roundToMinTick:function(e,t){var i=1/e.mainSource().base();return i*Math.round(t/i)}};e.exports=a},903424:(e,t,i)=>{i.d(t,{DataSource:()=>d,getTranslatedStringForSource:()=>u,toInputDisplayFlags:()=>h});var r=i(370407),n=i(287741),o=i(79342),s=i(942634),l=i(354957),a=i(375397),c=i(218049);function u(e,t){return new r.TranslatedString(t.name(),t.title(e))}function h(e){switch(e){case n.TitleDisplayTarget.DataWindow:return c.InputDisplayFlags.DataWindow;case n.TitleDisplayTarget.StatusLine:case n.TitleDisplayTarget.Alerts:return c.InputDisplayFlags.StatusLine}}class d{constructor(e){this._isDestroyed=!1,this._hasAlert=new a.WatchedValue(!1),this._alertStatus=new a.WatchedValue(0),this._alertCreationAvailable=new a.WatchedValue(l.alertsAvailable),this._zorder=0,this._priceScale=null,this._ownerSource=null,this._userEditEnabled=!0,this._priceScaleChanged=new s.Delegate,
this._isSelectionEnabled=!0,this._instanceId=(0,o.randomHashN)(6),this._ownerSourceChanged=new s.Delegate,this._zOrderChanged=new s.Delegate,this._id=null!=e?e:(0,o.randomHashN)(6),l.alertsAvailable&&Promise.resolve().then((()=>{this._isDestroyed||this._hasAlert.subscribe(this._updateAlertCreationAvailable.bind(this),{callWithLast:!0})}))}destroy(){this._isDestroyed=!0}id(){return this._id}instanceId(){return this._instanceId}preferNoScale(){return!1}setId(e){this._id=e}zorder(){return this._zorder}setZorder(e){"number"==typeof e&&this._zorder!==e&&(this._zorder=e,this._zOrderChanged.fire(e))}preferredZOrder(){return null}isSpeciallyZOrderedSource(){return!1}title(e){return this.name()}priceScale(){return this._priceScale}setPriceScale(e){this._priceScale=e,this._priceScaleChanged.fire(e)}priceScaleChanged(){return this._priceScaleChanged}ownerSource(){return this._ownerSource}setOwnerSource(e){const t=this._ownerSource;this._ownerSource=e,this._ownerSourceChanged.fire(t,e)}ownerSourceChanged(){return this._ownerSourceChanged}zOrderChanged(){return this._zOrderChanged}isSavedInChart(e){return!0}isSavedInStudyTemplates(){return!0}isRemovedByStudyTemplates(){return!0}hasContextMenu(){return!0}showInObjectTree(){return!0}setUserEditEnabled(e){this._userEditEnabled=e}userEditEnabled(){return this._userEditEnabled}canBeHidden(){return this.userEditEnabled()}isUserDeletable(){return this.userEditEnabled()}properties(){return null}propertyByPath(e){const t=e.split(".");if(t.length<1)throw new Error("Invalid path");const i=t[0];if("properties"===i){const e=this.properties();return 1===t.length?e:e.childByPath(t.slice(1).join("."))}throw new Error(`Unknown property root: ${i}`)}isVisible(){return this.properties().visible.value()}dataWindowView(){return null}priceAxisViews(e,t){return null}timeAxisViews(){return null}updateAllViews(e){}paneViews(e){return null}labelPaneViews(e){return null}isFailed(){return!1}isLoading(){return!1}isPhantom(){return!1}isChildStudy(){return!1}hasChildren(){return!1}canHaveChildren(){return!1}onClickOutside(e,t){}getSourceIcon(){return null}state(e){return null}doesMovingAffectsUndo(){return!0}isMultiPaneAvailable(){return!1}isMultiPaneEnabled(){return!1}copiable(){return!1}cloneable(){return!1}movable(){return!1}isIncludedInAutoScale(){return!1}isHoveredEnabled(){return this.isSelectionEnabled()}showOnTopOnHovering(){return!0}isSelectionEnabled(){return this._isSelectionEnabled}setSelectionEnabled(e){this._isSelectionEnabled=e}firstValue(){return null}priceRange(e,t,i){return null}autoScaleInfo(e,t,i){return{range:this.priceRange(e,t,i)}}stateForAlert(){return null}canHasAlert(){return!1}canHasAlertOnLineTools(){return!1}hasAlert(){return this._hasAlert.readonly()}alertCreationAvailable(){return this._alertCreationAvailable.readonly()}hasStateForAlert(){return l.alertsAvailable}idForAlert(){return this._id}alertStatus(){return this._alertStatus.readonly()}_getAlertCreationAvailable(){return l.alertsAvailable&&this.hasStateForAlert()}_updateAlertCreationAvailable(){
l.alertsAvailable&&this._alertCreationAvailable.setValue(this._getAlertCreationAvailable())}}},832312:(e,t,i)=>{i.d(t,{LimitedPrecisionNumericFormatter:()=>n});var r=i(397566);class n{constructor(e,t){this._precision=null!=e?e:1,this._numericFormatter=new r.NumericFormatter({precision:this._precision,ignoreLocaleNumberFormat:t})}format(e,t){const i=e.toFixed(this._precision),r=Math.pow(10,-this._precision);return this._numericFormatter.format(Math.max(parseFloat(i),r),t)}parse(e,t){const i=this._numericFormatter.parse(e,t);return i.res?{res:!0,value:i.value,suggest:this.format(i.value)}:i}}},287741:(e,t,i)=>{var r;i.d(t,{TitleDisplayTarget:()=>r}),function(e){e[e.DataWindow=1]="DataWindow",e[e.StatusLine=2]="StatusLine",e[e.Alerts=3]="Alerts"}(r||(r={}))},518439:(e,t,i)=>{var r;i.d(t,{PlotRowSearchMode:()=>r}),function(e){e[e.NearestLeft=-1]="NearestLeft",e[e.Exact=0]="Exact",e[e.NearestRight=1]="NearestRight"}(r||(r={}))},487945:(e,t,i)=>{function r(e){const t=(null==e?void 0:e.symbolSource)&&e.symbolSource()===e,i=void 0!==(null==e?void 0:e.isActingAsSymbolSource);return t||i}function n(e){return r(e)&&"quotesProvider"in e}function o(e){return r(e)&&e.isActingAsSymbolSource().value()}i.d(t,{isActingAsSymbolSource:()=>o,isSymbolSource:()=>r,isSymbolSourceWithQuotesProvider:()=>n})},329944:(e,t,i)=>{i.d(t,{LevelsProperty:()=>P});var r=i(154834),n=i(998034),o=i(124829),s=i(262624),l=i(211183);const a={prefixes:[""],range:[0,0],names:["coeff","color","visible","linestyle","linewidth"],typecheck:{pack:()=>Object(),unpack:()=>[]}};function c(e,t,i,r){return r.push(i[t]),r}function u(e,t,i,r){return r[t]=i[e],r}function h(){return[]}function d(){return{}}function p(e,t,i){return i.prefixes.forEach((r=>{const n=r+"level";for(let r=i.range[0];r<=i.range[1];r++)if(e[n+r]&&(0,o.isSameType)(e[n+r],t.typecheck())){let o=t.tpl();i.names.forEach(((i,s)=>{o=t.fill(""+s,i,e[n+r],o)})),e[n+r]=o}})),e}function _(e,t,i){return i(e,{tpl:d,fill:u,typecheck:t.typecheck.unpack},t)}class P extends s.DefaultProperty{constructor(e){const{levelsIterator:t=p,map:i={},...r}=e,n={...a,...i};r.state&&(r.state=_(r.state,n,t)),super(r),this._map=n,this._levelsIterator=t}state(e,t){const i=super.state(e);return t?i:(r=i,n=this._map,(0,this._levelsIterator)(r,{tpl:h,fill:c,typecheck:n.typecheck.pack},n));var r,n}preferences(){return(0,s.extractState)(this.state(this._excludedDefaultsKeys,!0),this._allDefaultsKeys)}applyTemplate(e,t){this.mergeAndFire((0,s.extractState)((0,n.default)((0,r.default)(t),_(e,this._map,this._levelsIterator)),this._allStateKeys,this._excludedTemplateKeys))}saveDefaults(){this._useUserPreferences&&(0,l.saveDefaults)(this._defaultName,this.preferences())}clone(){return new P(this._options())}merge(e,t){return super.merge(this._map?_(e,this._map,this._levelsIterator):e,t)}_options(){return{...super._options(),map:{...this._map},levelsIterator:this._levelsIterator}}}},469805:(e,t,i)=>{i.d(t,{lineToolsDoNotAffectChartInvalidation:()=>r});const r=!0},462723:(e,t,i)=>{i.d(t,{LineTool5PointsPattern:()=>l})
;var r=i(650151),n=i(262624),o=i(929927),s=i(23666);class l extends o.LineDataSource{constructor(e,t,i,r){super(e,t||l.createProperties(),i,r),this._loadPaneViews(e)}pointsCount(){return 5}name(){return"XABCD Pattern"}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetool5pointspattern",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,503929)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}_loadPaneViews(e){Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,960673)).then((t=>{this._setPaneViews([new t.Pattern5pointsPaneView(this,e)])}))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new s.LineToolColorsProperty([(0,r.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new s.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}},558540:(e,t,i)=>{i.d(t,{LineToolABCD:()=>l});var r=i(650151),n=i(262624),o=i(929927),s=i(23666);class l extends o.LineDataSource{constructor(e,t,r,n){const o=t||l.createProperties();super(e,o,r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,309094)).then((t=>{this._setPaneViews([new t.ABCDPaneView(this,e)])}))}pointsCount(){return 4}name(){return"ABCD Pattern"}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolabcd",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,508171)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new s.LineToolColorsProperty([(0,r.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new s.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}},237026:(e,t,i)=>{i.d(t,{LineToolArc:()=>u});var r=i(650151),n=i(204652),o=i(86441),s=i(625422),l=i(262624),a=i(929927),c=i(23666);class u extends a.LineDataSource{constructor(e,t,r,n){const o=t||u.createProperties();super(e,o,r,n),this.version=2,this._dist=null,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,616697)).then((({ArcPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,n.distanceToLine)(e,t,i).distance;const s=t.subtract(e),l=new o.Point(-s.y,s.x),a=e.add(t).scaled(.5);i.subtract(a).dotProduct(l)<0&&(this._dist=-this._dist)}}endChanging(e,t){return this._dist=null,super.endChanging(e,t)}pointsCount(){return 3}
name(){return"Arc"}hasEditableCoordinates(){return!1}setPoint(e,t){const i={...t},l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),c=this._model.mainSeries().interval();switch(e){case 0:{const e=(0,r.ensureNotNull)(this._dist),t=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),n=a.subtract(t),s=t.add(a).scaled(.5);let l=new o.Point(-n.y,n.x);l=l.normalized();const u=s.add(l.scaled(e));this._points[0]={...i,interval:c},this._points[2]={...(0,r.ensureNotNull)(this.screenPointToPoint(u)),interval:c};break}case 1:{const e=(0,r.ensureNotNull)(this._dist),t=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),n=t.subtract(l),s=l.add(t).scaled(.5),a=new o.Point(-n.y,n.x).normalized(),u=s.add(a.scaled(e));this._points[1]={...i,interval:c},this._points[2]={...(0,r.ensureNotNull)(this.screenPointToPoint(u)),interval:c};break}case 2:{let e=(0,r.ensureNotNull)(this.pointToScreenPoint(i));const t=(0,n.distanceToLine)(l,a,e).distance,u=a.subtract(l),h=l.add(a).scaled(.5),d=new o.Point(-u.y,u.x).normalized(),p=h.add(d.scaled(t)),_=h.add(d.scaled(-t)),P=u.length(),v=u.x/P,m=u.y/P;let g=Math.acos(v);m<0&&(g=-g);let f=(0,s.translationMatrix)(-h.x,-h.y);e=(0,s.transformPoint)(f,e);let y=(0,s.transformPoint)(f,p);f=(0,s.rotationMatrix)(-g),e=(0,s.transformPoint)(f,e),y=(0,s.transformPoint)(f,y),f=(0,s.scalingMatrix)(1,P/(2*t)),e=(0,s.transformPoint)(f,e),y=(0,s.transformPoint)(f,y);const T=e.y*y.y>=0?new o.Point(p.x,p.y):new o.Point(_.x,_.y);this._points[2]={...(0,r.ensureNotNull)(this.screenPointToPoint(T)),interval:c};break}}this._normalizePoints()}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._model.mainSeries().interval(),t=(2*this._points[0].price+3*this._points[1].price)/5;this._points.push({price:t,index:this._points[1].index,interval:e})}if(1===e&&2===this._timePoint.length){const e={price:(2*this._timePoint[0].price+3*this._timePoint[1].price)/5,offset:this._timePoint[1].offset,time_t:this._timePoint[1].time_t,interval:this._properties.childs().interval.value()};this._timePoint.push(e)}}static createProperties(e){const t=new l.DefaultProperty({defaultName:"linetoolarc",state:e});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,616816))).GeneralFiguresDefinitionsViewModelBase}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new c.LineToolColorsProperty([e.childs().color]))}}},866172:(e,t,i)=>{i.d(t,{LineToolArrowMark:()=>l,LineToolArrowMarkDown:()=>h,LineToolArrowMarkLeft:()=>a,LineToolArrowMarkRight:()=>u,LineToolArrowMarkUp:()=>c});var r=i(262624),n=i(929927),o=i(658843),s=i(23666);class l extends n.LineDataSource{constructor(e,t,r,n,o){const s=t||l.createProperties(null,r);super(e,s,n,o),this._textPaneView=null,
Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,643661)).then((({ArrowMarkPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}paneViews(e){const t=super.paneViews();return null!==t&&this._textPaneView&&t.push(this._textPaneView),t}pointsCount(){return 1}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e,t){const i=new r.DefaultProperty({defaultName:t,state:e});return this._configureProperties(i),i}_normalizePoint(e,t){var i;return null!==(i=super._normalizePointWithoutOffset(e))&&void 0!==i?i:super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,191515)).then((e=>e.ArrowMarkDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new s.LineToolColorsProperty([e.childs().arrowColor])),e.addChild("textsColors",new s.LineToolColorsProperty([e.childs().color])),e.hasChild("text")||e.addChild("text",new o.Property("")),e.addExcludedKey("text",1)}}l.version=2;class a extends l{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkleft",i,r)}direction(){return"left"}name(){return"Arrow Mark Left"}textAlignParams(){return{horzAlign:"left",vertAlign:"middle",offsetX:22,offsetY:3}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkleft")}}class c extends l{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkup",i,r)}direction(){return"up"}name(){return"Arrow Mark Up"}textAlignParams(){return{horzAlign:"center",vertAlign:"top",offsetX:0,offsetY:20}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkup")}}class u extends l{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkright",i,r)}direction(){return"right"}name(){return"Arrow Mark Right"}textAlignParams(){return{horzAlign:"right",vertAlign:"middle",offsetX:22,offsetY:3,forceTextAlign:!0}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkright")}}class h extends l{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkdown",i,r)}direction(){return"down"}name(){return"Arrow Mark Down"}textAlignParams(){return{horzAlign:"center",vertAlign:"bottom",offsetX:0,offsetY:20}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkdown")}}},32623:(e,t,i)=>{i.d(t,{LineToolArrowMarker:()=>s});var r=i(929927),n=i(262624),o=i(658843);class s extends r.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:s.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,210069)).then((({ArrowMarkerPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}))}pointsCount(){return 2}name(){return"Arrow Marker"}snapTo45DegreesAvailable(){return!0}static createProperties(e){const t=new n.DefaultProperty({
defaultName:"linetoolarrowmarker",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,503207)).then((e=>e.ArrowMarkerDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new o.Property("")),e.addExcludedKey("text",1)}}},681090:(e,t,i)=>{i.d(t,{LineToolArrow:()=>n});var r=i(815259);class n extends r.LineToolTrendLine{constructor(e,t,i,r){super(e,null!=t?t:n.createProperties(),i,r)}name(){return"Arrow"}static createProperties(e){const t=r.LineToolTrendLine._createPropertiesImpl("linetoolarrow",e);return n._configureProperties(t),t}}},418998:(e,t,i)=>{i.d(t,{LineToolBalloon:()=>u});var r=i(650151),n=i(444372),o=i(262624),s=i(89282),l=i(658843),a=i(23666);const c=n.t(null,void 0,i(309818));class u extends s.InplaceTextLineDataSource{constructor(e,t,i,r){super(e,t||u.createProperties(),i,r),this._createPaneView()}pointsCount(){return 1}name(){return"Balloon"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}static createProperties(e){const t=new o.DefaultProperty({defaultName:"linetoolballoon",state:e});return this._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,433615)).then((e=>e.BalloonDefinitionsViewModel))}_createPaneView(){Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,883116)).then((e=>{this._setPaneViews([new e.BalloonPaneView(this,this._model)])}))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new l.Property(this._defaultText)),e.addExcludedKey("text",1),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color]))}}u._defaultText=c},316589:(e,t,i)=>{i.d(t,{LineToolBarsPattern:()=>y});var r=i(650151),n=i(444372),o=i(370407),s=i(124829),l=i(691371),a=i(262624),c=i(518439),u=i(929927),h=i(904498),d=i(169532),p=i(469805);const _=new o.TranslatedString("mirror bars pattern",n.t(null,void 0,i(920965))),P=new o.TranslatedString("flip bars pattern",n.t(null,void 0,i(182349))),v=n.t(null,void 0,i(928941)),m=n.t(null,void 0,i(563271)),g={0:2,1:4,2:1,3:1,4:2,5:3,6:-1},f={0:3,1:4,2:4,3:1,4:2,5:3,6:-1};class y extends u.LineDataSource{constructor(e,t=y.createProperties(),r,n){super(e,t,r,n),this._pattern=[],this._scale=1,this._pointsCoordinatePricesDiff=null;const o=t.childs().mode.value();(0,s.isString)(o)&&t.childs().mode.setValue(parseInt(o)),t.childs().mirrored.listeners().subscribe(this,this._mirror),
t.childs().flipped.listeners().subscribe(this,this._flip),t.childs().mode.subscribe(this,this._updateLastPoint),this.version=2,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,650804)).then((t=>{this._setPaneViews([new t.BarsPatternPaneView(this,e)])}))}pattern(){return this._pattern}isSynchronizable(){return!1}additionalActions(e){return[new l.Action({actionId:"Chart.LineTool.BarsPattern.ToggleMirrored",options:{checked:this.properties().childs().mirrored.value(),checkable:!0,label:v,onExecute:()=>{e.setProperty(this.properties().childs().mirrored,!this.properties().childs().mirrored.value(),_,p.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,d.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}}),new l.Action({actionId:"Chart.LineTool.BarsPattern.ToggleFlipped",options:{checked:this.properties().childs().flipped.value(),checkable:!0,label:m,onExecute:()=>{e.setProperty(this.properties().childs().flipped,!this.properties().childs().flipped.value(),P,p.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,d.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}})]}pointsCount(){return 2}state(e){return{...super.state(e),pattern:this._pattern,scale:this._scale,diff:this._pointsCoordinatePricesDiff}}restoreData(e){const{pattern:t=this._pattern,scale:i=this._scale,diff:r=this._pointsCoordinatePricesDiff}=e;this._pattern=t,this._scale=i,this._pointsCoordinatePricesDiff=r}name(){return"Bars Pattern"}hasEditableCoordinates(){return!1}cloneData(e){this._pattern=(0,s.clone)(e._pattern),this._scale=e._scale,this._pointsCoordinatePricesDiff=e._pointsCoordinatePricesDiff}firstPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[0];return e.value()===h.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[f[e.value()]]:i[g[e.value()]]}lastPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[this._pattern.length-1];return e.value()===h.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[g[e.value()]]:i[f[e.value()]]}addPoint(e,t,i){const n=super.addPoint(e,t,!0);if(n){const e=this._model.mainSeries(),[{index:t},{index:i}]=this.points(),n=(0,r.ensureDefined)(e.nearestIndex(Math.min(t,i),c.PlotRowSearchMode.NearestRight)),o=(0,r.ensureDefined)(e.nearestIndex(Math.max(t,i),c.PlotRowSearchMode.NearestLeft));this._pattern=this._createPattern(n,o),this._pattern.length>0&&(t>i&&this._points.reverse(),this._points[1].price=this._points[0].price+this._patternPriceDiff(),this._points[1].index=this._points[0].index+(o-n),this._normalizePoints(),this.createServerPoints()),this._updatePointsCoordinatePricesDiff()}return n}setPoint(e,t,i,r){1===e&&t.index<=this._points[0].index&&(t.index=this._points[0].index+1),0===e&&t.index>=this._points[1].index&&(t.index=this._points[1].index-1),super.setPoint(e,t,i),this._updatePointsCoordinatePricesDiff()}move(e,t,i,r){super.move(e,t,i,r),this._updatePointsCoordinatePricesDiff()}migrateVersion(e,t,i){
if(1===e&&this._pattern.length>0){const e=this._patternPriceDiff();2===this._timePoint.length&&(this._timePoint[1].price=this._timePoint[0].price+e),2===this._points.length&&(this._points[1].price=this._points[0].price+e)}}getScale(){return this._scale=this._calculateScale()}static createProperties(e){const t=new a.DefaultProperty({defaultName:"linetoolbarspattern",state:e});return this._configureProperties(t),t}_preparePoint(e,t){var i;const n=this._alignPointToRangeOfActualData(e),o=this._model.mainSeries(),s=(0,r.ensureNotNull)(o.bars().valueAt(n.index));this.properties().childs().mode.value()===h.LineToolBarsPatternMode.Bars?n.price=(0,r.ensure)(s[2]):n.price=(0,r.ensure)(s[4]);const l=(0,r.ensureNotNull)(this.priceScale()),a=(0,r.ensure)(null===(i=this.ownerSource())||void 0===i?void 0:i.firstValue()),c=.05*l.height(),u=l.priceToCoordinate(n.price,a)-c;return n.price=l.coordinateToPrice(u,a),super._preparePoint(n,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,808741))).BarsPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("mirrored",1),e.addExcludedKey("flipped",1)}_calculatePatternCoordinatePricesDiff(){var e;return this._pattern.length>0&&null!==(e=this._priceCoordinateDiff([this.firstPatternPrice(),this.lastPatternPrice()]))&&void 0!==e?e:null}_updatePointsCoordinatePricesDiff(){this._pointsCoordinatePricesDiff=this._calculatePointsCoordinatePricesDiff()}_calculatePointsCoordinatePricesDiff(){var e;if(2===this._points.length){const[{price:t},{price:i}]=this.points();return null!==(e=this._priceCoordinateDiff([t,i]))&&void 0!==e?e:null}return null}_createPattern(e,t){const i=this._model.mainSeries().data(),n=[];for(let o=e;o<=t;o++)n.push((0,s.clone)((0,r.ensureNotNull)(i.valueAt(o))));return n}_switchPointsPrice(){const e=this._points[0].price;this._timePoint[0].price=this._points[0].price=this._points[1].price,this._timePoint[1].price=this._points[1].price=e}_mirror(){const e=this._pattern;let t=Math.min(e[0][3],e[0][2]),i=Math.max(e[0][3],e[0][2]);for(let r=1;r<e.length;r++)t=Math.min(t,e[r][3]),i=Math.max(i,e[r][2]);if(t<i){const r=(t+i)/2,n=e=>r-(e-r);for(let t=0;t<e.length;t++)e[t][2]=n(e[t][2]),e[t][3]=n(e[t][3]),e[t][1]=n(e[t][1]),e[t][4]=n(e[t][4])}this._switchPointsPrice(),this.updateAllViews((0,d.sourceChangeEvent)(this.id()))}_flip(){const e=this._pattern,t=e.length;for(let i=0;i<t/2;i++){const r=e[i];e[i]=e[t-i-1],e[t-i-1]=r}this._switchPointsPrice(),this.updateAllViews((0,d.sourceChangeEvent)(this.id()))}_patternPriceDiff(){return this.lastPatternPrice()-this.firstPatternPrice()}_pricesToCoordinates(e){var t,i;const r=this.priceScale(),n=null!==(i=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue())&&void 0!==i?i:null;if(null!==n&&null!==r&&!r.isEmpty())return e.map((e=>r.priceToCoordinate(e,n)))}_priceCoordinateDiff(e){const t=this._pricesToCoordinates(e);if(t)return t[1]-t[0]}_calculateScale(){let e=1;if(2===this._points.length){
const t=this._calculatePatternCoordinatePricesDiff();if(!t)return e;const i=this._calculatePointsCoordinatePricesDiff();if(t&&null!==i&&(e=+(i/t).toFixed(8)),this._pointsCoordinatePricesDiff!==i){if(this._scale!==e)return this._updateLastPoint(),this._scale;this._updatePointsCoordinatePricesDiff()}}return e}_updateLastPoint(){var e,t;if(this._points.length<2)return;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===r||null===i||i.isEmpty())return;const n=this._calculatePatternCoordinatePricesDiff(),o=this._pricesToCoordinates([this.points()[0].price]);null!==n&&o&&(this._timePoint[1].price=this._points[1].price=i.coordinateToPrice(+(this._scale*n).toFixed(8)+o[0],r),this._updatePointsCoordinatePricesDiff())}}},800757:(e,t,i)=>{i.d(t,{LineToolBezierCubic:()=>s});var r=i(650151),n=i(262624),o=i(929927);class s extends o.LineDataSource{constructor(e,t,r,n){const o=t||s.createProperties();super(e,o,r,n),this._controlPoints=null,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,603346)).then((t=>{this._setPaneViews([new t.BezierCubicPaneView(this,e)])}))}pointsCount(){return 2}name(){return"Double Curve"}normalizedPointsForCreating(){const e=super.normalizedPointsForCreating();return[e[0],e[e.length-1]]}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoints=this._calculateControlPoints(),i}addPoint(e,t,i){const r=super.addPoint(e,t,i);if(r){const e=this._calculateControlPoints(),t=this._model.mainSeries().interval();this._controlPoints=null,this._points.push({...e[0],interval:t}),this._points.push({...e[1],interval:t}),i||(this._normalizePoints(),this.createServerPoints()),this._createPointProperty(2),this._createPointProperty(3)}return r}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2),this._createPointProperty(3)}controlPoints(){return this._controlPoints}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolbeziercubic",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,555758)).then((e=>e.GeneralBezierDefinitionsViewModel))}_calculateControlPoints(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),n=e.add(t).scaled(.33),o=e.add(t).scaled(.67),s=n.add(i),l=o.subtract(i);return[(0,r.ensureNotNull)(this.screenPointToPoint(s)),(0,r.ensureNotNull)(this.screenPointToPoint(l))]}}},846911:(e,t,i)=>{i.d(t,{LineToolBezierQuadro:()=>s});var r=i(650151),n=i(262624),o=i(929927);class s extends o.LineDataSource{constructor(e,t,r,n){const o=t||s.createProperties();super(e,o,r,n),this._controlPoint=null,
Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,834793)).then((t=>{this._setPaneViews([new t.BezierQuadroPaneView(this,e)])}))}pointsCount(){return 2}name(){return"Curve"}normalizedPointsForCreating(){const e=super.normalizedPointsForCreating();return[e[0],e[e.length-1]]}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoint=this._calculateControlPoint(),i}addPoint(e,t,i){const r=super.addPoint(e,t,i);if(r){const e=this._calculateControlPoint();this._points.push({...e,interval:this._model.mainSeries().interval()}),this._controlPoint=null,i||(this._normalizePoints(),this.createServerPoints()),this._createPointProperty(2)}return r}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2)}controlPoint(){return this._controlPoint}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolbezierquadro",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,555758)).then((e=>e.GeneralBezierDefinitionsViewModel))}_calculateControlPoint(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),n=e.add(t).scaled(.5).add(i);return(0,r.ensureNotNull)(this.screenPointToPoint(n))}}},455034:(e,t,i)=>{i.d(t,{LineToolBrush:()=>s});var r=i(262624),n=i(219774),o=i(23666);class s extends n.LineToolBrushBase{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Brush"}hasEditableCoordinates(){return!1}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolbrush",state:e});return this._configureProperties(t),t}_loadPaneViews(e){Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,470603)).then((t=>{this._setPaneViews([new t.BrushPaneView(this,e)])}))}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,400001)).then((e=>e.BrushDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new o.LineToolColorsProperty([e.childs().backgroundColor],e.childs().fillBackground)),e.hasChild("linestyle")&&e.removeProperty("linestyle"),e.hasChild("linesStyles")&&e.removeProperty("linesStyles")}}},441788:(e,t,i)=>{i.d(t,{LineToolCallout:()=>l});var r=i(658843),n=i(262624),o=i(23666),s=i(89282);class l extends s.InplaceTextLineDataSource{constructor(e,t,r,n){super(e,t||l.createProperties(),r,n),this._barOffset=0,this._dragStartLeftEdgeIndex=NaN,this._timeScale=e.timeScale(),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,673548)).then((e=>{
this._paneView=new e.CalloutPaneView(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this)),this._setPaneViews([this._paneView])}))}pointsCount(){return 2}name(){return"Callout"}getBarOffset(){return this._barOffset}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.color,wordWrap:e.wordWrap}}removeIfEditableTextIsEmpty(){return!0}activateEditingOnCreation(){return!0}shouldBeRemovedOnDeselect(){const e=this._properties.childs().text.value().trim();return this._points.length===this.pointsCount()&&""===e}addPoint(e){const t=super.addPoint(e);return t&&this._calculateBarOffset(),t}setLastPoint(e){const t=super.setLastPoint(e);return 2===this.points().length&&this._calculateBarOffset(),t}setPoint(e,t){switch(e){case 0:super.setPoint(e,t),this._calculateBarOffset();break;case 1:const i=this.properties().childs();if(!i.wordWrapWidth)return;const r=this._points,n=this._dragStartLeftEdgeIndex,o=Math.round((t.index-n)/2),s=this._model.mainSeries().interval();if(isFinite(n)&&isFinite(o)){r[1]={index:n+o,price:r[1].price,interval:s},this._calculateBarOffset(),this._normalizePoints();const e=this._timeScale.indexToCoordinate(n+2*o)-this._timeScale.indexToCoordinate(n)-8-2;if(!isFinite(e))return;i.wordWrapWidth.setValue(Math.max(100,e));break}r[1]={...t,interval:s},this._calculateBarOffset(),this._normalizePoints()}}setPoints(e){super.setPoints(e);const t=this.properties().childs();if(!t.wordWrapWidth)return;const i=this._dragStartLeftEdgeIndex,r=Math.round((e[1].index-i)/2);if(this._calculateBarOffset(),this._normalizePoints(),isFinite(i)&&isFinite(r)){const e=this._timeScale.indexToCoordinate(i+2*r)-this._timeScale.indexToCoordinate(i)-8-2;if(!isFinite(e))return;t.wordWrapWidth.setValue(Math.max(100,e))}}move(e,t,i){super.move(e,t,i),this._calculateBarOffset()}state(e){const t=super.state(e);return t.barOffset=this._barOffset,t}restoreData(e){e.barOffset?this._barOffset=e.barOffset:this._calculateBarOffset(),this.calculatePoint2()}setPriceScale(e){super.setPriceScale(e),e&&e.priceRange()&&this.calculatePoint2()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}calculatePoint2(){if(this._model.lineBeingEdited()===this||this._model.sourcesBeingMoved().includes(this))return;if(this._points.length<2)return;const[e,t]=this.points();this._points[1]={price:t.price,index:e.index+this._barOffset,interval:this._model.mainSeries().interval()}}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolcallout",state:e});return this._configureProperties(t),t}_applyTemplateImpl(e){this.properties().childs().text.setValue(e.text),super._applyTemplateImpl(e)}_correctPoints(e,t){if(e.length<this.pointsCount()||null===this._currentMovingPoint||void 0===this._currentMovingPoint.logical||null===this._startMovingPoint||void 0===this._startMovingPoint.logical)return!1
;const i=this._currentMovingPoint.logical.index-this._startMovingPoint.logical.index,r=this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price,n=e[1];return n.index=n.index+i,n.price+=r,e[1]=n,!0}_onPointsetUpdated(e){super._onPointsetUpdated(e),0!==e.length&&(1===this._points.length&&this._points.push(this._points[0]),this._dragStartLeftEdgeIndex=this.points()[1].index)}_normalizePoint(e,t){var i;return 0===t&&null!==(i=super._normalizePointWithoutOffset(e))&&void 0!==i?i:super._normalizePoint(e,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,305733))).CalloutDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new r.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new o.LineToolColorsProperty([e.childs().color]))}_calculateBarOffset(){this.points().length>1&&(this._barOffset=this.points()[1].index-this.points()[0].index)}}},198075:(e,t,i)=>{i.d(t,{LineToolCircle:()=>l});var r=i(658843),n=i(262624),o=i(23666),s=i(89282);class l extends s.InplaceTextLineDataSource{constructor(e,t,r,n){const o=t||l.createProperties();super(e,o,r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,325039)).then((({CirclePaneView:t})=>{const i=[new t(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this))];this._setPaneViews(i)}))}pointsCount(){return 2}name(){return"Circle"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}snapTo45DegreesAvailable(){return!0}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor,textVisible:e.showLabel}}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolcircle",state:e});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,894451))).EllipseCircleDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new r.Property("")),e.addChild("linesColors",new o.LineToolColorsProperty([e.childs().color])),e.addChild("linesWidths",new o.LineToolWidthsProperty([e.childs().linewidth])),e.addChild("backgroundsColors",new o.LineToolColorsProperty([e.childs().backgroundColor])),e.addChild("textsColors",new o.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExcludedKey("linesColors",3),e.addExcludedKey("linesWidths",3),e.addExcludedKey("backgroundsColors",3),e.addExcludedKey("textsColors",3),e.addExcludedKey("text",1)}}},242430:(e,t,i)=>{i.d(t,{LineToolComment:()=>o});var r=i(262624),n=i(418998);class o extends n.LineToolBalloon{constructor(e,t,i,r){
super(e,t||o.createProperties(),i,r)}name(){return"Comment"}activateEditingOnCreation(){return!0}editableTextProperties(){return{text:this.properties().childs().text,textColor:this.properties().childs().color}}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolcomment",state:e});return o._configureProperties(t),t}_normalizePoint(e,t){var i;return null!==(i=super._normalizePointWithoutOffset(e))&&void 0!==i?i:super._normalizePoint(e,t)}_createPaneView(){Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,278991)).then((e=>{this._setPaneViews([new e.CommentPaneView(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this))])}))}}o._defaultText=""},490210:(e,t,i)=>{i.d(t,{LineToolCrossLine:()=>l});var r=i(262624),n=i(667542),o=i(285607),s=i(929927);class l extends s.LineDataSource{constructor(e,t,r,s){super(e,t||l.createProperties(),r,s),this._priceAxisView=new n.LineToolHorzLinePriceAxisView(this),this._timeAxisView=new o.LineToolVertLineTimeAxisView(this),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,350302)).then((({CrossLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Cross Line"}priceAxisViews(e,t){return this.isSourceHidden()?null:t===this.priceScale()&&this.properties().childs().showPrice.value()&&this._model.paneForSource(this)===e?[this._priceAxisView]:null}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e),this._timeAxisView.update()}canHasAlert(){return!1}lineColor(){return this.properties().childs().linecolor.value()}lineWidth(){return this.properties().childs().linewidth.value()}lineStyle(){return this.properties().childs().linestyle.value()}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolcrossline",state:e});return this._configureProperties(t),t}_normalizePoint(e,t){var i;return null!==(i=super._normalizePointWithoutOffset(e))&&void 0!==i?i:super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,263741)).then((e=>e.CrossLineDefinitionsViewModel))}}},417667:(e,t,i)=>{i.d(t,{CustomEventItem:()=>o,LineToolCustomUrlEvent:()=>s});var r=i(650151),n=i(494927);class o{constructor(e){this._source=e}position(){return this._props().childs().position.value()}_props(){return this._source.properties()}}class s extends n.LineToolWithRelativePriceCoordinate{constructor(){super(...arguments),this._item=null,this._eventTimePointIndex=null}pointsCount(){return 1}cloneable(){return!1}eventTimePointIndex(){return this._eventTimePointIndex}customEvent(){return this._item}restorePoints(e,t,i){i&&t.length>0&&(this._eventTimePointIndex=t[0].index),
super.restorePoints(e,t,i)}priceAxisPoints(){return[]}snapTo45DegreesAvailable(){return!0}snapPoint45Degree(e,t,i){this._eventTimePointIndex&&(e.index=this._eventTimePointIndex)}_baseSeriesIndexForPoint(e){var t;return null!==(t=this._eventTimePointIndex)&&void 0!==t?t:e.index}_alignPointHorizontallyOrVertically(e){var t,i;if(null===this._eventTimePointIndex)return e;const n=this._points[0].index-this._eventTimePointIndex,o=(0,r.ensure)(null===(i=null===(t=this._startMovingPoint)||void 0===t?void 0:t.logical)||void 0===i?void 0:i.index)-n;return{price:e.price,index:o}}_allowChangeAnchorHorizontally(){return!0}_pointsForPointset(){return[[(0,r.ensureNotNull)(this._item).time(),0],...super._pointsForPointset()]}_onPointsetUpdated(e){if(0===e.length)return;const t=e.findIndex((e=>0===e.index));-1!==t&&(this._eventTimePointIndex=e[t].value[0]);const i=e.slice(1).map((e=>({value:e.value,index:e.index-1})));super._onPointsetUpdated(i)}_readyToCreatePointset(){return super._readyToCreatePointset()&&null!==this._item}}},231001:(e,t,i)=>{i.d(t,{LineToolCypherPattern:()=>o});var r=i(462723),n=i(262624);class o extends r.LineTool5PointsPattern{constructor(e,t,i,r){super(e,t||o.createProperties(),i,r)}name(){return"Cypher Pattern"}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolcypherpattern",state:e});return this._configureProperties(t),t}_loadPaneViews(e){Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,657352)).then((t=>{this._setPaneViews([new t.CypherPaneView(this,e)])}))}}},422997:(e,t,i)=>{i.d(t,{DateAndPriceBaseProperties:()=>_,allPropertiesStateKeysBase:()=>d,nonThemedFactoryDefaultsBase:()=>u,themedFactoryDefaultsBase:()=>h});var r=i(960095),n=i(61499),o=i(432059),s=i(985429),l=i(658843),a=i(825446);const c=(0,r.getHexColorByName)("color-tv-blue-500"),u={linewidth:2,fontsize:12,fillLabelBackground:!0,fillBackground:!0,backgroundTransparency:60,showVolume:!0,intervalsVisibilities:{...s.intervalsVisibilitiesDefaults},customText:{visible:!1,fontsize:12,bold:!1,italic:!1}},h=new Map([[n.StdTheme.Light,{textcolor:(0,r.getHexColorByName)("color-black"),labelBackgroundColor:(0,r.getHexColorByName)("color-white"),linecolor:c,backgroundColor:(0,o.generateColor)(c,85),shadow:"rgba(0, 0, 0, 0.2)",customText:{color:c}}],[n.StdTheme.Dark,{textcolor:(0,r.getHexColorByName)("color-white"),labelBackgroundColor:(0,r.getHexColorByName)("color-cold-gray-800"),linecolor:c,backgroundColor:(0,o.generateColor)(c,85),shadow:"rgba(0, 0, 0, 0.4)",customText:{color:c}}]]),d=["customText.text"];function p(e){const{showVolume:t=!0,...i}=e;return{...i,showVolume:t}}class _ extends a.LineDataSourceProperty{constructor({nonThemedDefaultsKeys:e,themedDefaultsKeys:t,state:i,...r}){var n,o;super({nonThemedDefaultsKeys:e,themedDefaultsKeys:t,templateKeys:[...null!=e?e:[],...null!=t?t:[],...d],state:i?p(i):void 0,...r});const s=null==i?void 0:i.customText;this._textProperty=new l.Property(null!==(n=null==s?void 0:s.text)&&void 0!==n?n:""),
null===(o=this.childs().customText)||void 0===o||o.addChild("text",this._textProperty)}template(){const e=super.template();return e.customText.text=this._textProperty.value(),e}}},261609:(e,t,i)=>{i.d(t,{LineToolDateAndPriceRange:()=>y});var r=i(650151),n=i(929927),o=i(259638),s=i(61499),l=i(960095),a=i(262624),c=i(714512),u=i(436687),h=i(422997);const d=(0,l.getHexColorByName)("color-tv-blue-500"),p={...h.nonThemedFactoryDefaultsBase,drawBorder:!1,borderWidth:1},_=new Map([[s.StdTheme.Light,{...h.themedFactoryDefaultsBase.get(s.StdTheme.Light),borderColor:d}],[s.StdTheme.Dark,{...h.themedFactoryDefaultsBase.get(s.StdTheme.Dark),borderColor:d}]]),P=(0,a.extractThemedColors)((0,r.ensureDefined)(_.get(s.StdTheme.Light)),(0,r.ensureDefined)(_.get(s.StdTheme.Dark))),v=(0,a.extractAllPropertiesKeys)((0,r.ensureDefined)(_.get(s.StdTheme.Light))),m=(0,a.extractAllPropertiesKeys)(p),g=[...new Set([...v,...m,...u.commonLineToolPropertiesStateKeys,...h.allPropertiesStateKeysBase])];class f extends h.DateAndPriceBaseProperties{static create(e){return new this({defaultName:"linetooldateandpricerange",factoryDefaultsSupplier:()=>(0,c.factoryDefaultsForCurrentTheme)(p,_),nonThemedDefaultsKeys:m,themedDefaultsKeys:v,allStateKeys:g,themedColors:P,replaceThemedColorsOnThemeChange:!0,state:e})}}class y extends n.LineDataSource{constructor(e,t,r,n){super(e,t||y.createProperties(),r,n),this._volumeCalculator=null,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,947133)).then((e=>{this._setPaneViews([new e.DateAndPriceRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date and Price Range"}template(){return this._properties.template()}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,r.assert)(null===this._volumeCalculator),this._volumeCalculator=new o.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e){const t=f.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,922040))).GeneralDatePriceRangeDefinitionsViewModel}}},936638:(e,t,i)=>{i.d(t,{LineToolDateRange:()=>g});var r=i(650151),n=i(929927),o=i(259638),s=i(61499),l=i(262624),a=i(714512),c=i(422997),u=i(436687);const h={...c.nonThemedFactoryDefaultsBase,extendTop:!1,extendBottom:!1},d=c.themedFactoryDefaultsBase,p=(0,l.extractThemedColors)((0,r.ensureDefined)(d.get(s.StdTheme.Light)),(0,r.ensureDefined)(d.get(s.StdTheme.Dark))),_=(0,l.extractAllPropertiesKeys)((0,r.ensureDefined)(d.get(s.StdTheme.Light))),P=(0,l.extractAllPropertiesKeys)(h),v=[...new Set([..._,...P,...u.commonLineToolPropertiesStateKeys,...c.allPropertiesStateKeysBase])]
;class m extends c.DateAndPriceBaseProperties{static create(e){return new this({defaultName:"linetooldaterange",factoryDefaultsSupplier:()=>(0,a.factoryDefaultsForCurrentTheme)(h,d),nonThemedDefaultsKeys:P,themedDefaultsKeys:_,allStateKeys:v,themedColors:p,replaceThemedColorsOnThemeChange:!0,state:e})}}class g extends n.LineDataSource{constructor(e,t,r,n){super(e,t||g.createProperties(),r,n),this._volumeCalculator=null,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,555993)).then((e=>{this._setPaneViews([new e.DateRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date Range"}template(){return this._properties.template()}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,r.assert)(null===this._volumeCalculator),this._volumeCalculator=new o.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e){const t=m.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,922040))).GeneralDatePriceRangeDefinitionsViewModel}}},612574:(e,t,i)=>{i.d(t,{LineToolDisjointChannel:()=>l});var r=i(929927),n=i(262624),o=i(124829),s=i(658843);class l extends r.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:l.createProperties(),r,n),this.version=1,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,504756)).then((e=>{this._setPaneViews([new e.DisjointChannelPaneView(this,this._model)])}))}pointsCount(){return 3}name(){return"Disjoint Channel"}hasEditableCoordinates(){return!1}snapTo45DegreesAvailable(){return!0}addPoint(e,t,i){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i,r){const n=.5*(this._points[1].price+this._points[2].price);if(this._snapTo45DegreesApplicable(i)&&1===e){const e=0;this.snapPoint45Degree(t,this.points()[e])}if(e<3&&super.setPoint(e,t),0!==e&&2!==e){if(1===e){const e=this._points[1].price-n;this._points[2].price=this._points[1].price-2*e}else if(3===e){const e=t.price-this._points[2].price;this._points[0].price=this._points[1].price-e,this._points[0].index=t.index,this._points[0].interval=this._model.mainSeries().interval()}this._normalizePoints()}}getPoint(e){if(e<3)return super.getPoint(e);const t=this._points[0].price-this._points[2].price;return{index:this._points[0].index,price:this._points[1].price-t}}canHasAlert(){return!0}template(){
const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetooldisjointangle",state:e});return this._configureProperties(t),t}_applyTemplateImpl(e){var t;super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(null!==(t=e.labelText)&&void 0!==t?t:"")}_getAlertPlots(){const e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));const r=this._points[2];r.time=t.time,r.index=t.index;const n={price:r.price+(t.price-e.price),time:e.time,index:e.index},s=[];let l,a,c,u;r.index<=n.index?(s.push(r),s.push(n)):(s.push(n),s.push(r)),i[0].price>s[0].price?(l=i,a=s):s[0].price>i[0].price||s[1].price>i[1].price?(l=s,a=i):(l=i,a=s);const h=this.properties().childs().extendLeft.value(),d=this.properties().childs().extendRight.value();return e.index<=t.index?(c=h,u=d):(c=d,u=h),[this._linePointsToAlertPlot(l,"Upper",c,u),this._linePointsToAlertPlot(a,"Lower",c,u)].filter(o.notNull)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,73932))).GeneralTrendFiguresDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new s.Property("")),e.addExcludedKey("labelText",1)}}},487416:(e,t,i)=>{i.d(t,{LineToolElliott:()=>p,LineToolElliottCorrection:()=>x,LineToolElliottDoubleCombo:()=>b,LineToolElliottImpulse:()=>v,LineToolElliottTriangle:()=>g,LineToolElliottTripleCombo:()=>y});var r=i(444372),n=i(370407),o=i(929927),s=i(691371),l=i(262624),a=i(23666),c=i(469805);const u=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],h=new n.TranslatedString("change Elliott degree",r.t(null,void 0,i(547977))),d=[{value:0,title:r.t(null,void 0,i(203348))},{value:1,title:r.t(null,void 0,i(487957))},{value:2,title:r.t(null,void 0,i(863375))},{value:3,title:r.t(null,void 0,i(357726))},{value:4,title:r.t(null,void 0,i(467948))},{value:5,title:r.t(null,void 0,i(787380))},{value:6,title:r.t(null,void 0,i(259189))},{value:7,title:r.t(null,void 0,i(410268))},{value:8,title:r.t(null,{context:"wave"},i(651077))},{value:9,title:r.t(null,{context:"wave"},i(200922))},{value:10,title:r.t(null,void 0,i(214724))},{value:11,title:r.t(null,void 0,i(230585))},{value:12,title:r.t(null,void 0,i(324866))},{value:13,title:r.t(null,void 0,i(201145))},{value:14,title:r.t(null,void 0,i(78273))}];class p extends o.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:p.createProperties(),r,n),this.version=4,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,163050)).then((e=>{this._setPaneViews([new e.ElliottLabelsPaneView(this,this._model)])}))}migrateVersion(e,t,i){if(i.properties.hasChild("background")&&i.properties.removeProperty("background"),i.properties.hasChild("backgroundColor")&&i.properties.removeProperty("backgroundColor"),
i.properties.hasChild("showBackground")&&i.properties.removeProperty("showBackground"),1===e){const e=Object.assign({},this._timePoint[0]);if(this._timePoint.unshift(e),this._points.length>0){const e=Object.assign({},this._points[0]);this._points.unshift(e)}}}applyTemplate(e){const t=e;delete t.background,delete t.backgroundColor,delete t.showBackground,super.applyTemplate(e)}name(){return"Elliott Labels"}additionalActions(e){return[new s.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",options:{label:r.t(null,void 0,i(623403)),subItems:u.map((t=>{const i=d.filter((e=>e.value===t))[0];return new s.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",options:{label:i.title,checkable:!0,checked:this.properties().childs().degree.value()===t,onExecute:()=>{e.setProperty(this.properties().childs().degree,t,h,c.lineToolsDoNotAffectChartInvalidation)}}})}))}})]}label(e){const t=u.length-this.properties().childs().degree.value()-1,i=Math.floor(t/3);return{group:i,bold:!!(i%2),decoration:["","brackets","circle"][t%3],label:this.labelsGroup()[i][e]}}availableDegreesValues(){return d}static createProperties(e){const t=new l.DefaultProperty({defaultName:"linetoolelliott",state:e});return this._configureProperties(t),t}static migrateState(e){const t={0:11,1:10,2:9,3:8,4:7,5:6,6:5,7:4,8:3},i={0:11,1:8};"LineToolElliottSubminuette"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinor"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottCircle"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize]),"LineToolElliottMajorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize])}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,246119))).ElliottPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addExcludedKey("linesColors",3)}}class _ extends p{pointsCount(){return 6}}const P=[["0","1","2","3","4","5"],["0","i","ii","iii","iv","v"],["0","1","2","3","4","5"],["0","I","II","III","IV","V"],["0","1","2","3","4","5"]];class v extends _{constructor(e,t,i,r){super(e,t||v.createProperties(),i,r)}name(){return"Elliott Impulse Wave (12345)"}labelsGroup(){return P}static createProperties(e){const t=new l.DefaultProperty({defaultName:"linetoolelliottimpulse",state:e});return this._configureProperties(t),t}}const m=[["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"]];class g extends _{constructor(e,t,i,r){super(e,t||g.createProperties(),i,r)}name(){return"Elliott Triangle Wave (ABCDE)"}labelsGroup(){return m}static createProperties(e){const t=new l.DefaultProperty({
defaultName:"linetoolelliotttriangle",state:e});return this._configureProperties(t),t}}const f=[["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"]];class y extends _{constructor(e,t,i,r){super(e,null!=t?t:y.createProperties(),i,r)}name(){return"Elliott Triple Combo Wave (WXYXZ)"}labelsGroup(){return f}static createProperties(e){const t=new l.DefaultProperty({defaultName:"linetoolelliotttriplecombo",state:e});return this._configureProperties(t),t}}class T extends p{pointsCount(){return 4}}const C=[["0","A","B","C"],["0","a","b","c"],["0","A","B","C"],["0","a","b","c"],["0","A","B","C"]];class x extends T{constructor(e,t,i,r){super(e,null!=t?t:x.createProperties(),i,r)}name(){return"Elliott Correction Wave (ABC)"}labelsGroup(){return C}static createProperties(e){const t=new l.DefaultProperty({defaultName:"linetoolelliottcorrection",state:e});return this._configureProperties(t),t}}const w=[["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"]];class b extends T{constructor(e,t,i,r){super(e,null!=t?t:b.createProperties(),i,r)}name(){return"Elliott Double Combo Wave (WXY)"}labelsGroup(){return w}static createProperties(e){const t=new l.DefaultProperty({defaultName:"linetoolelliottdoublecombo",state:e});return this._configureProperties(t),t}}},196103:(e,t,i)=>{i.d(t,{LineToolEllipse:()=>u});var r=i(650151),n=i(204652),o=i(86441),s=i(658843),l=i(262624),a=i(23666),c=i(89282);class u extends c.InplaceTextLineDataSource{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this._radius2=0,this._fakePoint=null,this.version=2,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,899672)).then((({EllipsePaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this))])}))}snapTo45DegreesAvailable(){return!0}startChanging(e,t){super.startChanging(e,t),this._radius2=(0,n.distanceToLine)(this._screenPoint(0),this._screenPoint(1),this._screenPoint(2)).distance}addPoint(e,t,i){let r;const n=1===this._points.length?this._preparePoint(e,t):e;return r=this._addPointIntenal(n,t,i),2===this._points.length&&this._snapTo45DegreesApplicable(t)&&(r=this._addPointIntenal(this._calcPoint2(),t,i)),r&&(this._fakePoint=null),r}setPoint(e,t,i,s){const l={...t},a=this._model.mainSeries().interval();switch(e){case 0:case 1:const t=this._snapTo45DegreesApplicable(i);t&&this.snapPoint45Degree(l,this._points[0===e?1:0]),this._setPoint(e,{...l,interval:a}),this._setPoint(2,{...this._calcPoint2(void 0,void 0,t?void 0:this._radius2),interval:a}),t&&this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[0===e?0:1],this._points[0===e?1:0],this._points[2]);break;case 2:case 3:const s=this._screenPoint(0),c=this._screenPoint(1),u=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),h=(0,
n.distanceToLine)(s,c,u).distance,d=c.subtract(s),p=s.add(c).scaled(.5),_=new o.Point(-d.y,d.x).normalized(),P=p.add(_.scaled(h));this._setPoint(2,{...(0,r.ensureNotNull)(this.screenPointToPoint(P)),interval:a})}this._normalizePoints()}points(){const e=super.points();return 2===e.length&&this._fakePoint&&e.push(this._fakePoint),e}pointsCount(){return 3}name(){return"Ellipse"}hasEditableCoordinates(){return!1}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._model.mainSeries().interval(),t=this._points[0].price,i=.5*(this._points[0].price+this._points[1].price);this._points[0]={price:i,index:this._points[0].index,interval:e},this._points[1]={price:i,index:this._points[1].index,interval:e},this._points.push({price:t,index:this._points[0].index,interval:e})}if(1===e&&2===this._timePoint.length){const e=this._timePoint[0].price,t=.5*(this._timePoint[0].price+this._timePoint[1].price);this._timePoint[0].price=t,this._timePoint[1].price=t;const i={price:e,offset:this._timePoint[0].offset,time_t:this._timePoint[0].time_t,interval:this._properties.childs().interval.value()};this._timePoint.push(i)}}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor,textVisible:e.showLabel}}static createProperties(e){const t=new l.DefaultProperty({defaultName:"linetoolellipse",state:e});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,894451))).EllipseCircleDefinitionsViewModel}_preparePoint(e,t){var i;const r=this._preparePointInternal(e,this._points[0],t),n=null!==(i=this._points[1])&&void 0!==i?i:this._lastPoint;return this._snapTo45DegreesApplicable(t)&&this._points[0].index===n.index&&this._fixVerticalDiameterPoints(n,this._points[0],r),r}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new s.Property("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExcludedKey("text",1)}_preparePointInternal(e,t,i){const n={...e};return this._fakePoint=null,this._snapTo45DegreesApplicable(i)&&1===this._points.length&&(this.snapPoint45Degree(n,t),this._fakePoint=this._calcPoint2((0,r.ensureNotNull)(this.pointToScreenPoint(t)),(0,r.ensureNotNull)(this.pointToScreenPoint(n)))),n}_fixVerticalDiameterPoints(e,t,i){const n=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),s=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),l=this._model.timeScale(),a=l.indexToCoordinate(e.index),c=l.indexToCoordinate(i.index);let u=2*Math.abs(a-c);u*=t.price>e.price?1:-1,e.price=(0,r.ensureNotNull)(this.screenPointToPoint(new o.Point(n.x,s.y+u))).price}_calcPoint2(e,t,i){e=null!=e?e:this._screenPoint(0),
t=null!=t?t:this._screenPoint(1);const n=Math.atan2(t.y-e.y,t.x-e.x)+Math.PI/2;i=null!=i?i:t.subtract(e).length()/2;const s=e.add(t).scaled(.5).add(new o.Point(Math.cos(n)*i,Math.sin(n)*i));return(0,r.ensureNotNull)(this.screenPointToPoint(s))}_screenPoint(e){return(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[e]))}}},471133:(e,t,i)=>{i.d(t,{LineToolEmoji:()=>C});var r=i(524561),n=i(338619),o=i(702598),s=i(419283),l=i(965251),a=i(18686),c=i(154834),u=i(998034),h=i(825446),d=i(985429),p=i(262624),_=i(436687);const P={intervalsVisibilities:{...d.intervalsVisibilitiesDefaults},size:40},v={emoji:"😀",angle:.5*Math.PI},m=(0,p.extractAllPropertiesKeys)(P),g=(0,p.extractAllPropertiesKeys)(v),f=[...new Set([...g,...m,..._.commonLineToolPropertiesStateKeys])];class y extends h.LineDataSourceProperty{constructor(e){super(e)}static create(e,t){return new this({defaultName:"linetoolemoji",factoryDefaultsSupplier:()=>(0,c.default)(P),nonThemedDefaultsKeys:m,themedDefaultsKeys:[],state:(0,u.default)({},v,{emoji:t},null!=e?e:{}),allStateKeys:f})}}const T=(0,n.getLogger)("Chart.LineToolEmoji");class C extends a.LineToolSvgIconBase{constructor(e,t,i,r){super(e,t||C.createProperties(),i,r),this.version=1,this._loadViews()}name(){return"Emoji"}template(){return this.properties().template()}static createProperties(e){const t=y.create(e,s.emojiTool.value());return C._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,296501))).LineDataSourceDefinitionsViewModel}async _loadViews(){const e=this._properties.childs().emoji.value(),t=(0,r.getTwemojiUrl)(e,"svg");try{const[r,{EmojiPaneView:n}]=await Promise.all([(0,o.fetch)(t).then((e=>e.text())),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,927808))]);if(!this._isDestroyed){this._svgContent=r,this._onIconChanged.fire();const t=(0,l.svgRenderer)(r);null===t&&T.logWarn(`Couldn't create svg renderer for emoji ${e}`),this._setPaneViews([new n(this,this._model,t)])}}catch(t){T.logWarn(`An error ocurred while loading emoji content ${e}: ${t}`)}}}},481673:(e,t,i)=>{i.d(t,{LineToolExtended:()=>n});var r=i(815259);class n extends r.LineToolTrendLine{constructor(e,t,i,r){super(e,null!=t?t:n.createProperties(),i,r)}name(){return"Extended Line"}static createProperties(e){const t=r.LineToolTrendLine._createPropertiesImpl("linetoolextended",e);return n._configureProperties(t),t}}},954578:(e,t,i)=>{i.d(t,{LineToolFibWithInplaceTextBase:()=>c,getLevelProps:()=>l});var r=i(650151),n=i(658843),o=i(89282);const s=new n.Property(!1);function l(e,t){return(0,r.ensureDefined)(e.child(`level${t}`))}class a extends o.InplaceTextUndoCommand{constructor(e,t,i,r,n){super(e,t,i,r),this._levelIndex=n}_textProperty(e){return l(e.properties(),this._levelIndex).childs().text}}class c extends o.InplaceTextLineDataSource{constructor(){super(...arguments),this._inplaceEditLevelIndex=1}editableTextStyle(){return{
...super.editableTextStyle(),forbidLineBreaks:!0,maxLength:50}}editableTextProperties(){const e=this.properties().childs();return{text:e.editableText,textColor:e.editableTextColor,wordWrap:s}}setInplaceEditLevelIndex(e){var t;null===(t=this._destroyEditableTextSubscriptions)||void 0===t||t.call(this);const i=this.properties(),n=i.childs().editableText,o=i.childs().editableTextColor,s=l(i,e),a=(0,r.ensureDefined)(s).childs().text,c=(0,r.ensureDefined)(s).childs().color,u={};n.setValue(a.value()),o.setValue(c.value()),n.subscribe(u,(()=>a.setValue(n.value()))),a.subscribe(u,(()=>n.setValue(a.value()))),o.subscribe(u,(()=>c.setValue(o.value()))),c.subscribe(u,(()=>o.setValue(c.value()))),this._destroyEditableTextSubscriptions=()=>{n.unsubscribeAll(u),a.unsubscribeAll(u),o.unsubscribeAll(u),c.unsubscribeAll(u)},this._inplaceEditLevelIndex=e,this._editableText.setValue(n.value())}_changeEditableTextUndoCommand(e,t){return new a(this._model,this,e,t,this._inplaceEditLevelIndex)}static _configureProperties(e){super._configureProperties(e),e.addChild("editableText",new n.Property("")),e.addChild("editableTextColor",new n.Property("")),e.addExcludedKey("editableText",3),e.addExcludedKey("editableTextColor",3)}}},267961:(e,t,i)=>{i.d(t,{LineToolFibChannel:()=>h});var r=i(650151),n=i(444372),o=i(370407),s=i(469805),l=i(329944),a=i(23666),c=i(89282);const u=new o.TranslatedString("erase level line",n.t(null,void 0,i(735111)));class h extends c.InplaceTextLineDataSource{constructor(e,t,r,n){super(e,t||h.createProperties(),r,n),this.version=2,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,435734)).then((({FibChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 24}migrateVersion(e,t,i){i.properties.removeProperty("reverse")}pointsCount(){return 3}name(){return"Fib Channel"}processErase(e,t){const i="level"+t,r=this.properties().child(i).childs().visible;e.setProperty(r,!1,u,s.lineToolsDoNotAffectChartInvalidation)}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}static createProperties(e){const t=new l.LevelsProperty({defaultName:"linetoolfibchannel",state:e,map:{range:[1,24],names:["coeff","color","visible"]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,763420))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[];for(let i=1;i<=24;i++){const n=(0,r.ensureDefined)(e.child("level"+i));t.push((0,r.ensureDefined)(n.child("color")))}e.addChild("linesColors",new a.LineToolColorsProperty(t))}}},992344:(e,t,i)=>{i.d(t,{LineToolFibCircles:()=>h});var r=i(650151),n=i(444372),o=i(370407),s=i(329944),l=i(23666),a=i(469805),c=i(89282);const u=new o.TranslatedString("erase level line",n.t(null,void 0,i(735111)));class h extends c.InplaceTextLineDataSource{constructor(e,t,r,n){
super(e,t||h.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,809285)).then((e=>{this._setPaneViews([new e.FibCirclesPaneView(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 2}name(){return"Fib Circles"}processErase(e,t){const i=(0,r.ensureDefined)(this.properties().child(`level${t}`));e.setProperty(i,!1,u,a.lineToolsDoNotAffectChartInvalidation)}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}snapTo45DegreesAvailable(){return!0}static createProperties(e){const t=new s.LevelsProperty({defaultName:"linetoolfibcircles",state:e,map:{range:[1,11]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,144284))).FibCirclesDefinitionsViewModel}static _configureProperties(e){var t,i;super._configureProperties(e);const n=e.childs(),o=[n.trendline.childs().linewidth],s=[n.trendline.childs().color];for(let n=1;n<=11;n++)o.push((0,r.ensureDefined)(null===(t=e.child("level"+n))||void 0===t?void 0:t.child("linewidth"))),s.push((0,r.ensureDefined)(null===(i=e.child("level"+n))||void 0===i?void 0:i.child("color")));e.addChild("linesColors",new l.LineToolColorsProperty(s)),e.addChild("linesWidths",new l.LineToolWidthsProperty(o))}}},739988:(e,t,i)=>{i.d(t,{LineToolFibRetracement:()=>u});var r=i(444372),n=i(370407),o=i(329944),s=i(469805),l=i(23666),a=i(954578);const c=new n.TranslatedString("erase level line",r.t(null,void 0,i(735111)));class u extends a.LineToolFibWithInplaceTextBase{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=2,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,741004)).then((e=>{this._paneView=new e.FibRetracementPaneView(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this)),this._setPaneViews([this._paneView])}))}levelsCount(){return 24}pointsCount(){return 2}name(){return"Fib Retracement"}migrateVersion(e){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,{visible:r}=this.properties().childs()[i].childs();e.setProperty(r,!1,c,s.lineToolsDoNotAffectChartInvalidation)}fibLevelsBasedOnLogScale(){var e;return this.properties().childs().fibLevelsBasedOnLogScale.value()&&!!(null===(e=this.priceScale())||void 0===e?void 0:e.isLog())}template(){const e=super.template();for(let t=1;t<=24;t++){const i=(0,a.getLevelProps)(this._properties,t);e[`level${t}`].text=i.childs().text.value()}return e}static createProperties(e){const t=new o.LevelsProperty({defaultName:"linetoolfibretracement",state:e,map:{range:[1,24],names:["coeff","color","visible","text"]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,763420))).FibDrawingsWith24LevelsDefinitionsViewModel}_applyTemplateImpl(e){var t,i;for(let r=1;r<=24;r++){const n=(0,a.getLevelProps)(this._properties,r),o=e[`level${r}`];n.childs().text.setValue(null!==(i=null!==(t=o.text)&&void 0!==t?t:o[3])&&void 0!==i?i:"")}super._applyTemplateImpl(e)}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().trendline.childs().linewidth,e.childs().levelsStyle.childs().linewidth],i=[e.childs().trendline.childs().color];for(let t=1;t<=24;t++){const r=(0,a.getLevelProps)(e,t);i.push(r.childs().color),e.addExcludedKey(`level${t}.text`,1)}e.addChild("linesColors",new l.LineToolColorsProperty(i)),e.addChild("linesWidths",new l.LineToolWidthsProperty(t))}}},597531:(e,t,i)=>{i.d(t,{LineToolFibSpeedResistanceArcs:()=>h});var r=i(650151),n=i(444372),o=i(370407),s=i(329944),l=i(23666),a=i(469805),c=i(89282);const u=new o.TranslatedString("erase level line",n.t(null,void 0,i(735111)));class h extends c.InplaceTextLineDataSource{constructor(e,t,r,n){super(e,null!=t?t:h.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,49350)).then((e=>{this._setPaneViews([new e.FibSpeedResistanceArcsPaneView(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 2}name(){return"Fib Speed Resistance Arcs"}processErase(e,t){const i=(0,r.ensureDefined)(this.properties().child(`level${t}`)).childs().visible;e.setProperty(i,!1,u,a.lineToolsDoNotAffectChartInvalidation)}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}static createProperties(e){const t=new s.LevelsProperty({defaultName:"linetoolfibspeedresistancearcs",state:e,map:{range:[1,11]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,743782))).FibSpeedResistanceArcsDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs().trendline.childs(),i=[t.linewidth],n=[t.color];for(let t=1;t<=11;t++){const o=(0,r.ensureDefined)(e.child(`level${t}`)).childs();i.push(o.linewidth),n.push(o.color)}e.addChild("linesColors",new l.LineToolColorsProperty(n)),e.addChild("linesWidths",new l.LineToolWidthsProperty(i))}}},23565:(e,t,i)=>{i.d(t,{LineToolFibSpeedResistanceFan:()=>h});var r=i(650151),n=i(444372),o=i(370407),s=i(929927),l=i(329944),a=i(23666),c=i(469805);const u=new o.TranslatedString("erase level line",n.t(null,void 0,i(735111)));class h extends s.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:h.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,689645)).then((e=>{this._setPaneViews([new e.FibSpeedResistanceFanPaneView(this,this._model)])}))}hLevelsCount(){return 7}vLevelsCount(){return 7}pointsCount(){return 2}name(){
return"Fib Speed Resistance Fan"}processErase(e,t){const i=`${t.type}level${t.index}`,n=(0,r.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(n,!1,u,c.lineToolsDoNotAffectChartInvalidation)}snapTo45DegreesAvailable(){return!0}static createProperties(e){e&&void 0===e.reverse&&(e.reverse=!0);const t=new l.LevelsProperty({defaultName:"linetoolfibspeedresistancefan",state:e,map:{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,979584))).FibSpeedResistanceFanDefinitionsViewModel}static _configureProperties(e){var t,i;super._configureProperties(e);const n=[e.childs().grid.childs().color];for(let i=1;i<=7;i++)n.push((0,r.ensureDefined)(null===(t=e.child(`hlevel${i}`))||void 0===t?void 0:t.child("color")));for(let t=1;t<=7;t++)n.push((0,r.ensureDefined)(null===(i=e.child(`vlevel${t}`))||void 0===i?void 0:i.child("color")));e.addChild("linesColors",new a.LineToolColorsProperty(n)),e.addExcludedKey("linesColors",3)}}},924163:(e,t,i)=>{i.d(t,{LineToolFibTimeZone:()=>u});var r=i(444372),n=i(370407),o=i(23666),s=i(329944),l=i(469805),a=i(929927);const c=new n.TranslatedString("erase level line",r.t(null,void 0,i(735111)));class u extends a.LineDataSource{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=2,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,280363)).then((({FibTimeZonePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}migrateVersion(e,t,i){if(1===e){const e=i.properties.childs(),t=i.properties,r=t.baselinecolor.value(),n=t.linecolor.value(),o=t.linewidth.value(),s=t.linestyle.value();e.level1.childs().color.setValue(r);for(let t=2;t<=11;t++)e["level"+t].childs().color.setValue(n);for(let t=1;t<=11;t++)e["level"+t].childs().linewidth.setValue(o),e["level"+t].childs().linestyle.setValue(s)}}pointsCount(){return 2}name(){return"Fib Time Zone"}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,c,l.lineToolsDoNotAffectChartInvalidation)}static createProperties(e){const t=new s.LevelsProperty({defaultName:"linetoolfibtimezone",state:e,map:{range:[1,11]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,314264))).FibTimezoneDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[],i=[],r=[];for(let n=1;n<=11;n++){const o=e.childs()["level"+n].childs();t.push(o.linewidth),i.push(o.color),r.push(o.linestyle)}e.addChild("linesColors",new o.LineToolColorsProperty(i)),e.addChild("linesWidths",new o.LineToolWidthsProperty(t)),e.addChild("linesStyles",new o.LineToolCollectedProperty(r)),e.hasChild("baselinecolor")&&e.removeProperty("baselinecolor"),
e.hasChild("linecolor")&&e.removeProperty("linecolor"),e.hasChild("linewidth")&&e.removeProperty("linewidth"),e.hasChild("linestyle")&&e.removeProperty("linestyle")}}},624711:(e,t,i)=>{i.d(t,{LineToolFibWedgeBase:()=>s});var r=i(650151),n=i(86441),o=i(89282);class s extends o.InplaceTextLineDataSource{pointsCount(){return 3}hasEditableCoordinates(){return!1}setPoint(e,t){if(super.setPoint(e,t),!this._recursiveGuard)try{if(this._recursiveGuard=!0,2===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0]));let t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));const i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2])).subtract(e).length();let o=t.subtract(e);o.length()<=0&&(o=new n.Point(1,0)),t=e.add(o.normalized().scaled(i));const s=(0,r.ensureNotNull)(this.screenPointToPoint(t)),l=this._pointsProperty.childs().points[1];l.childs().price.setValue(s.price),l.childs().bar.setValue(s.index)}else{const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));const o=t.subtract(e).length();let s=i.subtract(e);s.length()<=0&&(s=new n.Point(1,0)),i=e.add(s.normalized().scaled(o));const l=(0,r.ensureNotNull)(this.screenPointToPoint(i)),a=this._pointsProperty.childs().points[2];a.childs().price.setValue(l.price),a.childs().bar.setValue(l.index)}}finally{this._recursiveGuard=!1}}addPoint(e){if(2===this._points.length){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let n=(0,r.ensureNotNull)(this.pointToScreenPoint(e));const o=i.subtract(t).length(),s=n.subtract(t).normalized();n=t.add(s.scaled(o));const l=(0,r.ensureNotNull)(this.ownerSource()),a=(0,r.ensureNotNull)(l.firstValue()),c=(0,r.ensureNotNull)(this.priceScale()).coordinateToPrice(n.y,a);e={index:Math.round(this._model.timeScale().coordinateToIndex(n.x)),price:c}}return super.addPoint(e)}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}}},670632:(e,t,i)=>{i.d(t,{LineToolFibWedge:()=>h});var r=i(650151),n=i(444372),o=i(370407),s=i(624711),l=i(329944),a=i(23666),c=i(469805);const u=new o.TranslatedString("erase level line",n.t(null,void 0,i(735111)));class h extends s.LineToolFibWedgeBase{constructor(e,t,r,n){super(e,null!=t?t:h.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,562584)).then((e=>{this._setPaneViews([new e.FibWedgePaneView(this,this._model)])}))}levelsCount(){return 11}isSynchronizable(){return!1}name(){return"Fib Wedge"}processErase(e,t){const i=(0,r.ensureDefined)(this.properties().child(`level${t}`));e.setProperty(i.childs().visible,!1,u,c.lineToolsDoNotAffectChartInvalidation)}static createProperties(e){const t=new l.LevelsProperty({defaultName:"linetoolfibwedge",state:e,map:{range:[1,11]}});return this._configureProperties(t),t}
async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,37541))).FibWedgeDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().trendline.childs().linewidth],i=[e.childs().trendline.childs().color];for(let n=1;n<=11;n++){const o=(0,r.ensureDefined)(e.child(`level${n}`));t.push(o.childs().linewidth),i.push(o.childs().color)}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t))}}},191073:(e,t,i)=>{i.d(t,{LineToolFlagMark:()=>l});var r=i(86441),n=i(929927),o=i(262624),s=i(23666);class l extends n.LineDataSource{constructor(e,t,n,o){super(e,t||l.createProperties(),n,o),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,420844)).then((({FlagMarkPaneView:e})=>{const t=new e(this,this.model());t.setAnchors(new r.Point(0,0)),this._setPaneViews([t])}))}pointsCount(){return 1}name(){return"Flag Mark"}static createProperties(e){e&&void 0===e.flagColor&&(e.flagColor="#318757");const t=new o.DefaultProperty({defaultName:"linetoolflagmark",state:e});return this._configureProperties(t),t}_normalizePoint(e,t){var i;return null!==(i=super._normalizePointWithoutOffset(e))&&void 0!==i?i:super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,490156)).then((e=>e.FlagMarkDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new s.LineToolColorsProperty([e.childs().flagColor])),e.addExcludedKey("backgroundsColors",3)}}l.version=2},399643:(e,t,i)=>{i.d(t,{LineToolFlatBottom:()=>l});var r=i(929927),n=i(262624),o=i(124829),s=i(658843);class l extends r.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:l.createProperties(),r,n),this.version=1,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,198736)).then((e=>{this._setPaneViews([new e.FlatBottomPaneView(this,this._model)])}))}pointsCount(){return 3}name(){return"Flat Bottom"}hasEditableCoordinates(){return!1}snapTo45DegreesAvailable(){return!0}addPoint(e,t,i){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i,r){if(this._snapTo45DegreesApplicable(i)&&1===e){const e=0;this.snapPoint45Degree(t,this.points()[e])}const n=this._model.mainSeries().interval();if(2===e)this._points[1].index=t.index,this._points[1].interval=n;else if(3===e)return this._points[0].index=t.index,this._points[0].interval=n,this._points[2].price=t.price,void this._normalizePoints();super.setPoint(e,t)}getPoint(e){
return e<3?super.getPoint(e):3===e?{index:this._points[0].index,price:this._points[2].price}:null}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolflatbottom",state:e});return this._configureProperties(t),t}_applyTemplateImpl(e){var t;super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(null!==(t=e.labelText)&&void 0!==t?t:"")}_getAlertPlots(){const e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));const r=this._points[2];r.time=t.time,r.index=t.index;const n={price:r.price,time:e.time,index:e.index},s=[];let l,a,c,u;r.index<=n.index?(s.push(r),s.push(n)):(s.push(n),s.push(r)),i[0].price>s[0].price?(l=i,a=s):s[0].price>i[0].price||s[1].price>i[1].price?(l=s,a=i):(l=i,a=s);const h=this.properties().childs().extendLeft.value(),d=this.properties().childs().extendRight.value();return e.index<=t.index?(c=h,u=d):(c=d,u=h),[this._linePointsToAlertPlot(l,"Upper",c,u),this._linePointsToAlertPlot(a,"Lower",h,u)].filter(o.notNull)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,73932))).GeneralTrendFiguresDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new s.Property("")),e.addExcludedKey("labelText",1)}}},697876:(e,t,i)=>{i.d(t,{createPropertiesObject:()=>l});var r=i(124829),n=i(329944);function o(e,t,i){var n;for(const o of Object.keys(null!==(n=e.levels)&&void 0!==n?n:{}))if(e.levels[o]&&(0,r.isSameType)(e.levels[o],t.typecheck())){let r=t.tpl();i.names.forEach(((i,n)=>{r=t.fill(""+n,i,e.levels[o],r)})),e.levels[o]=r}return e}class s extends n.LevelsProperty{constructor(e,t){super({defaultName:e,state:t,map:{names:["width","color","visible"]},levelsIterator:o})}}function l(e,t){return new s(e,t)}},342584:(e,t,i)=>{i.d(t,{LineToolGannComplex:()=>h});var r=i(86441),n=i(650151),o=i(832312),s=i(929927),l=i(134392),a=i(697876),c=i(23666),u=i(511275);class h extends s.LineDataSource{constructor(e,t,r,n){super(e,t||h.createProperties(),r,n),this.version=2,this._scaleRatioFormatter=new o.LimitedPrecisionNumericFormatter(7),this.version=2,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,921380)).then((({GannComplexPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}));const s=this.properties();this._adjustScaleRatio(s),s.subscribe(this,this._adjustScaleRatio),s.childs().scaleRatio.subscribe(this,this._correctFirstPoint),this._syncStateExclusions=["scaleRatio"],s.onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.subscribe(this,this._handleTemplateApplying),this._onTemplateApplied.subscribe(this,this._correctFirstPoint)}migrateVersion(e,t,i){
1===e&&(this._points.length>=this.pointsCount()?setTimeout((()=>this._migratePoint())):this._timePoint.length>=this.pointsCount()&&this._pointAdded.subscribe(this,this._migratePoint))}destroy(){const e=this.properties();e.unsubscribe(this,this._adjustScaleRatio),e.childs().scaleRatio.unsubscribe(this,this._correctFirstPoint),e.onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.unsubscribe(this,this._handleTemplateApplying),this._onTemplateApplied.unsubscribe(this,this._correctFirstPoint),super.destroy()}pointsCount(){return 2}name(){return"Gann Square"}addPoint(e,t,i){this._points.length>1&&this._points.pop();const r=super.addPoint(e,t,i),o=this.priceScale();return!(0,n.ensureNotNull)(o).isLog()&&r&&this._correctFirstPoint(),r}setPoint(e,t,i){super.setPoint(e,t,i),void 0!==i&&i.shift()?this._correctPoint(e):this._correctScaleRatio()}setLastPoint(e,t){const i=this.priceScale();return(0,n.ensureNotNull)(i).isLog()||(this._points[1]={...e,interval:this._model.mainSeries().interval()},this._correctPoint(1)),super.setLastPoint(e,t)}isReversed(){return this.properties().childs().reverse.value()}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let r=0;r<i;r++){const i=t.levels.childs()[r].childs();e.push({index:r,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let r=0;r<i;r++){const i=t.fanlines.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let r=0;r<i;r++){const i=t.arcs.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}isLabelsVisible(){return this.properties().childs().showLabels.value()}getLabelsStyle(){const e=this.properties().childs(),{fontSize:t,bold:i,italic:r}=e.labelsStyle.childs(),n=e.levels.childCount();return{textColor:e.levels.childs()[n-1].childs().color.value(),font:u.CHART_FONT_FAMILY,fontSize:t.value(),bold:i.value(),italic:r.value()}}getScaleRatioStep(){return 1e-7}getScaleRatioFormatter(){return this._scaleRatioFormatter}getPriceDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.price-t.price}getIndexDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.index-t.index}getScaleRatio(){const e=this.getPriceDiff(),t=this.getIndexDiff();return null!==e&&null!==t&&0!==t?Math.abs(e/t):null}
static createProperties(e){const t=(0,a.createPropertiesObject)("linetoolganncomplex",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,772280)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("scaleRatio",1);const t=[],i=[],r=e.childs();{const e=r.levels.childCount();for(let n=0;n<e;n++){const e=r.levels.childs()[n].childs();t.push(e.width),i.push(e.color)}}{const e=r.fanlines.childCount();for(let n=0;n<e;n++){const e=r.fanlines.childs()[n].childs();t.push(e.width),i.push(e.color)}}{const e=r.arcs.childCount();for(let n=0;n<e;n++){const e=r.arcs.childs()[n].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new c.LineToolColorsProperty(i)),e.addChild("linesWidths",new c.LineToolWidthsProperty(t))}_correctScaleRatio(){const e=this.properties().childs(),t=this.getScaleRatio();e.scaleRatio.setValue(t)}_getAdjustedScaleRatio(){const e=this.model().mainSeries().priceScale(),t=this.model().timeScale();return(0,l.scaleRatio)(t,e)}_adjustScaleRatio(e){const t=e.scaleRatio.value();""!==t&&null!==t||e.scaleRatio.setValue(this._getAdjustedScaleRatio())}_correctPoint(e){if(this._points.length<2)return;const t=this.getIndexDiff();if(null===t)return;const i=this.properties().childs().scaleRatio.value();if(null!==i){const r=this._points[e],n=0===e?this._points[1]:this._points[0],o=r.price-n.price>0,s=r.index-n.index>0;let l=o&&!s||!o&&s?-1:1;0===e&&(l=-l),r.price=n.price+l*t*i,this._pointChanged.fire(e)}this._normalizePoints()}_correctFirstPoint(){this._correctPoint(this.isReversed()?0:1)}_handleRestoringFactoryDefaults(){this.properties().childs().scaleRatio.setValue(this._getAdjustedScaleRatio())}_handleTemplateApplying(e){""===e.scaleRatio&&(e.scaleRatio=this._getAdjustedScaleRatio())}_migratePoint(){if(this.points().length<this.pointsCount())return;const e=this._getScreenPoints();if(null===e)return;const t=(0,n.ensureNotNull)(this.screenPointToPoint(e[1]));this.setPoint(1,t),this._pointAdded.unsubscribe(this,this._migratePoint)}_getScreenPoints(){const e=this._calcAngle();if(null===e)return null;let[t,i]=this.points();this.isReversed()&&([t,i]=[i,t]);const o=(0,n.ensureNotNull)(this.pointToScreenPoint(t)),s=(0,n.ensureNotNull)(this.pointToScreenPoint(i)),l=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2)),a=new r.Point(Math.cos(e),-Math.sin(e)),c=a.normalized(),u=c.x<0?-1:1,h=c.y<0?-1:1;return[o.addScaled(a,l),o.add(new r.Point(5*l*u,5*l*h))]}_calcAngle(){const[e,t]=this.points(),i=(0,n.ensureNotNull)(this.pointToScreenPoint(e));let r=(0,n.ensureNotNull)(this.pointToScreenPoint(t)).subtract(i);if(r.length()>0){r=r.normalized();let e=Math.acos(r.x);return r.y>0&&(e=-e),e}return null}}},762778:(e,t,i)=>{i.d(t,{LineToolGannFan:()=>h});var r=i(650151),n=i(444372),o=i(329944),s=i(370407),l=i(469805),a=i(23666),c=i(929927);const u=new s.TranslatedString("erase level line",n.t(null,void 0,i(735111)))
;class h extends c.LineDataSource{constructor(e,t,r,n){super(e,t||h.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,128066)).then((({GannFanPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 9}pointsCount(){return 2}name(){return"Gann Fan"}processErase(e,t){const i="level"+t,r=this.properties().child(i).childs().visible;e.setProperty(r,!1,u,l.lineToolsDoNotAffectChartInvalidation)}static createProperties(e){const t=new o.LevelsProperty({defaultName:"linetoolgannfan",state:e,map:{range:[1,9]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,611447))).GannFanDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[],i=[];for(let n=1;n<=9;n++){const o=(0,r.ensureDefined)(e.child("level"+n));t.push((0,r.ensureDefined)(o.child("linewidth"))),i.push((0,r.ensureDefined)(o.child("color")))}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t))}}},188014:(e,t,i)=>{i.d(t,{LineToolGannFixed:()=>a});var r=i(86441),n=i(650151),o=i(929927),s=i(23666),l=i(697876);class a extends o.LineDataSource{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),this._constructor="LineToolGannFixed",Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,816627)).then((({GannFixedPaneView:e})=>{this._setPaneViews([new e(this,this.model())])})),this.properties().childs().reverse.subscribe(this,this._reversePoints)}pointsCount(){return 2}name(){return"Gann Square Fixed"}axisPoints(){const e=this.points(),t=this.getScreenPoints();return e.length<2||t.length<2?[]:[e[0],(0,n.ensureNotNull)(this.screenPointToPoint(t[1]))]}getScreenPoints(){const e=this.points();if(e.length<2)return[];const t=this._calcAngle();if(null===t)return[];const[i,o]=e,s=(0,n.ensureNotNull)(this.pointToScreenPoint(i)),l=(0,n.ensureNotNull)(this.pointToScreenPoint(o)),a=Math.sqrt(Math.pow(s.x-l.x,2)+Math.pow(s.y-l.y,2)),c=new r.Point(Math.cos(t),-Math.sin(t)),u=c.normalized(),h=u.x<0?-1:1,d=u.y<0?-1:1;return[s.addScaled(c,a),s.add(new r.Point(5*a*h,5*a*d))]}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let r=0;r<i;r++){const i=t.levels.childs()[r].childs();e.push({index:r,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let r=0;r<i;r++){const i=t.fanlines.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}
arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let r=0;r<i;r++){const i=t.arcs.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}static createProperties(e){const t=(0,l.createPropertiesObject)("linetoolgannfixed",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,772280)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e);const t=[],i=[],r=e.childs();{const e=r.levels.childCount();for(let n=0;n<e;n++){const e=r.levels.childs()[n].childs();t.push(e.width),i.push(e.color)}}{const e=r.fanlines.childCount();for(let n=0;n<e;n++){const e=r.fanlines.childs()[n].childs();t.push(e.width),i.push(e.color)}}{const e=r.arcs.childCount();for(let n=0;n<e;n++){const e=r.arcs.childs()[n].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new s.LineToolColorsProperty(i)),e.addChild("linesWidths",new s.LineToolWidthsProperty(t))}_calcAngle(){const e=this.points();if(e.length<2)return null;const[t,i]=e,r=this.pointToScreenPoint(t),n=this.pointToScreenPoint(i);if(null===r||null===n)return null;let o=n.subtract(r);if(o.length()<=0)return null;o=o.normalized();let s=Math.acos(o.x);return o.y>0&&(s=-s),s}_reversePoints(){const[e,t]=this._points;this._points[0]=t,this._points[1]=e,this._normalizePoints(),this.restart()}}},942718:(e,t,i)=>{var r=i(929927).LineDataSource,n=i(329944).LevelsProperty,o=i(23666).LineToolColorsProperty,s=[4.5,9,11.25,18,22.5,36,45],l=function(){for(var e=[],t=s.length-1,i=1,r=0,n=0;n<1e10;)n=s[r]*i,e.push(Math.round(n)),e.push(Math.ceil(-n)),r===t-1&&(i*=10),r=(r+1)%t;return e.sort((function(e,t){return e<t?-1:e>t?1:0})),e}();class a extends r{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.t.bind(i,483863,19)).then((({GannSquarePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}hLevelsCount(){return a.HLevelsCount}vLevelsCount(){return a.VLevelsCount}pointsCount(){return 2}name(){return"Gann Box"}_alignPriceOnPattern(e,t){var i=Math.round(1e6*(e.price-t.price))/1e6;if(0===i)return t.price;for(var r=s[0],n=s[s.length-1],o=1,l=Math.abs(i);l<r*o||n*o<l;)l<r*o?o*=.1:n*o<l&&(o*=10);for(var a=n*o,c=s.length-2;c>=0&&!(s[c]*o<l);--c)a=s[c]*o;return e.price=t.price+(i>=0?a:-a),e}_alignTimeOnPattern(e,t){var i=e.index-t.index;if(0===i)return 0;for(var r=l.length-2;r>=0&&!(l[r]<i);--r);return r+=i>0?1:0,e.index=t.index+l[r],e}_alignPointsFixedIncrement(e,t){return this._alignTimeOnPattern(e,t),this._alignPriceOnPattern(e,t),e}_preparePoint(e,t){
return t&&t.shift()&&0!==this._points.length&&this._alignPointsFixedIncrement(e,this._points[0]),super._preparePoint(e,t)}getPoint(e){if(e<2)return super.getPoint(e);var t=null;switch(e){case 2:case 3:var i=this.points();if(i.length===this.pointsCount()){var r=i[0].index,n=i[1].price;3===e&&(r=i[1].index,n=i[0].price),t={index:r,price:n}}}return t}setPoint(e,t,i){if(i&&i.shift()){var r=e%2==0?this._points[1]:this._points[0];this._alignPointsFixedIncrement(t,r)}const n=this._model.mainSeries().interval();switch(e){case 2:this._points[0].index=t.index,this._points[0].interval=n,this._points[1].price=t.price;break;case 3:this._points[1].index=t.index,this._points[1].interval=n,this._points[0].price=t.price;break;default:super.setPoint(e,t,i)}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,60673))).GannSquareDefinitionsViewModel}static createProperties(e){var t=new n({defaultName:"linetoolgannsquare",state:e,map:{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]}});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("color"),e.child("fans").child("color")],i=1;i<=this.HLevelsCount;i++)t.push(e.child("hlevel"+i).child("color"));for(i=1;i<=this.VLevelsCount;i++)t.push(e.child("vlevel"+i).child("color"));e.addChild("linesColors",new o(t)),e.addExcludedKey("linesColors",3)}}a.HLevelsCount=7,a.VLevelsCount=7,t.LineToolGannSquare=a},734493:(e,t,i)=>{i.d(t,{LineToolGhostFeed:()=>c});var r=i(262624),n=i(929927),o=i(650151),s=i(124829);class l{constructor(e,t,i){this._source=e,this._segmentIndex=t,this._bars=null!=i?i:[]}setBars(e){this._bars=e}clone(e){return new l(e,this._segmentIndex,(0,s.clone)(this._bars))}generate(){this._bars=[];const e=this._source.points(),t=e[this._segmentIndex],i=e[this._segmentIndex+1];if(!t||!i||t.index===i.index)return;const r=this._segmentIndex?t.index+1:t.index,n=Math.sign(i.index-t.index);for(let e=r;e!==i.index;e+=n)this._bars.push(this._createBar())}bars(){return this._bars}setSize(e){if(e<this._bars.length)this._bars.splice(e,this._bars.length-e);else for(;this._bars.length<e;)this._bars.push(this._createBar())}_createBar(){const e=this._source.properties().averageHL.value(),t=this._source.properties().variance.value()/100,i=(0,o.ensureNotNull)(this._source.ownerSource()).base();let r=Math.random();const n=e*(1-2*r)*t;r=Math.random();const s=e*(1+(.5-r)*t),l=n-s/2,a=l+s;return{o:(l+Math.random()*s)/i,h:a/i,l:l/i,c:(l+Math.random()*s)/i}}}var a=i(169532);class c extends n.LineDataSource{constructor(e,t,r,n){const o=t||c.createProperties();if(super(e,o,r,n),this._segments=[],this._finished=!1,this._segmentsPixelsWhileMoving=null,!r){const e=Math.round(this._calculateATR());o.childs().averageHL.setValue(e)}o.childs().averageHL.listeners().subscribe(this,this._regenerate),o.childs().variance.listeners().subscribe(this,this._regenerate),this._currentAverageHL=o.childs().averageHL.value(),
this._currentVariance=o.childs().variance.value(),this._currentInterval=e.mainSeries().interval(),this.properties().onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,785093)).then((t=>{this._setPaneViews([new t.GhostFeedPaneView(this,e)])}))}isSynchronizable(){return!1}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),super.destroy()}propertiesChanged(){super.propertiesChanged(),this._currentAverageHL===this.properties().childs().averageHL.value()&&this._currentVariance===this.properties().childs().variance.value()||this._regenerate()}pointsCount(){return-1}name(){return"Ghost Feed"}segmentBars(e){return this._segments[e].bars()}segments(){return this._segments}generateBars(e){this._segments.length<=e&&this._segments.push(new l(this,e)),this._segments[e].generate()}addPoint(e,t,i){if(this._finished)return!0;if(this._points.length>0){const i=this._points[this._points.length-1];if(!(null==t?void 0:t.isApiEvent())&&i.index===e.index){this._lastPoint=null,this._normalizePoints(),this.createServerPoints();for(let e=0;e<this._points.length;e++)this._createPointProperty(e);return!0}}const r=super.addPoint(e,t,i);return this._points.length>1&&this.generateBars(this._points.length-2),r}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}setPoint(e,t,i,r){if(super.setPoint(e,t,i),e>0){const i=this.points()[e-1],r=t.index-i.index;this._segments[e-1].setSize(Math.abs(r))}if(e<this.points().length-1){const i=this.points()[e+1].index-t.index;this._segments[e].setSize(Math.abs(i))}}state(e){const t=super.state(e);return t.segments=this._segments.map((e=>({bars:[...e.bars()]}))),t}restoreData(e){e.segments&&(this._segments=e.segments.map(((e,t)=>new l(this,t,e.bars)))),this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value()}onData(e){super.onData(e);if(!this.pointsProperty().childs().points.child("0"))for(let e=0;e<this._points.length;e++)this._createPointProperty(e);this._currentInterval!==this._model.mainSeries().interval()&&(this._regenerate(),this._currentInterval=this._model.mainSeries().interval())}cloneData(e){this._segments=e._segments.map((e=>e.clone(this)))}startMoving(e,t,i,r){super.startMoving(e,t,i,r),this._preparePixelSegments()}move(e,t,i,r){super.move(e,t,i,r),this._restoreSegmentsFromPixels()}endMoving(e,t){return this._segmentsPixelsWhileMoving=null,super.endMoving(e,t)}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolghostfeed",state:e});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,339349))).GhostFeedDefinitionsViewModel}_handleRestoringFactoryDefaults(){const e=Math.round(this._calculateATR())
;this.properties().childs().averageHL.setValue(e)}_regenerate(){this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value(),this._segments.forEach((e=>e.generate())),this.updateAllViews((0,a.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_calculateATR(){const e=this._model.mainSeries(),t=[];e.bars().each(((e,i)=>{const r=i[2],n=i[3];return null!=r&&null!=n&&t.push(r-n),!1}));let i=0===t.length?0:t.reduce(((e,t)=>e+t),0)/t.length;return i*=e.base(),i}_preparePixelSegments(){var e,t;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===i||null===r||i.isEmpty()||!i.isLog())return;const n=this.points();this._segmentsPixelsWhileMoving=this._segments.map(((e,t)=>{const o=n[t].price,s=n[t+1].price,l=i.priceToCoordinate(o,r),a=(i.priceToCoordinate(s,r)-l)/(e.bars().length-1);return{bars:e.bars().map(((e,t)=>{const n=l+t*a,o=i.coordinateToPrice(n,r);return{open:i.priceToCoordinate(o+e.o,r)-n,high:i.priceToCoordinate(o+e.h,r)-n,low:i.priceToCoordinate(o+e.l,r)-n,close:i.priceToCoordinate(o+e.c,r)-n}}))}}))}_restoreSegmentsFromPixels(){var e,t;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===i||null===r||null===this._segmentsPixelsWhileMoving)return;const n=this.points();this._segmentsPixelsWhileMoving.forEach(((e,t)=>{const o=this._segments[t],s=n[t].price,l=n[t+1].price,a=i.priceToCoordinate(s,r),c=(i.priceToCoordinate(l,r)-a)/(e.bars.length-1),u=o.bars().map(((t,n)=>{const o=e.bars[n],s=a+n*c,l=i.coordinateToPrice(s,r);return{...t,o:i.coordinateToPrice(o.open+s,r)-l,h:i.coordinateToPrice(o.high+s,r)-l,l:i.coordinateToPrice(o.low+s,r)-l,c:i.coordinateToPrice(o.close+s,r)-l}}));o.setBars(u)}))}}},633480:(e,t,i)=>{i.d(t,{LineToolHeadAndShoulders:()=>s});var r=i(262624),n=i(929927),o=i(23666);class s extends n.LineDataSource{constructor(e,t,r,n){const o=t||s.createProperties();super(e,o,r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,280483)).then((t=>{this._setPaneViews([new t.LineToolHeadAndShouldersPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Head and Shoulders"}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolheadandshoulders",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,503929)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new o.LineToolColorsProperty([e.childs().textcolor]))}}},12166:(e,t,i)=>{i.d(t,{LineToolHighlighter:()=>s});var r=i(262624),n=i(219774),o=i(23666);class s extends n.LineToolBrushBase{constructor(e,t,i,r){
super(e,t||s.createProperties(),i,r),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Highlighter"}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolhighlighter",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,191960)).then((e=>e.HighlighterDefinitionsViewModel))}_loadPaneViews(e){Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,670897)).then((t=>{this._setPaneViews([new t.HighlighterPaneView(this,e)])}))}static _configureProperties(e){super._configureProperties(e),e.addChild("widths",new o.LineToolWidthsProperty([e.childs().width])),e.addExcludedKey("widths",3)}}},667542:(e,t,i)=>{i.d(t,{LineToolHorzLinePriceAxisView:()=>o});var r=i(347808),n=i(432059);class o extends r.PriceAxisView{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1;const r=this._source.points(),o=this._source.priceScale();if(0===r.length||null===o||o.isEmpty())return;const s=r[0];if(!isFinite(s.price))return;const l=this._source.ownerSource(),a=null!==l?l.firstValue():null;if(null===a)return;const c=(0,n.resetTransparency)(this._source.properties().linecolor.value());i.background=c,i.textColor=this.generateTextColor(c),i.coordinate=o.priceToCoordinate(s.price,a),e.text=o.formatPrice(s.price,a),e.visible=!0}}},64120:(e,t,i)=>{i.d(t,{LineToolHorzLine:()=>l});var r=i(658843),n=i(262624),o=i(89282),s=i(667542);class l extends o.InplaceTextLineDataSource{constructor(e,t,r,n){super(e,t||l.createProperties(),r,n),this._priceAxisView=new s.LineToolHorzLinePriceAxisView(this),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,53030)).then((({HorzLinePaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this))])}))}state(e){const t=super.state(e);return t.points&&0!==t.points.length&&(t.points[0].offset=0),t}pointsCount(){return 1}name(){return"Horizontal Line"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}timeAxisViews(){return null}timeAxisPoints(){return[]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}denormalizeTimePoints(){this._points=[],this._timePoint.length>0&&this._points.push({price:this._timePoint[0].price,index:0,interval:this._model.mainSeries().interval()})}clearData(){const e=this._points;super.clearData(),this._points=e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textcolor,textVisible:e.showLabel}}
static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolhorzline",state:e});return this._configureProperties(t),t}_getAlertPlots(){return[this.points()[0].price]}_pointsForPointset(){return[]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,116923)).then((e=>e.HorizontalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new r.Property("")),e.addExcludedKey("text",1)}}},590487:(e,t,i)=>{i.d(t,{LineToolHorzRay:()=>l});var r=i(262624),n=i(658843),o=i(667542),s=i(929927);class l extends s.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:l.createProperties(),r,n),this._priceAxisView=new o.LineToolHorzLinePriceAxisView(this),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,697986)).then((({HorzRayPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Horizontal Ray"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}canHasAlert(){return!0}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolhorzray",state:e});return this._configureProperties(t),t}_getAlertPlots(){const e=this._points[0],t={index:e.index+1,price:e.price},i=this._linePointsToAlertPlot([e,t],null,!1,!0);return null!==i?[i]:[]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,718024))).HorizontalRayDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new n.Property("")),e.addExcludedKey("text",1)}}},814452:(e,t,i)=>{i.d(t,{LineToolIcon:()=>x});var r=i(419283),n=i(965251),o=i(18686),s=i(338619),l=i(154834),a=i(998034),c=i(960095),u=i(825446),h=i(985429),d=i(262624),p=i(436687),_=i(23666);const P=(0,c.getHexColorByName)("color-tv-blue-500"),v={intervalsVisibilities:{...h.intervalsVisibilitiesDefaults},color:P,size:40},m={icon:61720,angle:.5*Math.PI},g=(0,d.extractAllPropertiesKeys)(v),f=(0,d.extractAllPropertiesKeys)(m),y=[...new Set([...f,...g,...p.commonLineToolPropertiesStateKeys])];class T extends u.LineDataSourceProperty{constructor(e){super(e),this.addChild("backgroundsColors",new _.LineToolColorsProperty([this.childs().color]))}static create(e,t){return new this({defaultName:"linetoolicon",factoryDefaultsSupplier:()=>(0,l.default)(v),
nonThemedDefaultsKeys:g,themedDefaultsKeys:[],state:(0,a.default)({},m,{icon:t},null!=e?e:{}),allStateKeys:y})}}const C=(0,s.getLogger)("Chart.LineToolIcon");class x extends o.LineToolSvgIconBase{constructor(e,t,i,r){super(e,t||x.createProperties(),i,r),this.version=1,this._loadViews()}name(){return"Icon"}template(){return this._properties.template()}static createProperties(e){const t=T.create(e,r.iconTool.value());return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,657288)).then((e=>e.IconsDefinitionsViewModel))}async _loadViews(){const[{getSvgContentForCharCode:e,getSvgRenderer:t},{IconPaneView:r}]=await Promise.all([i.e(27987).then(i.bind(i,964941)),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,73360))]);if(!this._isDestroyed){const i=this._properties.childs().icon.value();this._svgContent=e(i),this._onIconChanged.fire();const o=t(n.svgRenderer,i);null===o&&C.logWarn(`Couldn't create svg renderer for icon ${i}`),this._setPaneViews([new r(this,this._model,o)])}}}},163130:(e,t,i)=>{i.d(t,{createIdeaLineToolByUrl:()=>p,isIdeaAuthorProfileImageUrl:()=>h,isIdeaUrl:()=>u});var r=i(650151),n=i(62802),o=i(66974),s=i(79342),l=i(716004),a=i(726978);const c=/^\/chart\/.+?\/([0-9a-zA-Z]{8})(-[-\w]+)?\/?$/;function u(e){try{const t=new URL(e);return((e=>"https:"===e.protocol&&e.hostname.endsWith(".tradingview.com"))(t)||(e=>!(0,o.isProd)()&&e.hostname.endsWith(window.location.hostname))(t))&&c.test(t.pathname)}catch(e){return!1}}function h(e){if(e.startsWith("data:image/svg+xml,"))return!0;try{const t=new URL(e),i=new URL(window.AWS_S3_CDN);return t.protocol===i.protocol&&t.hostname===i.hostname&&t.pathname.includes("/userpics/")}catch(e){return!1}}async function d(e){const t=new URL(`/api/v1/ideas/${i=e,(0,r.ensureNotNull)(c.exec(new URL(i).pathname))[1]}/`,location.href);var i;return fetch(t.toString()).then((e=>{if(!e.ok)throw new Error(`Error processing idea: ${e.statusText}`);return e.json()}))}function p(e,t,i=!1){return d(e).then((e=>{const o=function(e,t){var i;const n=(0,r.ensureDefined)(e.user);let o;n.avatars&&h(n.avatars.small)&&(o=n.avatars.small.startsWith("data:image/svg+xml,")?n.avatars.small:`${n.avatars.small.replace(window.AWS_S3_CDN,"")}?resetCache=true`);const s={avatarUrl:o,badges:null===(i=n.badges)||void 0===i?void 0:i.map((e=>e.name)),username:n.username};return{createdAt:e.created_timestamp,direction:e.direction,name:(0,l.clean)(e.name,!0),author:s,uuid:e.uuid}}(e),c={price:0,time_t:o.createdAt,offset:0},u=t.mainSeries(),d=(0,r.ensureNotNull)(t.model().paneForSource(u)),p=d.newLineToolZOrder(!0),_={type:"drawing",source:{id:(0,s.randomHashN)(6),zorder:p,type:"LineToolIdea",position:50,state:{interval:"1",...a.LineToolIdea.createProperties().state()},ideaData:o,symbol:u.symbol(),ownerSource:u.id(),points:[c]},geometry:[],modelId:t.model().id()},P=t.pasteLineTool(d,_,!0,!0)
;return i&&n.setValue("hint.pasteIdea",!0,{forceFlush:!0}),P.pointAdded().subscribe(null,(()=>t.scrollToLineTool(P)),!0),P}))}},726978:(e,t,i)=>{i.d(t,{LineToolIdea:()=>w});var r=i(262624),n=i(929927),o=i(444372),s=i(62802),l=i(345848),a=i(338619),c=i(457965),u=i(846778),h=i(26829),d=i(419283),p=i(994157),_=i(163130);const P=(0,a.getLogger)("Chart.IdeaDialog"),v=o.t(null,void 0,i(215982)),m=o.t(null,void 0,i(999798));let g=null;function f(e){"LineToolIdea"===e?(window.is_authenticated||(0,d.resetToCursor)(!0),(0,c.runOrSigninWithFeature)((()=>{d.tool.setValue("LineToolIdea"),g=(0,p.showCustomUrlEventDialog)({onConfirm:y,onClose:()=>{g=null,"LineToolIdea"===d.tool.value()&&(0,d.resetToCursor)(!0)},title:v,placeholderText:m}),(0,l.trackEvent)("Idea","Open idea dialog")}),{feature:"drawings",source:"Change drawing tool state"})):null!==g&&g.then((e=>e()))}function y(e){const t=(0,h.chartWidgetCollectionService)();if(null===t)return;if(!(0,_.isIdeaUrl)(e))return void P.logWarn(`Invalid idea url: ${e}`);const i=!Boolean(s.getBool("hint.pasteIdea")),r=t.activeChartWidget.value();(0,_.createIdeaLineToolByUrl)(e,r.model()).then((()=>{i&&(0,u.showPasteLineToolHint)(t.getContainer(),"hint.pasteIdea")}))}var T=i(658843),C=i(417667);class x extends C.CustomEventItem{constructor(e,t){super(t),this._data=e}ideaData(){return this._data}index(){return this._source.eventTimePointIndex()}time(){return this._data.createdAt}avatar(){var e;return null===(e=this._data.author)||void 0===e?void 0:e.avatarUrl}}class w extends C.LineToolCustomUrlEvent{constructor(e,t,r,n){super(e,t||w.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,92728)).then((t=>{this._setPaneViews([new t.IdeaPaneView(this,e)])}))}name(){return"Idea"}state(e){const t=super.state(e);return this._item&&(t.ideaData=this._item.ideaData()),e&&(t.eventTimePointIndex=this._eventTimePointIndex),t}restoreData(e){e.ideaData&&(this._item=new x(e.ideaData,this)),void 0!==e.eventTimePointIndex&&(this._eventTimePointIndex=e.eventTimePointIndex)}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolIdea",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,901430)).then((e=>e.IdeaDefinitionsViewModel))}static _configureProperties(e){n.LineDataSource._configureProperties(e),e.hasChild("position")||e.addChild("position",new T.Property(50)),e.addExcludedKey("position",1)}}(0,d.runOnDrawingStateReady)((()=>{d.tool.subscribe(f)}))},436687:(e,t,i)=>{i.d(t,{commonLineToolPropertiesStateKeys:()=>r})
;const r=["symbolStateVersion","zOrderVersion","frozen","title","interval","symbol","currencyId","unitId","visible","intervalsVisibilities.ticks","intervalsVisibilities.seconds","intervalsVisibilities.secondsFrom","intervalsVisibilities.secondsTo","intervalsVisibilities.minutes","intervalsVisibilities.minutesFrom","intervalsVisibilities.minutesTo","intervalsVisibilities.hours","intervalsVisibilities.hoursFrom","intervalsVisibilities.hoursTo","intervalsVisibilities.days","intervalsVisibilities.daysFrom","intervalsVisibilities.daysTo","intervalsVisibilities.weeks","intervalsVisibilities.weeksFrom","intervalsVisibilities.weeksTo","intervalsVisibilities.months","intervalsVisibilities.monthsFrom","intervalsVisibilities.monthsTo","intervalsVisibilities.ranges"]},165215:(e,t,i)=>{i.d(t,{LineToolImage:()=>w,buildAbsoluteUserImageUrl:()=>x});var r=i(650151),n=i(86441),o=i(338619),s=i(262624),l=i(658843),a=i(929927),c=i(169532),u=i(62802),h=i(345848),d=i(457965),p=i(846778),_=i(26829),P=i(419283);async function v(e,t){return async function(e){return(await Promise.all([i.e(73040),i.e(75816),i.e(93703),i.e(46445),i.e(62093),i.e(44524),i.e(21356),i.e(59258),i.e(82421),i.e(67158),i.e(8222),i.e(82440),i.e(41682),i.e(60171),i.e(82321),i.e(62107),i.e(62526),i.e(77038)]).then(i.bind(i,408273))).renderImageDialog(e)}({onConfirm:e,onClose:t})}let m=null;function g(e){if("LineToolImage"!==e)return null==m||m.then((e=>e())),void(m=null);window.is_authenticated||(0,P.resetToCursor)(!0),(0,d.runOrSigninWithFeature)((()=>{P.tool.setValue("LineToolImage"),m=v(f,(()=>{null==m||m.then((e=>e())),m=null,"LineToolImage"===P.tool.value()&&(0,P.resetToCursor)(!0)})),(0,h.trackEvent)("Image","Open image dialog")}),{feature:"drawings",source:"Change drawing tool state"})}function f(e){const t=(0,_.chartWidgetCollectionService)();if(null===t)return;const i=!Boolean(u.getBool("hint.pasteImage")),n=t.activeChartWidget.value();n.model().pasteImageAsLineTool(e.url,e.blobUrl,(0,r.ensureNotNull)(n.model().model().paneForSource(n.model().mainSeries())),e.transparency),i&&(0,p.showPasteLineToolHint)(t.getContainer(),"hint.pasteImage")}const y=(0,o.getLogger)("Chart.LineToolImage");function T(e){return e.toLowerCase().startsWith("blob:")}const C=window.AWS_BBS3_DOMAIN;function x(e){if(T(e))return e;const t=new URL(e,C),i=new URL(t.pathname,C);if("/"===i.pathname)return null;const r=i.toString();return t.toString()!==r?null:r}class w extends a.LineDataSource{constructor(e,t,r,n){var o;super(e,t||w.createProperties(),r,n),this._image=null,this._originPoint=4;const s=this.properties().childs().url;this._absoluteUserImageUrl=new l.Property(null!==(o=x(this.properties().childs().url.value()))&&void 0!==o?o:""),this._absoluteUserImageUrl.subscribe(this,(e=>{const t=e.value();if(T(t))return;const i=x(t);null!==i&&s.setValue(new URL(i).pathname)})),s.subscribe(this,(()=>{const e=x(s.value());null!==e&&this._absoluteUserImageUrl.setValue(e)})),this._loadImage(),
Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,622666)).then((({ImagePaneView:t})=>{this._setPaneViews([new t(this,e)])})),this.properties().childs().url.subscribe(this,(()=>{this._loadImage()}))}absoluteUserImageUrl(){return this._absoluteUserImageUrl}cssWidth(){return this.properties().childs().cssWidth.value()}cssHeight(){return this.properties().childs().cssHeight.value()}angle(){return this.properties().childs().angle.value()}originPoint(){return this._originPoint}dOffsetX(){return this._dOffsetX||0}pointsCount(){return 1}name(){return"Image"}image(){return this._image}setBlobImageUrl(e){this._image||(this._createImage(e),this._blobUrl=e)}getChangePointForSync(e){return null}hasEditableCoordinates(){return!1}pointToScreenPoint({index:e,price:t},i=0){const o=this._model.timeScale(),s=(0,r.ensureNotNull)(this.priceScale()),l=(0,r.ensureNotNull)((0,r.ensureNotNull)(this.ownerSource()).firstValue()),a=o.indexToCoordinate(e)+i,c=s.priceToCoordinate(t,l);return new n.Point(a,c)}setPoint(e,t,i){if(null===this._image)return;const{width:n,height:o}=this._image,s=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0],this.dOffsetX())),a=Math.max(Math.abs(l.x-s.x)/n,Math.abs(l.y-s.y)/o),c=Math.round(n*a),u=Math.round(o*a),h=this.properties().childs();h.cssWidth.setValue(c),h.cssHeight.setValue(u),this.propertiesChanged()}startChanging(e,t){super.startChanging(e,t),this._changeOriginPoint(w._oppositePoints[e])}endChanging(e,t){return this._changeOriginPoint(4),super.endChanging(e,t)}getPoint(){return null}syncLineStyleState(){const e=super.syncLineStyleState();return!e.url&&this._blobUrl&&(e.blobUrl=this._blobUrl),e}restoreExternalState(e){const{blobUrl:t,...i}=e;t&&this.setBlobImageUrl(t),super.restoreExternalState(i)}isSavedInChart(){return super.isSavedInChart()&&""!==this.absoluteUserImageUrl().value()}static createProperties(e){const t=new s.DefaultProperty({defaultName:"linetoolimage",state:e});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,572697))).ImageDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("url")||e.addChild("url",new l.Property("")),e.addExcludedKey("url",1),e.addExcludedKey("cssWidth",1),e.addExcludedKey("cssHeight",1),e.addExcludedKey("angle",1)}_loadImage(){const e=this.properties(),t=(0,r.ensureDefined)(e.child("url")).value();t&&this._createImage(t)}_changeOriginPoint(e){const t=this.originPoint(),i=4===t?w._correctOriginDirections[e]:w._correctOriginDirections[w._oppositePoints[t]],o=this.properties().childs().cssWidth.value()/2,s=this.properties().childs().cssHeight.value()/2,[l]=this._points,a=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),c=new n.Point(a.x+o*i[0],a.y+s*i[1]),u=(0,r.ensureNotNull)(this.screenPointToPoint(c));this._dOffsetX=4===t?c.x-(0,
r.ensureNotNull)(this.pointToScreenPoint(u)).x:void 0,l.index=u.index,l.price=u.price,this._originPoint=e}_createImage(e){var t;const i=T(e),n=x(e);if(null===n)return void y.logWarn(`Invalid image URL: ${e}`);if(n===(null===(t=this._image)||void 0===t?void 0:t.src))return;const o=document.createElement("img");o.crossOrigin="anonymous",o.src=n,o.addEventListener("load",(()=>{this._image=o;const e=this._model,t=this.properties().childs();if(!i){const e=new URL(n).pathname;t.url.setValue(e),this._blobUrl=void 0}if(t.cssWidth.value()&&t.cssHeight.value())return void this._model.updateSource(this);const s=e.timeScale().width()/4,l=(0,r.ensureNotNull)(this.priceScale()).height()/4,a=o.naturalWidth,u=o.naturalHeight,h=Math.min(1,s/a),d=Math.min(1,l/u),p=Math.min(h,d),_=Math.round(p*a),P=Math.round(p*u);t.cssWidth.setValue(_),t.cssHeight.setValue(P),this.updateAllViews((0,c.sourceChangeEvent)(this.id())),this._model.updateSource(this)})),o.addEventListener("error",(()=>{this.model().removeSource(this)}))}}w._correctOriginDirections=[[-1,-1],[1,-1],[-1,1],[1,1],[0,0]],w._oppositePoints=[3,2,1,0,4],(0,P.runOnDrawingStateReady)((()=>{P.tool.subscribe(g)}))},24203:(e,t,i)=>{i.d(t,{LineToolInfoLine:()=>n});var r=i(815259);class n extends r.LineToolTrendLine{constructor(e,t,i,r){super(e,t||n.createProperties(),i,r)}pointsCount(){return 2}name(){return"Info Line"}static createProperties(e){const t=r.LineToolTrendLine._createPropertiesImpl("linetoolinfoline",e);return n._configureProperties(t),t}}},89282:(e,t,i)=>{i.d(t,{InplaceTextLineDataSource:()=>m,InplaceTextUndoCommand:()=>v});var r=i(650279),n=i(650151),o=i(86441),s=i(960095),l=i(444372),a=i(370407),c=i(375397),u=i(669763),h=i(929927),d=i(169532);var p=i(469805);const _={selectionColor:(0,s.getHexColorByName)("color-tv-blue-500"),cursorColor:(0,s.getHexColorByName)("color-black")},P={selectionColor:(0,s.getHexColorByName)("color-white"),cursorColor:(0,s.getHexColorByName)("color-white")};class v extends u.UndoCommand{constructor(e,t,r,n){var o;super(new a.TranslatedString("change {title} text",l.t(null,void 0,i(257122))).format({title:new a.TranslatedString(t.name(),t.translatedType())}),!0,!p.lineToolsDoNotAffectChartInvalidation),this._sourceId=t.id(),this._model=e,this._oldValue=r,this._newValue=n,this._changeVisibility=!1===(null===(o=t.editableTextProperties().textVisible)||void 0===o?void 0:o.value())}redo(){var e;const t=this._source();this._textProperty(t).setValue(this._newValue),this._changeVisibility&&(null===(e=this._textVisibilityProperty(t))||void 0===e||e.setValue(!0))}undo(){var e;const t=this._source();this._textProperty(t).setValue(this._oldValue),this._changeVisibility&&(null===(e=this._textVisibilityProperty(t))||void 0===e||e.setValue(!1))}_textProperty(e){return e.editableTextProperties().text}_textVisibilityProperty(e){return e.editableTextProperties().textVisible}_source(){return(0,n.ensureNotNull)(this._model.dataSourceForId(this._sourceId))}}class m extends h.LineDataSource{constructor(e,t,r,n){super(e,t,r,n),this._container=null,
this._editableText=new c.WatchedValue(""),this._activateTextEditingEl=null,this._paneView=null,this._selectionData={},this._cursorPaneView=null,this._cursorPosition=null,this._editingOnCreation=!1,this._editableText.subscribe((()=>{this.updateAllViewsAndRedraw((0,d.sourceChangeEvent)(this.id()))})),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,700035)).then((t=>{this._cursorPaneView=new t.InplaceTextCursorPaneView(this,e),this._additionalCursorDataGetters&&(this._cursorPaneView.setAdditionalCursorData(...this._additionalCursorDataGetters),null!==this._cursorPosition&&(this._cursorPaneView.setCursorPosition(this._cursorPosition),e.updateSource(this)))}))}destroy(){this._editableText.unsubscribe(),this._closeTextEditor(),super.destroy()}editableTextStyle(){return{...this._model.dark().value()?P:_}}removeIfEditableTextIsEmpty(){return!1}activateEditingOnCreation(){return!1}topPaneViews(e){return e.hasDataSource(this)&&!window.TradingView.printing&&this._cursorPaneView?(this._cursorPaneView.update((0,d.sourceChangeEvent)(this.id())),[this._cursorPaneView]):null}dataAndViewsReady(){return super.dataAndViewsReady()&&null!==this._cursorPaneView}editableText(){return this._editableText}textEditingEl(){return this._activateTextEditingEl}activateTextEditingOn(e,t){this._activateTextEditingEl=e,this._editingOnCreation=!!t,this.updateAllViewsAndRedraw((0,d.sourceChangeEvent)(this.id()))}onSelectionChange(e){var t;const i={};void 0!==e&&(e.start===e.end?i.cursorPosition=e.start:i.selectionRange=[Math.min(e.start,e.end),Math.max(e.start,e.end)]),(0,r.default)(i,this._selectionData)||(this._selectionData=i,this._paneViews.forEach((e=>{e.forEach((e=>{"setSelectionRange"in e&&e.setSelectionRange(i.selectionRange)}))})),this._cursorPaneView?this._cursorPaneView.setCursorPosition(i.cursorPosition):this._cursorPosition=null!==(t=i.cursorPosition)&&void 0!==t?t:null,this.updateAllViewsAndRedraw((0,d.sourceChangeEvent)(this.id())))}setAdditionalCursorData(e,t){this._cursorPaneView?this._cursorPaneView.setAdditionalCursorData(e,t):this._additionalCursorDataGetters=[e,t]}_updateAllPaneViews(e){var t;super._updateAllPaneViews(e),null===(t=this._cursorPaneView)||void 0===t||t.update(e)}async _openTextEditor(e,t,r,s,l){if(null!==this._container)return;this._activateTextEditingEl=null,this._cursorPosition=null;const a=this.isFixed()?(0,n.ensureDefined)(this.fixedPoint()):(0,n.ensureNotNull)(this.pointToScreenPoint(this._points[0])),c=new o.Point(a.x,a.y);this._container=document.createElement("div"),this._container.style.position="absolute",this._container.style.top="0",this._container.style.bottom="0",this._container.style.left="0",this._container.style.right="0",this._container.style.overflow="hidden",this._container.style.pointerEvents="none",e.appendChild(this._container);const u=this.editableTextProperties(),h=this.editableTextStyle();this._editableText.setValue(u.text.value())
;const{updateChartEditorText:p,closeChartEditorText:_}=await Promise.all([i.e(44556),i.e(82321),i.e(15592)]).then(i.bind(i,703846));if(null===this._container||this._isDestroyed)return;this._closeChartEditorText=_;const P={position:c,textInfo:t,placeholder:r,text:this._editableText,textColor:u.textColor,wordWrap:u.wordWrap,forbidLineBreaks:h.forbidLineBreaks,maxLength:h.maxLength,onClose:s,onSelectionChange:l};p(this._container,P),this.updateAllViewsAndRedraw((0,d.sourceChangeEvent)(this.id()))}_closeTextEditor(){var e;if(null===this._container||this._isDestroyed)return;const t=this.editableTextProperties().text.value(),i=this._editableText.value();t!==i&&(this._editingOnCreation?this.editableTextProperties().text.setValue(i):this._model.undoModel().undoHistory().pushUndoCommand(this._changeEditableTextUndoCommand(t,i))),this._editingOnCreation=!1,this.onSelectionChange(),null===(e=this._closeChartEditorText)||void 0===e||e.call(this,this._container),this._closeChartEditorText=void 0,this._container.remove(),this._container=null,this.updateAllViewsAndRedraw((0,d.sourceChangeEvent)(this.id()))}_changeEditableTextUndoCommand(e,t){return new v(this._model,this,e,t)}}},397125:(e,t,i)=>{i.d(t,{LineToolInsidePitchfork:()=>o});var r=i(329944),n=i(99269);class o extends n.LineToolPitchfork{constructor(e,t,i,r){super(e,t||o.createProperties(),i,r)}name(){return"Inside Pitchfork"}static createProperties(e){const t=new r.LevelsProperty({defaultName:"linetoolinsidepitchfork",state:e,map:{range:[0,8]}});return this._configureProperties(t),t}}},627620:(e,t,i)=>{var r;i.d(t,{isImageToolName:()=>d,isLineDrawnWithPressedButton:()=>c,isLineToolDrawWithoutPoints:()=>h,isLineToolFinishRequiredWhenCreatedByApi:()=>u,isLineToolName:()=>a,isMtpPredictorToolName:()=>s,isStudyLineToolName:()=>l,isTextToolName:()=>p});var n=i(954877);const o=new Set(["LineStudyMtpAnalysis","LineStudyMtpDecisionPoint","LineStudyMtpRiskReward","LineStudyMtpElliotWaveMain","LineStudyMtpElliotWaveMajor","LineStudyMtpElliotWaveMinor","LineStudyMtpDownWave1OrA","LineStudyMtpDownWave2OrB","LineStudyMtpDownWave3","LineStudyMtpDownWave4","LineStudyMtpDownWave5","LineStudyMtpDownWaveC","LineStudyMtpUpWave1OrA","LineStudyMtpUpWave2OrB","LineStudyMtpUpWave3","LineStudyMtpUpWave4","LineStudyMtpUpWave5","LineStudyMtpUpWaveC"]);function s(e){return o.has(e)}function l(e){return"LineToolRegressionTrend"===e||"LineToolVbPFixed"===e||"LineToolFixedRangeVolumeProfile"===e||"LineToolAnchoredVolumeProfile"===e||"LineToolAnchoredVWAP"===e}function a(e){return e in(r||(r=i.t(n,2)))||l(e)}function c(e){return"LineToolBrush"===e||"LineToolHighlighter"===e}function u(e){return c(e)||"LineToolPath"===e||"LineToolPolyline"===e||"LineToolGhostFeed"===e}function h(e){return"LineToolTweet"===e||"LineToolIdea"===e||"LineToolImage"===e}function d(e){return"LineToolImage"===e}function p(e){switch(e){case"LineToolBalloon":case"LineToolComment":case"LineToolText":case"LineToolTextAbsolute":case"LineToolCallout":case"LineToolNote":case"LineToolNoteAbsolute":case"LineToolSignpost":return!0}
return!1}},825446:(e,t,i)=>{i.d(t,{LineDataSourceProperty:()=>l});var r=i(154834),n=i(998034),o=i(650151),s=i(262624);class l extends s.DefaultProperty{constructor({templateKeys:e,...t}){super({ignoreAllowSavingDefaults:!0,saveNonDefaultUserPreferencesOnly:!0,...t}),this._templateKeys=(0,o.ensureDefined)(e||this._allDefaultsKeys)}template(){return(0,s.extractState)(this.state(),this._templateKeys,[])}applyTemplate(e){this.mergeAndFire((0,s.extractState)((0,n.default)((0,r.default)(this._factoryDefaultsSupplier()),e),this._templateKeys))}}},954877:(e,t,i)=>{t.LineToolFibRetracement=i(739988).LineToolFibRetracement,t.LineToolFibChannel=i(267961).LineToolFibChannel,t.LineToolFibSpeedResistanceArcs=i(597531).LineToolFibSpeedResistanceArcs,t.LineToolProjection=i(669824).LineToolProjection,t.LineToolTrendBasedFibExtension=i(733176).LineToolTrendBasedFibExtension,t.LineToolElliott=i(487416).LineToolElliott,t.LineToolFibCircles=i(992344).LineToolFibCircles,t.LineToolVertLine=i(243009).LineToolVertLine,t.LineToolCrossLine=i(490210).LineToolCrossLine,t.LineToolBarsPattern=i(316589).LineToolBarsPattern,t.LineToolTrendBasedFibTime=i(337861).LineToolTrendBasedFibTime,t.LineToolFibTimeZone=i(924163).LineToolFibTimeZone,t.LineToolCircleLines=void 0,t.LineToolDateRange=i(936638).LineToolDateRange,t.LineToolPriceRange=i(115489).LineToolPriceRange,t.LineToolDateAndPriceRange=i(261609).LineToolDateAndPriceRange,t.LineToolParallelChannel=i(97917).LineToolParallelChannel,t.LineToolTrendAngle=i(221542).LineToolTrendAngle,t.LineToolTrendLine=i(815259).LineToolTrendLine,t.LineToolInfoLine=i(24203).LineToolInfoLine,t.LineToolArrowMark=i(866172).LineToolArrowMark,t.LineToolImage=i(165215).LineToolImage,t.LineToolPitchfan=i(474539).LineToolPitchfan,t.LineToolGannSquare=i(942718).LineToolGannSquare,t.LineToolFibSpeedResistanceFan=i(23565).LineToolFibSpeedResistanceFan,t.LineToolGannComplex=i(342584).LineToolGannComplex,t.LineToolGannFixed=i(188014).LineToolGannFixed,t.LineToolGannFan=i(762778).LineToolGannFan,t.LineToolFibWedge=i(670632).LineToolFibWedge,t.LineToolPitchfork=i(99269).LineToolPitchfork,t.LineToolDisjointAngle=i(612574).LineToolDisjointChannel,t.LineToolFlatBottom=i(399643).LineToolFlatBottom,t.LineToolIcon=i(814452).LineToolIcon,t.LineToolEmoji=i(471133).LineToolEmoji,t.LineToolSticker=i(831745).LineToolSticker,t.LineToolRotatedRectangle=i(723187).LineToolRotatedRectangle,t.LineToolFibSpiral=void 0,t.LineToolHeadAndShoulders=i(633480).LineToolHeadAndShoulders,t.LineToolTriangle=i(466376).LineToolTriangle,t.LineToolTrianglePattern=i(763337).LineToolTrianglePattern,t.LineTool5PointsPattern=i(462723).LineTool5PointsPattern,t.LineToolThreeDrivers=i(196019).LineToolThreeDrivers,t.LineToolABCD=i(558540).LineToolABCD,t.LineToolPolyline=i(948029).LineToolPolyline,t.LineToolPath=i(966293).LineToolPath,t.LineToolPrediction=i(688684).LineToolPrediction,t.LineToolPriceLabel=i(275428).LineToolPriceLabel,t.LineToolPriceNote=void 0,t.LineToolTextNote=void 0,t.LineToolNote=void 0,t.LineToolNoteAbsolute=void 0,
t.LineToolArrowMarker=i(32623).LineToolArrowMarker,t.LineToolSignpost=i(172666).LineToolSignpost,t.LineToolBrush=i(455034).LineToolBrush,t.LineToolArc=i(237026).LineToolArc,t.LineToolCallout=i(441788).LineToolCallout,t.LineToolBalloon=i(418998).LineToolBalloon,t.LineToolComment=i(242430).LineToolComment,t.LineToolText=i(63171).LineToolText,t.LineToolHorzLine=i(64120).LineToolHorzLine,t.LineToolHorzRay=i(590487).LineToolHorzRay,t.LineToolRectangle=i(260720).LineToolRectangle,t.LineToolCircle=i(198075).LineToolCircle,t.LineToolEllipse=i(196103).LineToolEllipse,t.LineToolTimeCycles=i(42978).LineToolTimeCycles,t.LineToolSineLine=i(519659).LineToolSineLine,t.LineToolGhostFeed=i(734493).LineToolGhostFeed,t.LineToolBezierQuadro=i(846911).LineToolBezierQuadro,t.LineToolBezierCubic=i(800757).LineToolBezierCubic,t.LineToolArrow=i(681090).LineToolArrow,t.LineToolRay=i(337731).LineToolRay,t.LineToolExtended=i(481673).LineToolExtended,t.LineToolSchiffPitchfork=i(885247).LineToolSchiffPitchfork,t.LineToolSchiffPitchfork2=i(250330).LineToolSchiffPitchfork2,t.LineToolInsidePitchfork=i(397125).LineToolInsidePitchfork,t.LineToolTextAbsolute=i(63171).LineToolTextAbsolute,t.LineToolArrowMarkLeft=i(866172).LineToolArrowMarkLeft,t.LineToolArrowMarkRight=i(866172).LineToolArrowMarkRight,t.LineToolArrowMarkUp=i(866172).LineToolArrowMarkUp,t.LineToolArrowMarkDown=i(866172).LineToolArrowMarkDown,t.LineToolFlagMark=i(191073).LineToolFlagMark,t.LineToolCypherPattern=i(231001).LineToolCypherPattern,t.LineToolElliottImpulse=i(487416).LineToolElliottImpulse,t.LineToolElliottTriangle=i(487416).LineToolElliottTriangle,t.LineToolElliottTripleCombo=i(487416).LineToolElliottTripleCombo,t.LineToolElliottCorrection=i(487416).LineToolElliottCorrection,t.LineToolElliottDoubleCombo=i(487416).LineToolElliottDoubleCombo,t.LineToolRiskRewardLong=i(676415).LineToolRiskRewardLong,t.LineToolRiskRewardShort=i(676415).LineToolRiskRewardShort,t.LineToolPosition=i(284682).LineToolPosition,t.LineToolOrder=i(999872).LineToolOrder,t.LineToolHighlighter=i(12166).LineToolHighlighter,t.LineToolTweet=i(40495).LineToolTweet,t.LineToolIdea=i(726978).LineToolIdea,t.LineToolTable=void 0},750665:(e,t,i)=>{i.d(t,{LineToolTradingPriceAxisView:()=>n});var r=i(129824);class n extends r.LineToolPriceAxisView{_formatPrice(e,t){return this._source.formatter().format(e)}}},494927:(e,t,i)=>{i.d(t,{LineToolWithRelativePriceCoordinate:()=>P,getNoDataPosition:()=>p,getSeriesPosition:()=>_,positionToCoordinate:()=>u});var r=i(650151),n=i(518439),o=i(89282),s=i(419283);function l(e,t,i){const r=e.barFunction();switch(e.style()){case 3:case 10:case 2:case 14:case 15:return r(t.value);default:return t.value[-1===i?3:2]}}function a(e){return e>=0?1:-1}function c(e,t){return-1===a(e)!==t?-1:1}function u(e,t,i,r){const n=Math.min(t,Math.max(0,1===r?i:t-i));return i-r*Math.abs(n*e/100)}function h(e,t,i){const r=e.index();return null===r?null:{index:r,price:t.coordinateToPrice(t.height()/2,i)}}function d(e,t){const i=e.data().bars(),r=i.first(),o=i.last();if(null===r||null===o)return null;let s
;const c=t.index();if(null===c){if(void 0===t.time)return null;const e=t.time(),l=r.value[0],a=o.value[0];if(e<l-86400||e>a)return null;s=i.searchByTime(e,n.PlotRowSearchMode.NearestRight,4)}else s=i.search(c);return null===s?null:{index:s.index,price:l(e,s,a(t.position()))}}function p(e,t,i,r){const n=h(e,t,r);if(null===n)return null;const o=c(e.position(),t.isInverted());return{index:n.index,price:n.price,poleStartY:t.height(),visualDirection:1,positionPointDirection:o,startsOnSeriesData:!1,priceCoordinate:t.priceToCoordinate(n.price,r),indexCoordinate:i.indexToCoordinate(n.index)}}function _(e,t,i=!0){const n=d(e,t),o=e.priceScale(),s=e.model().timeScale(),l=(0,r.ensureNotNull)(e.firstValue());if(null===n)return p(t,o,s,l);let a=0;const u=e.properties().childs(),h=o.priceToCoordinate(n.price,l),_=c(t.position(),o.isInverted());if(i)switch(e.style()){case 16:a=1===_?u.hlcAreaStyle.childs().highLineWidth.value()/2:u.hlcAreaStyle.childs().lowLineWidth.value()/2;break;case 3:a=u.areaStyle.childs().linewidth.value()/2;break;case 2:a=u.lineStyle.childs().linewidth.value()/2;break;case 14:a=u.lineWithMarkersStyle.childs().linewidth.value()/2;break;case 15:a=u.steplineStyle.childs().linewidth.value()/2;break;case 10:const e=Math.abs(100-u.baselineStyle.childs().baseLevelPercentage.value());a=o.height()*e/100>h?u.baselineStyle.childs().topLineWidth.value()/2:u.baselineStyle.childs().bottomLineWidth.value()/2;break;case 1:case 9:case 8:case 12:case 4:case 7:a=3;break;case 0:a=u.barStyle.childs().thinBars.value()?3:Math.max(3,.25*s.barSpacing());break;case 11:a=u.rangeStyle.childs().thinBars.value()?3:Math.max(3,.25*s.barSpacing());break;case 5:a=Math.max(4,.25*s.barSpacing());break;case 6:a=Math.max(5,.25*s.barSpacing())}const P=h-_*a;return{index:n.index,price:n.price,poleStartY:P,visualDirection:_,positionPointDirection:_,startsOnSeriesData:!0,priceCoordinate:h,indexCoordinate:s.indexToCoordinate(n.index)}}class P extends o.InplaceTextLineDataSource{constructor(){super(...arguments),this._startMovingAnchorY=NaN}priceSource(){return this.ownerSource()}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}addPoint(e,t,i){return super.addPoint(this._updatePositionAndCorrectPoint(e),t,i)}setPoint(e,t,i,r){r?super.setPoint(e,t,i,r):(super.setPoint(e,this._updatePositionAndCorrectPoint(t,!this.isPhantom()&&!this._allowChangeAnchorHorizontally()),i),this._syncPosition())}setPointAndChangeIndex(e,t,i){super.setPoint(e,this._updatePositionAndCorrectPoint(t),i),this._syncPosition()}startMoving(e,t,i,n){n||(this._startMovingAnchorY=(0,r.ensureNotNull)(this._anchorYCoordinate())),super.startMoving(e,t,i)}move(e,t,i,n){var o;const s=(0,r.ensureDefined)((0,r.ensureNotNull)(this.startMovingPoint()).logical),l=(0,r.ensureDefined)(e.logical);if(!n&&0===t){const e=this._points[0],t=l.index-s.index,i=(0,r.ensureNotNull)(this.priceScale()),n=(0,
r.ensure)(null===(o=this.ownerSource())||void 0===o?void 0:o.firstValue()),a=i.priceToCoordinate(l.price,n)-i.priceToCoordinate(s.price,n),c=this._startMovingAnchorY+a,u=i.coordinateToPrice(c,n);this._updatePositionAndCorrectPoint({index:e.index+t,price:u})}super.move(e,t,i),n||this._syncPosition()}_allowChangeAnchorHorizontally(){return!1}_updatePositionAndCorrectPoint(e,t=!1){t&&(e.index=this._points[0].index);const i=this.priceSource();if(null===i)return e;const r=i.priceScale(),n=i.firstValue();if(null===r||r.isEmpty()||null===n)return e;const o=r.height();let s=o/2,a=e.price>=r.coordinateToPrice(s,n)?1:-1;const c=this._model.mainSeries();if(i===c){const t=c.data().search(this._baseSeriesIndexForPoint(e));if(null!==t){const i=l(c,t,-1),o=l(c,t,1);a=e.price>=i?1:-1,s=r.priceToCoordinate(1===a?o:i,n),e.price=1===a?Math.max(o,e.price):e.price}}const u=1===(-1===a!==r.isInverted()?-1:1)?s:o-s,h=r.priceToCoordinate(e.price,n),d=Math.min(o,Math.abs(h-s)),p=Math.max(0,Math.min(100,100*d/u))*a;return this.properties().childs().position.setValue(p),e}_baseSeriesIndexForPoint(e){return e.index}_syncPosition(){const e=this.linkKey().value();if(null!==e){const t={position:this.properties().childs().position.value()};(0,s.changeLineStyle)({linkKey:e,state:t,model:this._model})}}_anchorYCoordinate(){const e=this.priceSource();if(null===e)return null;const t=e.priceScale(),i=e.firstValue();if(null===t||t.isEmpty()||null===i)return null;const r=this._model.mainSeries(),n=this.customEvent();if(null===n)return null;let o=null;if(e===r&&(o=d(r,n)),null===o&&(o=h(n,t,i)),null===o)return null;const s=n.position(),l=t.priceToCoordinate(o.price,i);return u(s,t.height(),l,c(s,t.isInverted()))}}},889301:(e,t,i)=>{i.d(t,{lineToolsLocalizedNames:()=>n});var r=i(444372);const n={LineTool5PointsPattern:r.t(null,void 0,i(942231)),LineToolABCD:r.t(null,void 0,i(246712)),LineToolArc:r.t(null,void 0,i(659324)),LineToolArrow:r.t(null,void 0,i(511858)),LineToolArrowMarkDown:r.t(null,void 0,i(673193)),LineToolArrowMarkLeft:r.t(null,void 0,i(401949)),LineToolArrowMarkRight:r.t(null,void 0,i(886275)),LineToolArrowMarkUp:r.t(null,void 0,i(162453)),LineToolBalloon:r.t(null,void 0,i(770540)),LineToolComment:r.t(null,void 0,i(309818)),LineToolBarsPattern:r.t(null,void 0,i(381994)),LineToolBezierCubic:r.t(null,void 0,i(77125)),LineToolBezierQuadro:r.t(null,void 0,i(678609)),LineToolBrush:r.t(null,void 0,i(243539)),LineToolCallout:r.t(null,void 0,i(925381)),LineToolCircleLines:r.t(null,void 0,i(584031)),LineToolCypherPattern:r.t(null,void 0,i(193191)),LineToolDateAndPriceRange:r.t(null,void 0,i(247017)),LineToolDateRange:r.t(null,void 0,i(485444)),LineToolDisjointAngle:r.t(null,void 0,i(91544)),LineToolElliottCorrection:r.t(null,void 0,i(980943)),LineToolElliottDoubleCombo:r.t(null,void 0,i(75112)),LineToolElliottImpulse:r.t(null,void 0,i(861114)),LineToolElliottTriangle:r.t(null,void 0,i(872359)),LineToolElliottTripleCombo:r.t(null,void 0,i(76129)),LineToolEllipse:r.t(null,void 0,i(978996)),LineToolExtended:r.t(null,void 0,i(452788)),
LineToolFibChannel:r.t(null,void 0,i(659005)),LineToolFibCircles:r.t(null,void 0,i(182330)),LineToolFibRetracement:r.t(null,void 0,i(855986)),LineToolFibSpeedResistanceArcs:r.t(null,void 0,i(633880)),LineToolFibSpeedResistanceFan:r.t(null,void 0,i(202395)),LineToolFibSpiral:r.t(null,void 0,i(239014)),LineToolFibTimeZone:r.t(null,void 0,i(930622)),LineToolFibWedge:r.t(null,void 0,i(485042)),LineToolFlagMark:r.t(null,void 0,i(514600)),LineToolImage:r.t(null,void 0,i(868065)),LineToolFlatBottom:r.t(null,void 0,i(745051)),LineToolAnchoredVWAP:r.t(null,void 0,i(584541)),LineToolGannComplex:r.t(null,void 0,i(844763)),LineToolGannFixed:r.t(null,void 0,i(960707)),LineToolGannFan:r.t(null,void 0,i(748683)),LineToolGannSquare:r.t(null,void 0,i(947460)),LineToolHeadAndShoulders:r.t(null,void 0,i(921928)),LineToolHorzLine:r.t(null,void 0,i(121795)),LineToolHorzRay:r.t(null,void 0,i(325487)),LineToolIcon:r.t(null,void 0,i(37913)),LineToolEmoji:r.t(null,void 0,i(273456)),LineToolSticker:r.t(null,void 0,i(443114)),LineToolInsidePitchfork:r.t(null,void 0,i(141686)),LineToolNote:r.t(null,void 0,i(986631)),LineToolTextNote:r.t(null,void 0,i(794389)),LineToolSignpost:r.t(null,void 0,i(467751)),LineToolParallelChannel:r.t(null,void 0,i(559256)),LineToolPitchfan:r.t(null,void 0,i(234156)),LineToolPitchfork:r.t(null,void 0,i(919634)),LineToolPolyline:r.t(null,void 0,i(239949)),LineToolPath:r.t(null,void 0,i(800371)),LineToolPrediction:r.t(null,void 0,i(920138)),LineToolPriceLabel:r.t(null,void 0,i(91282)),LineToolArrowMarker:r.t(null,void 0,i(936352)),LineToolPriceRange:r.t(null,void 0,i(768941)),LineToolProjection:r.t(null,void 0,i(375747)),LineToolRay:r.t(null,void 0,i(550318)),LineToolRectangle:r.t(null,void 0,i(426001)),LineToolCircle:r.t(null,void 0,i(191944)),LineToolRegressionTrend:r.t(null,void 0,i(802460)),LineToolRiskRewardLong:r.t(null,void 0,i(674832)),LineToolRiskRewardShort:r.t(null,void 0,i(508075)),LineToolFixedRangeVolumeProfile:r.t(null,{context:"study"},i(925705)),LineToolAnchoredVolumeProfile:r.t(null,{context:"study"},i(689633)),LineToolRotatedRectangle:r.t(null,void 0,i(56820)),LineToolSchiffPitchfork:r.t(null,void 0,i(657681)),LineToolSchiffPitchfork2:r.t(null,void 0,i(942608)),LineToolSineLine:r.t(null,void 0,i(839090)),LineToolText:r.t(null,{context:"tool"},i(691405)),LineToolTextAbsolute:r.t(null,void 0,i(642669)),LineToolThreeDrivers:r.t(null,void 0,i(46982)),LineToolTimeCycles:r.t(null,void 0,i(746852)),LineToolTrendAngle:r.t(null,void 0,i(35757)),LineToolTrendBasedFibExtension:r.t(null,void 0,i(680583)),LineToolTrendBasedFibTime:r.t(null,void 0,i(272159)),LineToolTrendLine:r.t(null,void 0,i(197339)),LineToolInfoLine:r.t(null,void 0,i(715992)),LineToolTriangle:r.t(null,void 0,i(901671)),LineToolTrianglePattern:r.t(null,void 0,i(390148)),LineToolVertLine:r.t(null,void 0,i(529535)),LineToolCrossLine:r.t(null,void 0,i(974334)),LineToolHighlighter:r.t(null,void 0,i(969476)),LineToolPriceNote:r.t(null,void 0,i(297512)),LineToolVbPFixed:r.t(null,void 0,i(840693)),LineToolGhostFeed:r.t(null,void 0,i(546808))}
;n.LineToolTweet=r.t(null,void 0,i(636549)),n.LineToolIdea=r.t(null,void 0,i(215982)),n.LineToolNoteAbsolute=r.t(null,void 0,i(363209)),n.LineToolTable=r.t(null,void 0,i(17981))},999872:(e,t,i)=>{var r=i(926799).LineToolTrading,n=i(750665).LineToolTradingPriceAxisView,o=i(831208),s=i(929927).LineDataSource,l=i(262624).DefaultProperty;const a=i(764829);var c=i(343272).sortSourcesPreOrdered.LineToolOrder;function u(e){return null==e?e="":e+="",e}class h{constructor(e){this._line=e,this._data={bodyText:"order",quantityText:"0"},this._editable=!0,this._cancellable=!0,this._mode="",this._direction="buy",this._active=!0}setMode(e){return this._mode=e,this._line.updateAllViewsAndRedraw(),this}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(),this}setActive(e){return this._active=e,this._line.updateAllViewsAndRedraw(),this}setEditable(e){return this._editable=e,this._line.updateAllViewsAndRedraw(),this}getEditable(){return this._editable}setCancellable(e){return this._cancellable=e,this._line.updateAllViewsAndRedraw(),this}getCancellable(){return this._cancellable}hasMoveCallback(){return this.isFunction(this._onMoveCallback)}hasModifyCallback(){return this.isFunction(this._onModifyCallback)}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line.setPoint(0,t),this._line.updateAllViewsAndRedraw()}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(),this}setTooltip(e){return this._line.properties().tooltip.setValue(u(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setModifyTooltip(e){return this._line.properties().modifyTooltip.setValue(u(e)),this}getModifyTooltip(){return this._line.properties().modifyTooltip.value()}setCancelTooltip(e){return this._line.properties().cancelTooltip.setValue(u(e)),this}getCancelTooltip(){return this._line.properties().cancelTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}setLineLength(e,t="percentage"){const i=t&&"pixel"===t?e:Math.max(0,Math.min(e,100));return this._line.properties().lineLength.setValue(i),this._line.properties().lineLengthUnit.setValue(t),this}getLineLengthUnit(){return this._line.properties().lineLengthUnit.value()}getLineColor(){var e=this._line.properties()
;return"buy"===this._direction?this._active?e.lineActiveBuyColor.value():e.lineInactiveBuyColor.value():this._active?e.lineActiveSellColor.value():e.lineInactiveSellColor.value()}setLineColor(e){return"buy"===this._direction?this._active?this.setLineActiveBuyColor(e):this.setLineInactiveBuyColor(e):this._active?this.setLineActiveSellColor(e):this.setLineInactiveSellColor(e),this}setLineActiveBuyColor(e){return this._line.properties().lineActiveBuyColor.setValue(e),this}setLineInactiveBuyColor(e){return this._line.properties().lineInactiveBuyColor.setValue(e),this}setLineActiveSellColor(e){return this._line.properties().lineActiveSellColor.setValue(e),this}setLineInactiveSellColor(e){return this._line.properties().lineInactiveSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.bodyBorderActiveBuyColor.value():e.bodyBorderInactiveBuyColor.value():this._active?e.bodyBorderActiveSellColor.value():e.bodyBorderInactiveSellColor.value()}setBodyBorderColor(e){return"buy"===this._direction?this._active?this.setBodyBorderActiveBuyColor(e):this.setBodyBorderInactiveBuyColor(e):this._active?this.setBodyBorderActiveSellColor(e):this.setBodyBorderInactiveSellColor(e),this}setBodyBorderActiveBuyColor(e){return this._line.properties().bodyBorderActiveBuyColor.setValue(e),this}setBodyBorderInactiveBuyColor(e){return this._line.properties().bodyBorderInactiveBuyColor.setValue(e),this}setBodyBorderActiveSellColor(e){return this._line.properties().bodyBorderActiveSellColor.setValue(e),this}setBodyBorderInactiveSellColor(e){return this._line.properties().bodyBorderInactiveSellColor.setValue(e),this}getBodyBackgroundColor(){return o.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return"limit"===this._mode?this._active?e.bodyTextActiveLimitColor.value():e.bodyTextInactiveLimitColor.value():"stop"===this._mode?this._active?e.bodyTextActiveStopColor.value():e.bodyTextInactiveStopColor.value():"buy"===this._direction?this._active?e.bodyTextActiveBuyColor.value():e.bodyTextInactiveBuyColor.value():this._active?e.bodyTextActiveSellColor.value():e.bodyTextInactiveSellColor.value()}setBodyTextColor(e){
return"limit"===this._mode?this._active?this.setBodyTextActiveLimitColor(e):this.setBodyTextInactiveLimitColor(e):"stop"===this._mode?this._active?this.setBodyTextActiveStopColor(e):this.setBodyTextInactiveStopColor(e):"buy"===this._direction?this._active?this.setBodyTextActiveBuyColor(e):this.setBodyTextInactiveBuyColor(e):this._active?this.setBodyTextActiveSellColor(e):this.setBodyTextInactiveSellColor(e),this}setBodyTextInactiveLimitColor(e){return this._line.properties().bodyTextInactiveLimitColor.setValue(e),this}setBodyTextActiveLimitColor(e){return this._line.properties().bodyTextActiveLimitColor.setValue(e),this}setBodyTextInactiveStopColor(e){return this._line.properties().bodyTextInactiveStopColor.setValue(e),this}setBodyTextActiveStopColor(e){return this._line.properties().bodyTextActiveStopColor.setValue(e),this}setBodyTextInactiveBuyColor(e){return this._line.properties().bodyTextInactiveBuyColor.setValue(e),this}setBodyTextActiveBuyColor(e){return this._line.properties().bodyTextActiveBuyColor.setValue(e),this}setBodyTextInactiveSellColor(e){return this._line.properties().bodyTextInactiveSellColor.setValue(e),this}setBodyTextActiveSellColor(e){return this._line.properties().bodyTextActiveSellColor.setValue(e),this}getBodyFont(){return o.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return o.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBorderActiveBuyColor.value():e.quantityBorderInactiveBuyColor.value():this._active?e.quantityBorderActiveSellColor.value():e.quantityBorderInactiveSellColor.value()}setQuantityBorderColor(e){return"buy"===this._direction?this._active?this.setQuantityBorderActiveBuyColor(e):this.setQuantityBorderInactiveBuyColor(e):this._active?this.setQuantityBorderActiveSellColor(e):this.setQuantityBorderInactiveSellColor(e),this}setQuantityBorderActiveBuyColor(e){return this._line.properties().quantityBorderActiveBuyColor.setValue(e),this}setQuantityBorderInactiveBuyColor(e){return this._line.properties().quantityBorderInactiveBuyColor.setValue(e),this}setQuantityBorderActiveSellColor(e){return this._line.properties().quantityBorderActiveSellColor.setValue(e),this}setQuantityBorderInactiveSellColor(e){return this._line.properties().quantityBorderInactiveSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBackgroundActiveBuyColor.value():e.quantityBackgroundInactiveBuyColor.value():this._active?e.quantityBackgroundActiveSellColor.value():e.quantityBackgroundInactiveSellColor.value()}setQuantityBackgroundColor(e){
return"buy"===this._direction?this._active?this.setQuantityBackgroundActiveBuyColor(e):this.setQuantityBackgroundInactiveBuyColor(e):this._active?this.setQuantityBackgroundActiveSellColor(e):this.setQuantityBackgroundInactiveSellColor(e),this}setQuantityBackgroundActiveBuyColor(e){return this._line.properties().quantityBackgroundActiveBuyColor.setValue(e),this}setQuantityBackgroundInactiveBuyColor(e){return this._line.properties().quantityBackgroundInactiveBuyColor.setValue(e),this}setQuantityBackgroundActiveSellColor(e){return this._line.properties().quantityBackgroundActiveSellColor.setValue(e),this}setQuantityBackgroundInactiveSellColor(e){return this._line.properties().quantityBackgroundInactiveSellColor.setValue(e),this}getQuantityTextColor(){return o.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return o.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return o.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return o.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getCancelButtonBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonBorderActiveBuyColor.value():e.cancelButtonBorderInactiveBuyColor.value():this._active?e.cancelButtonBorderActiveSellColor.value():e.cancelButtonBorderInactiveSellColor.value()}setCancelButtonBorderColor(e){return"buy"===this._direction?this._active?this.setCancelButtonBorderActiveBuyColor(e):this.setCancelButtonBorderInactiveBuyColor(e):this._active?this.setCancelButtonBorderActiveSellColor(e):this.setCancelButtonBorderInactiveSellColor(e),this}setCancelButtonBorderActiveBuyColor(e){return this._line.properties().cancelButtonBorderActiveBuyColor.setValue(e),this}setCancelButtonBorderInactiveBuyColor(e){return this._line.properties().cancelButtonBorderInactiveBuyColor.setValue(e),this}setCancelButtonBorderActiveSellColor(e){return this._line.properties().cancelButtonBorderActiveSellColor.setValue(e),this}setCancelButtonBorderInactiveSellColor(e){return this._line.properties().cancelButtonBorderInactiveSellColor.setValue(e),this}getCancelButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency)}setCancelButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency),this}getCancelButtonIconColor(){var e=this._line.properties()
;return"buy"===this._direction?this._active?e.cancelButtonIconActiveBuyColor.value():e.cancelButtonIconInactiveBuyColor.value():this._active?e.cancelButtonIconActiveSellColor.value():e.cancelButtonIconInactiveSellColor.value()}setCancelButtonIconColor(e){return"buy"===this._direction?this._active?this.setCancelButtonIconActiveBuyColor(e):this.setCancelButtonIconInactiveBuyColor(e):this._active?this.setCancelButtonIconActiveSellColor(e):this.setCancelButtonIconInactiveSellColor(e),this}setCancelButtonIconActiveBuyColor(e){return this._line.properties().cancelButtonIconActiveBuyColor.setValue(e),this}setCancelButtonIconInactiveBuyColor(e){return this._line.properties().cancelButtonIconInactiveBuyColor.setValue(e),this}setCancelButtonIconActiveSellColor(e){return this._line.properties().cancelButtonIconActiveSellColor.setValue(e),this}setCancelButtonIconInactiveSellColor(e){return this._line.properties().cancelButtonIconInactiveSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw()}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw()}getBlocked(){return this._blocked}isFunction(e){return"function"==typeof e}onCancel(e,t){return t?this.isFunction(t)&&(this._onCancelData=e,this._onCancelCallback=t):this.isFunction(e)&&(this._onCancelCallback=e),this}callOnCancel(){this.isFunction(this._onCancelCallback)&&this._onCancelCallback.call(this,this._onCancelData)}isOnCancelCallbackPresent(){return this.isFunction(this._onCancelCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onMove(e,t){return t?this.isFunction(t)&&(this._onMoveData=e,this._onMoveCallback=t):this.isFunction(e)&&(this._onMoveCallback=e),this}callOnMove(){this.isFunction(this._onMoveCallback)&&this._onMoveCallback.call(this,this._onMoveData)}onMoving(e,t){return t?this.isFunction(t)&&(this._onMovingData=e,this._onMovingCallback=t):this.isFunction(e)&&(this._onMovingCallback=e),this}callOnMoving(){this.isFunction(this._onMovingCallback)&&this._onMovingCallback.call(this,this._onMovingData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class d extends r{constructor(e,t){super(e,t||d.createProperties()),this._adapter=new h(this),this.setSelectionEnabled(!0),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,115765)).then((({OrderPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}zorder(){return c}isSpeciallyZOrderedSource(){
return!0}setPoint(e,t){this._points[e]=t,this._normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}name(){return"Order"}move(e,t,i,r){var n=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.move(e,t,i,r),n&&this._adapter.callOnMoving()}endMoving(e){var t=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.endMoving(),!e&&t&&this._adapter.callOnMove()}createPriceAxisView(e){var t={pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()};return this._priceAxisView=new n(this,t),this._priceAxisView}paneViews(){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?s.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?s.prototype.priceAxisViews.call(this,e,t):null}adapter(){return this._adapter}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}movable(){return Boolean(this._adapter._onMoveCallback)}formatter(){return this._formatter}static createProperties(e){var t=new l({defaultName:"linetoolorder",state:e,useUserPreferences:!1});return this._configureProperties(t),t}}t.LineToolOrder=d},97917:(e,t,i)=>{i.d(t,{LineToolParallelChannel:()=>d});var r=i(650151),n=i(86441),o=i(354957),s=i(124829),l=i(419283),a=i(929927),c=i(658843),u=i(821571);class h extends c.Property{constructor(e){super(0),this._source=e}value(){var e;const t=this._source.points();if(3!==t.length)return 0;const i=t[2].price-t[0].price,r=null===(e=this._source.ownerSource())||void 0===e?void 0:e.symbolSource().symbolInfo(),n=r?r.pricescale/r.minmov:100;return Math.round(i*n)/n}setValue(e){const t=this._source.points();if(3===t.length){const i={...t[2],price:t[0].price+e},r=this._source.model();r.startChangingLinetool(this._source,{...i},6),r.changeLinePoint({...i}),r.endChangingLinetool(!1),this._listeners.fire(this,"")}}}class d extends a.LineDataSource{constructor(e,t,r,n){super(e,t||d.createProperties(),r,n),this.version=2,this._priceOffsetProperty=new h(this),this._priceAxisViews.push(this.createPriceAxisView(3)),this._coordOffsetWhileMovingOrChanging=null,this._pendingPriceOffset=null,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,422700)).then((({ParallelChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})),o.alertsAvailable&&this._normalizedPointsChanged.subscribe(this,this._updateAlertCreationAvailable)}levelsCount(){return u.coeffs.length}paneViews(e){return null!==this._pendingPriceOffset&&this._applyPendingPriceOffset(),super.paneViews(e)}snapTo45DegreesAvailable(){return!0}setLastPoint(e,t){
this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[0]);const i=(0,s.clone)(e);return super.setLastPoint(e,t,!1),i}startMoving(e,t,i,r){super.startMoving(e,t,i,r),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endMoving(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endMoving(e,t,i)}startChanging(e,t){super.startChanging(e,t),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endChanging(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endChanging(e,t,i)}restoreExternalPoints(e,t){if(super.restoreExternalPoints(e,t),t.pricesChanged&&this._points.length===e.points.length)for(let t=0;t<e.points.length;t++)this._points[t].price=e.points[t].price}restorePoints(e,t,i){super.restorePoints(e,t,i),this._alertCreationAvailable.setValue(super.alertCreationAvailable().value()&&this._isTimePointsValid())}setPoint(e,t,i,n){var o;if(this._points[0].index===this._points[1].index&&e>=4)return;this._snapPointBeforeChange(e,t,i);const s=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),c=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),u=(0,r.ensureNotNull)(this._coordOffsetWhileMovingOrChanging),h=(0,r.ensureNotNull)(this.priceScale()),d=(0,r.ensure)(null===(o=this.ownerSource())||void 0===o?void 0:o.firstValue()),p=this._model.mainSeries().interval();switch(e){case 0:super._setPoint(e,{...t,interval:p}),this._points[2].price=h.coordinateToPrice(c.y+u,d);break;case 1:super._setPoint(e,{...t,interval:p});break;case 2:super._setPoint(e,{...t,interval:p}),this._points[0].price=h.coordinateToPrice(c.y-u,d),this._points[0].index=t.index,this._points[0].interval=p;break;case 3:this._points[1].price=h.coordinateToPrice(c.y-u,d),this._points[1].index=t.index,this._points[1].interval=p;break;case 4:{const e=a.subtract(s),t=(c.x-s.x)/e.x,i=s.addScaled(e,t),r=c.y-i.y;this._points[2].price=h.coordinateToPrice(s.y+r,d);break}case 5:{const e=a.subtract(s),t=(c.x-s.x)/e.x,i=s.addScaled(e,t),r=c.y-i.y;this._points[0].price=h.coordinateToPrice(s.y+r,d),this._points[1].price=h.coordinateToPrice(a.y+r,d);break}case 6:this._points[2].price=t.price}const _=this.linkKey().value();if(_&&!n&&e<4){const e=this._points.map((e=>e.price));(0,l.changeLineStyle)({model:this._model,linkKey:_,state:{prices:e}})}}state(e){const t=super.state(e);return this._pendingPriceOffset&&(t.priceOffset=this._pendingPriceOffset),t}restoreExternalState(e){const{prices:t,...i}=e;if(t&&this.isActualSymbol())for(let e=0;e<t.length;e++)this._points[e].price=this._timePoint[e].price=t[e];super.restoreExternalState(i)}restoreData(e){void 0!==e.priceOffset&&(this._pendingPriceOffset=e.priceOffset)}getPoint(e){if(e<3)return super.getPoint(e);const t=this.pointToScreenPoint(this._points[0]),i=this.pointToScreenPoint(this._points[1]),r=this.pointToScreenPoint(this._points[2]);if(!t||!i||!r)return null;switch(e){case 3:{const e=r.y-t.y,o=i.add(new n.Point(0,e));return this.screenPointToPoint(o)}case 4:{
const e=r.y-t.y,o=i.add(new n.Point(0,e)),s=r.add(o).scaled(.5);return this.screenPointToPoint(s)}case 5:{const e=t.add(i).scaled(.5);return this.screenPointToPoint(e)}}return null}alignCrossHairToAnchor(e){return e<=3}pointsCount(){return 3}name(){return"Parallel Channel"}hasEditableCoordinates(){return!0}addPoint(e,t,i){return this._snapTo45DegreesApplicable(t)&&1===this._points.length&&this.snapPoint45Degree(e,this.points()[0]),2===this._points.length&&(e=this._convertLastPointTo3rdPoint((0,r.ensureNotNull)(this._lastPoint))),this._addPointIntenal(e,t,i)}timeAxisPoints(){return this._axisPoints()}priceAxisPoints(){return this._axisPoints()}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}hasStateForAlert(){return super.hasStateForAlert()&&this._isTimePointsValid()}priceOffsetProperty(){return this._priceOffsetProperty}static createProperties(e){const t=u.LineToolParallelChannelPropertiesImpl.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,683432))).ParallelChannelDefinitionsViewModel}_applyTemplateImpl(e){var t;super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(null!==(t=e.labelText)&&void 0!==t?t:"")}_getAlertPlots(){const e=this.getPoint(3);if(!e)return[];const t=[this._points[0],this._points[1],this._points[2],e],i=(e,t)=>e.index<=t.index?[e,t]:[t,e],r=i(t[0],t[1]),n=i(t[2],t[3]);let o,s,l,a;t[2].price<t[0].price?(s=n,o=r):(s=r,o=n);const c=this.properties().childs().extendLeft.value(),u=this.properties().childs().extendRight.value();return t[0].index<=t[1].index?(l=c,a=u):(l=u,a=c),[this._linePointsToAlertPlot(o,"Upper",l,a),this._linePointsToAlertPlot(s,"Lower",l,a)].filter((e=>null!==e))}_correctLastPoint(e){if(this._points.length<2||this._points[1].index===this._points[0].index)return e;const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),o=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),s=i.subtract(o),l=(t.x-o.x)/s.x,a=o.addScaled(s,l),c=t.y-a.y,u=o.add(new n.Point(0,c));return(0,r.ensureNotNull)(this.screenPointToPoint(u))}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new c.Property("")),e.addExcludedKey("labelText",1)}_isTimePointsValid(){return this._timePoint.every((e=>Number.isFinite(e.price)))}_axisPoints(){const e=this.points(),t=this._points[0]?this.pointToScreenPoint(this._points[0]):null,i=this._points[1]?this.pointToScreenPoint(this._points[1]):null,o=this._points[2]?this.pointToScreenPoint(this._points[2]):null;if(t&&i&&o){const s=i.y-t.y,l=o.add(new n.Point(0,s));e.push((0,r.ensureNotNull)(this.screenPointToPoint(l)))}return e}_convertLastPointTo3rdPoint(e){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),o=(0,
r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),s=i.subtract(o),l=(t.x-o.x)/s.x,a=o.addScaled(s,l),c=t.y-a.y,u=o.add(new n.Point(0,c));return(0,r.ensureNotNull)(this.screenPointToPoint(u))}_findPixelsHeight(){const e=this.pointToScreenPoint(this._points[2]),t=this.pointToScreenPoint(this._points[0]);return e&&t?e.y-t.y:null}_applyPendingPriceOffset(){const e=this._pendingPriceOffset;if(null===e||this._points.length<3)return;const t=this.priceScale(),i=(0,r.ensureNotNull)(this.ownerSource()).firstValue();if(!t||t.isEmpty()||null===i)return;const n=e+this._points[0].price,o=e+this._points[1].price,s=.5*(n+o)-e,l=.5*(n+o),a=t.priceToCoordinate(s,i),c=t.priceToCoordinate(l,i)-a,u=t.priceToCoordinate(this._points[0].price,i)+c,h=t.coordinateToPrice(u,i);this._points[2].price=h,this._timePoint[2].price=h,this._points[2].index=this._points[0].index,this._timePoint[2].time_t=this._timePoint[0].time_t,this._timePoint[2].offset=this._timePoint[0].offset,this._pendingPriceOffset=null}_snapPointBeforeChange(e,t,i){if(this._snapTo45DegreesApplicable(i))switch(e){case 0:case 1:this.snapPoint45Degree(t,this._points[1-e]);break;case 2:case 3:const i=(0,r.ensureNotNull)(this.getPoint(5-e));this.snapPoint45Degree(t,i)}}}},821571:(e,t,i)=>{i.d(t,{LineToolParallelChannelPropertiesImpl:()=>S,coeffs:()=>v});var r=i(154834),n=i(998034),o=i(650151),s=i(553407),l=i(61499),a=i(666574),c=i(436687),u=i(985429),h=i(262624),d=i(825446),p=i(23666),_=i(714512),P=i(331633);const v=[-.25,0,.25,.5,.75,1,1.25];const m={intervalsVisibilities:{...u.intervalsVisibilitiesDefaults},...function(){const e={};return v.forEach(((t,i)=>{e[`level${i+1}`]={visible:[1,3,5].includes(i),coeff:t,lineStyle:3===i?a.LINESTYLE_DASHED:a.LINESTYLE_SOLID,lineWidth:[1,5].includes(i)?2:1}})),e}(),extendLeft:!1,extendRight:!1,fillBackground:!0,transparency:80,labelVisible:!1,labelHorzAlign:"left",labelVertAlign:"top",labelFontSize:14,labelBold:!1,labelItalic:!1,version:2};const g={...function(){const e={};for(let t=0;t<v.length;t++)e[`level${t+1}`]={color:"#2962ff"};return e}(),labelTextColor:s.colors.colorTvBlue500,backgroundColor:s.colors.colorTvBlue500Alpha20},f=new Map([[l.StdTheme.Light,g],[l.StdTheme.Dark,g]]),y="linetoolparallelchannel",T=(0,h.extractAllPropertiesKeys)((0,o.ensureDefined)(f.get(l.StdTheme.Light))),C=(0,h.extractAllPropertiesKeys)(m),x=[...T,...C,"labelText"],w=[...T,...C,...c.commonLineToolPropertiesStateKeys,"labelText"];function b(e){var t;const{linecolor:i,linestyle:o,linewidth:s,showMidline:a,midlinecolor:c,midlinestyle:u,midlinewidth:h,...d}=e;return{...(0,n.default)((0,r.default)(m),null!==(t=f.get(P.watchedTheme.value()))&&void 0!==t?t:f.get(l.StdTheme.Light)),...d,level4:{visible:a,color:c,lineStyle:u,lineWidth:h,coeff:.5},level2:{color:i,lineStyle:o,lineWidth:s,visible:!0,coeff:0},level6:{color:i,lineStyle:o,lineWidth:s,visible:!0,coeff:1}}}class S extends d.LineDataSourceProperty{constructor(e){1===(e.state&&"version"in e.state?e.state.version:1)&&e.state&&(e.state=b(e.state),e.state=(0,h.extractState)(e.state,e.allStateKeys)),
super(e),this.addChild("linesColors",new p.LineToolColorsProperty(v.map(((e,t)=>(0,o.ensureDefined)(this.child(`level${t+1}`)).childs().color)))),this.addChild("linesWidths",new p.LineToolWidthsProperty(v.map(((e,t)=>(0,o.ensureDefined)(this.child(`level${t+1}`)).childs().lineWidth))))}applyTemplate(e){1===("version"in e?e.version:1)&&(e=b(e),e=(0,h.extractState)(e,this._templateKeys)),super.applyTemplate(e)}static create(e){return new this({defaultName:y,factoryDefaultsSupplier:()=>(0,_.factoryDefaultsForCurrentTheme)(m,f),nonThemedDefaultsKeys:C,themedDefaultsKeys:T,templateKeys:x,allStateKeys:w,state:e})}_userSettings(){let e=(0,h.createDefaultsState)(!0,y,[],null);return 1===(e&&"version"in e?e.version:1)&&(e=b(e)),(0,h.extractState)((0,r.default)(e),this._allDefaultsKeys,this._excludedDefaultsKeys)}}},966293:(e,t,i)=>{i.d(t,{LineToolPath:()=>c});var r=i(650151),n=i(86441),o=i(262624),s=i(286436),l=i(929927),a=i(23666);class c extends l.LineDataSource{constructor(e,t,r,n){const o=t||c.createProperties();super(e,o,r,n),this._finished=!1,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,968257)).then((t=>{this._setPaneViews([new t.PathPaneView(this,e)])}))}pointsCount(){return-1}name(){return"Path"}hasEditableCoordinates(){return!1}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}addPoint(e,t,i,o){var l;if(this._finished)return!0;const a=(0,r.ensureNotNull)(this.priceScale()),c=this._model.timeScale().indexToCoordinate(e.index),u=e.price,h=(0,r.ensure)(null===(l=this.ownerSource())||void 0===l?void 0:l.firstValue()),d=a.priceToCoordinate(u,h);if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),r=e.price,l=a.priceToCoordinate(r,h),u=new n.Point(c,d).subtract(new n.Point(i,l)).length();if(!(null==t?void 0:t.isApiEvent())&&u<(0,s.interactionTolerance)().minDistanceBetweenPoints&&!o)return this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}static createProperties(e){const t=new o.DefaultProperty({defaultName:"linetoolpath",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,416871)).then((e=>e.PathDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesWidths",new a.LineToolWidthsProperty([(0,r.ensureDefined)(e.child("lineWidth"))])),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().lineColor]))}}},474539:(e,t,i)=>{i.d(t,{LineToolPitchfan:()=>h});var r=i(650151),n=i(444372),o=i(329944),s=i(370407),l=i(469805),a=i(929927),c=i(23666);const u=new s.TranslatedString("erase level line",n.t(null,void 0,i(735111)));class h extends a.LineDataSource{constructor(e,t,r,n){super(e,t||h.createProperties(),r,n),
Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,237484)).then((({PitchfanLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 8}pointsCount(){return 3}name(){return"Pitchfan"}processErase(e,t){const i="level"+t,r=this.properties().child(i).childs().visible;e.setProperty(r,!1,u,l.lineToolsDoNotAffectChartInvalidation)}static createProperties(e){const t=new o.LevelsProperty({defaultName:"linetoolpitchfan",state:e,map:{range:[0,8]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,36573))).PitchBaseDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().median.childs().linewidth],i=[e.childs().median.childs().color];for(let n=0;n<=8;n++){const o=(0,r.ensureDefined)(e.child("level"+n));t.push((0,r.ensureDefined)(o.child("linewidth"))),i.push((0,r.ensureDefined)(o.child("color")))}e.addChild("linesColors",new c.LineToolColorsProperty(i)),e.addChild("linesWidths",new c.LineToolWidthsProperty(t))}}},99269:(e,t,i)=>{i.d(t,{LineToolPitchfork:()=>P});var r=i(650151),n=i(370407),o=i(444372),s=i(691371),l=i(329944),a=i(469805),c=i(929927),u=i(23666),h=i(169532),d=i(10309);const p=new n.TranslatedString("erase level line",o.t(null,void 0,i(735111))),_=new n.TranslatedString("change {title} style",o.t(null,void 0,i(598463)));class P extends c.LineDataSource{constructor(e,t,i,r){super(e,t||P.createProperties(),i,r),this._properties.childs().style.listeners().subscribe(this,this._recreatePaneView),this._recreatePaneView()}pointsCount(){return 3}name(){return"Pitchfork"}levelsCount(){return 8}additionalActions(e){const t=[],r=[{title:o.t(null,void 0,i(546005)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToOriginal"},{title:o.t(null,void 0,i(170382)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToModifiedSchiff"},{title:o.t(null,void 0,i(391612)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToInside"},{title:o.t(null,void 0,i(469904)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToSchiff"}];for(let i=0;i<4;i++){const o=new s.Action({actionId:r[i].actionId,options:{checked:this.properties().childs().style.value()===i,checkable:!0,label:r[i].title,onExecute:()=>{e.setProperty(this.properties().childs().style,i,_.format({title:new n.TranslatedString(this.name(),this.translatedType())}),a.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,h.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}});t.push(o)}return[t[0],t[3],t[1],t[2]]}processErase(e,t){const i="level"+t,r=this.properties().child(i).childs().visible;e.setProperty(r,!1,p,a.lineToolsDoNotAffectChartInvalidation)}static createProperties(e){const t=new l.LevelsProperty({defaultName:"linetoolpitchfork",state:e,map:{range:[0,8]}});return this._configureProperties(t),t}async _recreatePaneView(){
Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,44857)).then((e=>{let t=[];const i=this._properties.childs().style.value();i===d.LineToolPitchforkStyle.Original?t=[new e.PitchforkLinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Schiff?t=[new e.SchiffPitchforkLinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Schiff2?t=[new e.SchiffPitchfork2LinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Inside&&(t=[new e.InsidePitchforkLinePaneView(this,this._model)]),this._setPaneViews(t)}))}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,596997))).PitchForkDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().median.childs().linewidth],i=[e.childs().median.childs().color];for(let n=0;n<=8;n++){const o=(0,r.ensureDefined)(e.child("level"+n));t.push((0,r.ensureDefined)(o.child("linewidth"))),i.push((0,r.ensureDefined)(o.child("color")))}e.addChild("linesColors",new u.LineToolColorsProperty(i)),e.addChild("linesWidths",new u.LineToolWidthsProperty(t))}}},948029:(e,t,i)=>{i.d(t,{LineToolPolyline:()=>a});var r=i(650151),n=i(86441),o=i(262624),s=i(286436),l=i(929927);class a extends l.LineDataSource{constructor(e,t,r,n){const o=t||a.createProperties();super(e,o,r,n),this._finished=!1,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,551256)).then((t=>{this._setPaneViews([new t.PolylinePaneView(this,e)])}))}pointsCount(){return-1}name(){return"Polyline"}hasEditableCoordinates(){return!1}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}addPoint(e,t,i,o){var l;if(this._finished)return!0;const a=(0,r.ensureNotNull)(this.priceScale()),c=this._model.timeScale().indexToCoordinate(e.index),u=e.price,h=(0,r.ensure)(null===(l=this.ownerSource())||void 0===l?void 0:l.firstValue()),d=a.priceToCoordinate(u,h),p=(0,s.interactionTolerance)().minDistanceBetweenPoints;if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),r=e.price,s=a.priceToCoordinate(r,h),l=new n.Point(c,d).subtract(new n.Point(i,s)).length();if(!(null==t?void 0:t.isApiEvent())&&l<p&&!o)return this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0;const u=this._points[0],_=this._model.timeScale().indexToCoordinate(u.index),P=a.priceToCoordinate(u.price,h),v=new n.Point(c,d).subtract(new n.Point(_,P)).length();if(!(null==t?void 0:t.isApiEvent())&&v<p&&!o)return this.properties().childs().filled.setValue(!0),this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}setPoint(e,t,i){var o;super.setPoint(e,t,i);const l=this.priceScale();if(!(this._model.timeScale().isEmpty()||null===l||l.isEmpty()||e!==this._points.length-1&&0!==e)){const i=(0,
r.ensure)(null===(o=this.ownerSource())||void 0===o?void 0:o.firstValue()),a=this._model.timeScale().indexToCoordinate(t.index),c=l.priceToCoordinate(t.price,i),u=e===this._points.length-1?this._points[0]:this._points[this._points.length-1],h=this._model.timeScale().indexToCoordinate(u.index),d=l.priceToCoordinate(u.price,i);new n.Point(a,c).subtract(new n.Point(h,d)).length()<(0,s.interactionTolerance)().minDistanceBetweenPoints&&this.properties().childs().filled.setValue(!0)}}static createProperties(e){const t=new o.DefaultProperty({defaultName:"linetoolpolyline",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,369839)).then((e=>e.PolylinesDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("filled",1)}}},284682:(e,t,i)=>{var r=i(926799).LineToolTrading,n=i(929927).LineDataSource,o=i(750665).LineToolTradingPriceAxisView,s=i(831208),l=i(262624).DefaultProperty;const a=i(764829);var c=i(343272).sortSourcesPreOrdered.LineToolPosition;function u(e){return null==e?e="":e+="",e}class h{constructor(e){this._line=e,this._data={bodyText:"position",quantityText:"0"},this._closeEnabled=!0,this._direction="buy",this._profitState="neutral"}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(),this}setProfitState(e){return this._profitState=e,this._line.updateAllViewsAndRedraw(),this}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line.setPoint(0,t),this._line.updateAllViewsAndRedraw()}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(),this}setTooltip(e){return this._line.properties().tooltip.setValue(u(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setProtectTooltip(e){return this._line.properties().protectTooltip.setValue(u(e)),this}getProtectTooltip(){return this._line.properties().protectTooltip.value()}setCloseTooltip(e){return this._line.properties().closeTooltip.setValue(u(e)),this}getCloseTooltip(){return this._line.properties().closeTooltip.value()}setReverseTooltip(e){return this._line.properties().reverseTooltip.setValue(u(e)),this}getReverseTooltip(){return this._line.properties().reverseTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value()
;return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}getLineLengthUnit(){return this._line.properties().lineLengthUnit.value()}setLineLength(e,t="percentage"){const i=t&&"pixel"===t?e:Math.max(0,Math.min(e,100));return this._line.properties().lineLength.setValue(i),this._line.properties().lineLengthUnit.setValue(t),this}getLineColor(){var e=this._line.properties();return("buy"===this._direction?e.lineBuyColor:e.lineSellColor).value()}setLineColor(e){return"buy"===this._direction?this.setLineBuyColor(e):this.setLineSellColor(e),this}setLineBuyColor(e){return this._line.properties().lineBuyColor.setValue(e),this}setLineSellColor(e){return this._line.properties().lineSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.bodyBorderBuyColor:e.bodyBorderSellColor).value()}setBodyBorderColor(e){return"buy"===this._direction?this.setBodyBorderBuyColor(e):this.setBodyBorderSellColor(e),this}setBodyBorderBuyColor(e){return this._line.properties().bodyBorderBuyColor.setValue(e),this}setBodyBorderSellColor(e){return this._line.properties().bodyBorderSellColor.setValue(e),this}getBodyBackgroundColor(){return s.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return s.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return("positive"===this._profitState?e.bodyTextPositiveColor:"negative"===this._profitState?e.bodyTextNegativeColor:e.bodyTextNeutralColor).value()}setBodyTextColor(e){return"positive"===this._profitState?this.setBodyTextPositiveColor(e):"negative"===this._profitState?this.setBodyTextNegativeColor(e):this.setBodyTextNeutralColor(e),this}setBodyTextPositiveColor(e){return this._line.properties().bodyTextPositiveColor.setValue(e),this}setBodyTextNegativeColor(e){return this._line.properties().bodyTextNegativeColor.setValue(e),this}setBodyTextNeutralColor(e){return this._line.properties().bodyTextNeutralColor.setValue(e),this}getBodyFont(){return s.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return s.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){
var e=this._line.properties();return("buy"===this._direction?e.quantityBorderBuyColor:e.quantityBorderSellColor).value()}setQuantityBorderColor(e){return"buy"===this._direction?this.setQuantityBorderBuyColor(e):this.setQuantityBorderSellColor(e),this}setQuantityBorderBuyColor(e){return this._line.properties().quantityBorderBuyColor.setValue(e),this}setQuantityBorderSellColor(e){return this._line.properties().quantityBorderSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBackgroundBuyColor:e.quantityBackgroundSellColor).value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this.setQuantityBackgroundBuyColor(e):this.setQuantityBackgroundSellColor(e),this}setQuantityBackgroundBuyColor(e){return this._line.properties().quantityBackgroundBuyColor.setValue(e),this}setQuantityBackgroundSellColor(e){return this._line.properties().quantityBackgroundSellColor.setValue(e),this}getQuantityTextColor(){return s.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return s.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return s.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return s.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getReverseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonBorderBuyColor:e.reverseButtonBorderSellColor).value()}setReverseButtonBorderColor(e){return"buy"===this._direction?this.setReverseButtonBorderBuyColor(e):this.setReverseButtonBorderSellColor(e),this}setReverseButtonBorderBuyColor(e){return this._line.properties().reverseButtonBorderBuyColor.setValue(e),this}setReverseButtonBorderSellColor(e){return this._line.properties().reverseButtonBorderSellColor.setValue(e),this}getReverseButtonBackgroundColor(){return s.getColorFromProperties(this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency)}setReverseButtonBackgroundColor(e){return s.setColorToProperties(e,this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency),this}getReverseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonIconBuyColor:e.reverseButtonIconSellColor).value()}setReverseButtonIconColor(e){return"buy"===this._direction?this.setReverseButtonIconBuyColor(e):this.setReverseButtonIconSellColor(e),this}setReverseButtonIconBuyColor(e){return this._line.properties().reverseButtonIconBuyColor.setValue(e),this}setReverseButtonIconSellColor(e){
return this._line.properties().reverseButtonIconSellColor.setValue(e),this}getCloseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonBorderBuyColor:e.closeButtonBorderSellColor).value()}setCloseButtonBorderColor(e){return"buy"===this._direction?this.setCloseButtonBorderBuyColor(e):this.setCloseButtonBorderSellColor(e),this}setCloseButtonBorderBuyColor(e){return this._line.properties().closeButtonBorderBuyColor.setValue(e),this}setCloseButtonBorderSellColor(e){return this._line.properties().closeButtonBorderSellColor.setValue(e),this}getCloseButtonBackgroundColor(){return s.getColorFromProperties(this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency)}setCloseButtonBackgroundColor(e){return s.setColorToProperties(e,this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency),this}getCloseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonIconBuyColor:e.closeButtonIconSellColor).value()}setCloseButtonIconColor(e){return"buy"===this._direction?this.setCloseButtonIconBuyColor(e):this.setCloseButtonIconSellColor(e),this}setCloseButtonIconBuyColor(e){return this._line.properties().closeButtonIconBuyColor.setValue(e),this}setCloseButtonIconSellColor(e){return this._line.properties().closeButtonIconSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw()}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw()}isFunction(e){return"function"==typeof e}onReverse(e,t){return t?this.isFunction(t)&&(this._onReverseData=e,this._onReverseCallback=t):this.isFunction(e)&&(this._onReverseCallback=e),this}callOnReverse(){this.isFunction(this._onReverseCallback)&&this._onReverseCallback.call(this,this._onReverseData)}isOnReverseCallbackPresent(){return this.isFunction(this._onReverseCallback)}onClose(e,t){return t?this.isFunction(t)&&(this._onCloseData=e,this._onCloseCallback=t):this.isFunction(e)&&(this._onCloseCallback=e),this}setCloseEnabled(e){return this._closeEnabled===e||(this._closeEnabled=e,this._onCloseCallback&&this._line.updateAllViewsAndRedraw()),this}isCloseEnabled(){return this._closeEnabled}callOnClose(){this.isFunction(this._onCloseCallback)&&this._closeEnabled&&this._onCloseCallback.call(this,this._onCloseData)}isOnCloseCallbackPresent(){return this._closeEnabled&&this.isFunction(this._onCloseCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){
if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class d extends r{constructor(e,t){super(e,t||d.createProperties()),this._adapter=new h(this),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.t.bind(i,458897,19)).then((({PositionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}adapter(){return this._adapter}zorder(){return c}isSpeciallyZOrderedSource(){return!0}setPoint(e,t){this._points[e]=t,this._normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}name(){return"Position"}createPriceAxisView(e){return this._priceAxisView=new o(this,{pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()}),this._priceAxisView}paneViews(){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?n.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?n.prototype.priceAxisViews.call(this,e,t):null}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}formatter(){return this._formatter}static createProperties(e){var t=new l({defaultName:"linetoolposition",state:e,useUserPreferences:!1});return this._configureProperties(t),t}}t.LineToolPosition=d},695813:(e,t,i)=>{var r,n;i.d(t,{AlertStatus:()=>r,Direction:()=>n}),function(e){e[e.Waiting=0]="Waiting",e[e.Success=1]="Success",e[e.Failure=2]="Failure"}(r||(r={})),function(e){e[e.Up=1]="Up",e[e.Down=2]="Down"}(n||(n={}))},688684:(e,t,i)=>{i.d(t,{LineToolPrediction:()=>a});var r=i(650151),n=i(262624),o=i(658843),s=i(929927),l=i(695813);class a extends s.LineDataSource{constructor(e,t,r,n){const o=t||a.createProperties();super(e,o,r,n),this._predictionPaneView=null;const s=this._model.mainSeries();s.properties().childs().interval.subscribe(this,(()=>{this.setStatus(l.AlertStatus.Waiting)})),s.dataEvents().dataUpdated().subscribe(this,this.recalculateStateByData),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,696531)).then((t=>{this._predictionPaneView=new t.PredictionPaneView(this,e),this._setPaneViews([this._predictionPaneView])}))}destroy(){const e=this._model.mainSeries();e.properties().childs().interval.unsubscribeAll(this),e.dataEvents().dataUpdated().unsubscribeAll(this),super.destroy()}dataAndViewsReady(){return super.dataAndViewsReady()&&Boolean(this._predictionPaneView&&this._predictionPaneView.iconsReady())}cloneable(){return!1}isSynchronizable(){return!1}status(){return this._properties.childs().status.value()}setStatus(e){return this._properties.childs().status.setValue(e)}pointsCount(){return 2}
name(){return"Forecast"}restorePoints(e,t,i){super.restorePoints(e,t,i),this.recalculateStateByData()}recalculateStateByData(){if(this.isSourceHidden())return;if(this._points.length<2)return;if(this._model.mainSeries().bars().isEmpty())return;const e=this._points[1];if(this.status())return void(e.index>this._model.timeScale().baseIndex()&&this.setStatus(l.AlertStatus.Waiting));const t=this._model.mainSeries().bars().valueAt(e.index);if(null===t)return;const i=this.direction();if(i===l.Direction.Up&&(0,r.ensure)(t[2])>=e.price)this.setStatus(l.AlertStatus.Success);else if(i===l.Direction.Down&&(0,r.ensure)(t[3])<=e.price)this.setStatus(l.AlertStatus.Success);else{const t=(0,r.ensureNotNull)(this._model.mainSeries().bars().lastIndex());e.index!==t&&this.setStatus(l.AlertStatus.Failure)}}addPoint(e,t,i){const r=super.addPoint(e,t,i);return r&&this.recalculateStateByData(),r}endChanging(e,t){const i=super.endChanging(e,t);return this.setStatus(l.AlertStatus.Waiting),this.recalculateStateByData(),i}onData(e){super.onData(e),this.recalculateStateByData()}endMoving(e,t,i){const r=super.endMoving(e,t,i);return this.setStatus(l.AlertStatus.Waiting),this.recalculateStateByData(),r}direction(){if(this._points.length<2)return l.Direction.Up;const e=this._points[0];return this._points[1].price>e.price?l.Direction.Up:l.Direction.Down}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolprediction",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,209795)).then((e=>e.PredictionDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("status")||e.addChild("status",new o.Property(l.AlertStatus.Waiting))}}},275428:(e,t,i)=>{i.d(t,{LineToolPriceLabel:()=>s});var r=i(262624),n=i(929927),o=i(23666);class s extends n.LineDataSource{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,145053)).then((e=>{this._setPaneViews([new e.PriceLabelPaneView(this,this._model)])}))}pointsCount(){return 1}name(){return"Price Label"}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolpricelabel",state:e});return this._configureProperties(t),t}_normalizePoint(e,t){var i;return null!==(i=super._normalizePointWithoutOffset(e))&&void 0!==i?i:super._normalizePoint(e,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,904281))).PriceLabelDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new o.LineToolColorsProperty([e.childs().color]))}}},115489:(e,t,i)=>{i.d(t,{LineToolPriceRange:()=>m});var r=i(929927),n=i(650151),o=i(61499),s=i(262624),l=i(714512),a=i(422997),c=i(436687);const u={
...a.nonThemedFactoryDefaultsBase,extendLeft:!1,extendRight:!1},h=a.themedFactoryDefaultsBase,d=(0,s.extractThemedColors)((0,n.ensureDefined)(h.get(o.StdTheme.Light)),(0,n.ensureDefined)(h.get(o.StdTheme.Dark))),p=(0,s.extractAllPropertiesKeys)((0,n.ensureDefined)(h.get(o.StdTheme.Light))),_=(0,s.extractAllPropertiesKeys)(u),P=[...new Set([...p,..._,...c.commonLineToolPropertiesStateKeys,...a.allPropertiesStateKeysBase])];class v extends a.DateAndPriceBaseProperties{static create(e){return new this({defaultName:"linetoolpricerange",factoryDefaultsSupplier:()=>(0,l.factoryDefaultsForCurrentTheme)(u,h),nonThemedDefaultsKeys:_,themedDefaultsKeys:p,allStateKeys:P,themedColors:d,replaceThemedColorsOnThemeChange:!0,state:e})}}class m extends r.LineDataSource{constructor(e,t,r,n){super(e,t||m.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,408699)).then((e=>{this._setPaneViews([new e.PriceRangePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Price Range"}template(){return this._properties.template()}static createProperties(e){const t=v.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,922040))).GeneralDatePriceRangeDefinitionsViewModel}}},669824:(e,t,i)=>{i.d(t,{LineToolProjection:()=>s});var r=i(624711),n=i(329944),o=i(23666);class s extends r.LineToolFibWedgeBase{constructor(e,t,r,n){super(e,null!=t?t:s.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,560165)).then((e=>{this._setPaneViews([new e.ProjectionLinePaneView(this,this._model)])}))}levelsCount(){return 1}name(){return"Projection"}static createProperties(e){const t=new n.LevelsProperty({defaultName:"linetoolprojection",state:e,map:{range:[1,1]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,582406))).ProjectionDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([e.childs().trendline.childs().color]))}}},337731:(e,t,i)=>{i.d(t,{LineToolRay:()=>n});var r=i(815259);class n extends r.LineToolTrendLine{constructor(e,t,i,r){super(e,null!=t?t:n.createProperties(),i,r)}name(){return"Ray"}static createProperties(e){const t=r.LineToolTrendLine._createPropertiesImpl("linetoolray",e);return n._configureProperties(t),t}}},260720:(e,t,i)=>{i.d(t,{LineToolRectangle:()=>c});var r=i(650151),n=i(86441),o=i(262624),s=i(658843),l=i(89282),a=i(23666);class c extends l.InplaceTextLineDataSource{constructor(e,t,r,n){const o=t||c.createProperties();super(e,o,r,n),
Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,683164)).then((({RectanglePaneView:t})=>{const i=[new t(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this))];this._setPaneViews(i)}))}pointsCount(){return 2}textColorsProperty(){return this.properties().childs().showLabel.value()?super.textColorsProperty():null}name(){return"Rectangle"}setPoint(e,t,i){if(e<2&&super.setPoint(e,t,i),this._snapTo45DegreesApplicable(i)){const i=this._getAnchorPointForIndex(e);if(e>=4)return this._correctMiddlePoints(e,t,i),void this._normalizePoints();this.snapPoint45Degree(t,i)}const r=this._model.mainSeries().interval();switch(e){case 2:this._points[1].price=t.price,this._points[0].index=t.index,this._points[0].interval=r;break;case 3:this._points[0].price=t.price,this._points[1].index=t.index,this._points[1].interval=r;break;case 4:this._points[0].index=t.index,this._points[0].interval=r;break;case 5:this._points[1].index=t.index,this._points[1].interval=r;break;case 6:this._points[0].price=t.price;break;case 7:this._points[1].price=t.price}this._normalizePoints()}getPoint(e){return e<2?super.getPoint(e):this._getAnchorPointForIndex(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}snapTo45DegreesAvailable(){return!0}snapPoint45Degree(e,t,i){const n=this._priceScale,o=this.ownerSource();if(null===n||null===o)return;const s=o.firstValue();if(null===s)return;const l=this._model.timeScale(),a=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),c=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),u=a.x-c.x,h=a.y-c.y,d=u<0?-1:1,p=h<0?-1:1,_=Math.max(Math.abs(u),Math.abs(h)),P=Math.round(l.coordinateToIndex(c.x+_*d)),v=Math.abs(l.indexToCoordinate(P)-c.x),m=n.coordinateToPrice(c.y+v*p,s);e.index=P,e.price=m}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor,textVisible:e.showLabel}}static createProperties(e,t){const i=new o.DefaultProperty({defaultName:"linetoolrectangle",state:e,useUserPreferences:t});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,145448)).then((e=>e.RectangleDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_correctMiddlePoints(e,t,i){e<6?this._correctRightLeftMiddlePoint(e,t,i):this._correctTopBottomMiddlePoint(e,t,i)}_correctRightLeftMiddlePoint(e,t,i){const o=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),s=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let c=o.x-s.x;if(0===c)return;const u=l.x<a.x?1:-1,h=l.y<a.y?1:-1;switch(c*=u,e){case 4:{const e=a.y-h*c/2,t=(0,r.ensureNotNull)(this.screenPointToPoint(new n.Point(a.x,e)));this._points[1].price=t.price;const i=(0,
r.ensureNotNull)(this.screenPointToPoint(new n.Point(l.x+u*c,l.y+h*c/2)));this._points[0].price=i.price,this._points[0].index=i.index;break}case 5:{const e=l.y-h*c/2,t=(0,r.ensureNotNull)(this.screenPointToPoint(new n.Point(l.x,e)));this._points[0].price=t.price;const i=(0,r.ensureNotNull)(this.screenPointToPoint(new n.Point(a.x+u*c,a.y+h*c/2)));this._points[1].price=i.price,this._points[1].index=i.index;break}}}_correctTopBottomMiddlePoint(e,t,i){const o=this._priceScale,s=this.ownerSource();if(null===o||null===s)return;const l=this._model.timeScale(),a=s.firstValue();if(null===a)return;const c=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),u=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),h=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),d=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),p=c.y-u.y,_=p<0?-1:1,P=h.x<d.x?1:-1,v=h.y<d.y?1:-1;switch(e){case 6:{const e=Math.floor(d.x-P*p/2),t=(0,r.ensureNotNull)(this.screenPointToPoint(new n.Point(e,d.y))),i=Math.abs(this._points[1].index-t.index),s=P*v*_*Math.ceil(i/2);if(0===s)return;this._points[1].index=this._points[1].index-s;const c=_*Math.abs(l.indexToCoordinate(this._points[1].index)-d.x);this._points[0].price=o.coordinateToPrice(h.y+c,a),this._points[0].index=this._points[0].index+s;break}case 7:{const e=Math.floor(h.x-P*p/2),t=(0,r.ensureNotNull)(this.screenPointToPoint(new n.Point(e,h.y))),i=Math.abs(this._points[0].index-t.index),s=P*v*_*Math.ceil(i/2);if(0===s)return;this._points[0].index=this._points[0].index-s;const c=_*Math.abs(l.indexToCoordinate(this._points[0].index)-h.x);this._points[1].price=o.coordinateToPrice(d.y+c,a),this._points[1].index=this._points[1].index+s;break}}}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new s.Property("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExcludedKey("text",1),e.addExcludedKey("linesColors",1),e.addExcludedKey("textsColors",1)}_getAnchorPointForIndex(e){const t=this.points(),i=t[0],r=t[1];let n=0,o=0;switch(e){case 0:n=i.price,o=i.index;break;case 1:n=r.price,o=r.index;break;case 2:n=r.price,o=i.index;break;case 3:n=i.price,o=r.index;break;case 4:n=(r.price+i.price)/2,o=i.index;break;case 5:n=(r.price+i.price)/2,o=r.index;break;case 6:n=i.price,o=(r.index+i.index)/2;break;case 7:n=r.price,o=(r.index+i.index)/2}return{index:o,price:n}}}},977979:(e,t,i)=>{var r;i.d(t,{RiskDisplayMode:()=>r}),function(e){e.Percentage="percents",e.Money="money"}(r||(r={}))},966491:(e,t,i)=>{var r;i.d(t,{RiskRewardPointIndex:()=>r}),function(e){e[e.Entry=0]="Entry",e[e.Close=1]="Close",e[e.ActualEntry=2]="ActualEntry",e[e.ActualClose=3]="ActualClose"}(r||(r={}))},676415:(e,t,i)=>{i.d(t,{LineToolRiskRewardLong:()=>b,LineToolRiskRewardShort:()=>w});var r=i(650151),n=i(518439),o=i(704670),s=i(929927),l=i(977979),a=i(966491),c=i(347808),u=i(432059);class h extends c.PriceAxisView{constructor(e,t){super(),this._source=e,
this._data=t}_updateRendererData(e,t,i){if(e.visible=!1,!this._showAxisLabel())return;const r=this._source.priceScale();if(0===this._source.points().length||null===r||r.isEmpty())return;const n=this._source.ownerSource(),o=null!==n?n.firstValue():null;if(null===o)return;const s=this._data.priceProperty.value(),l=(0,u.resetTransparency)(this._data.colorProperty.value());i.background=l,i.textColor=this.generateTextColor(l),i.coordinate=r.priceToCoordinate(s,o),e.text=r.formatPrice(s,o),e.visible=!0}_showAxisLabel(){return this._source.properties().childs().showPriceLabels.value()||this._source.model().selection().isSelected(this._source)}}var d=i(658843);class p extends d.Property{constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){const e=this._lineSource.points(),t=e[this._pointIndex]?e[this._pointIndex].price:this._lineSource.normalizedPoints()[this._pointIndex].price;return this._formatAndParsePrice(t)}state(){return this.value()}merge(e,t){return this.setValue(e),t?[]:null}_formatAndParsePrice(e){var t;const i=(0,r.ensureNotNull)(this._lineSource.ownerSource()),n=(null===(t=i.defaultFormatter)||void 0===t?void 0:t.call(i))||i.formatter();if(n.parse){const t=n.format(e),i=n.parse(t);return i.res?i.value:e}return e}}class _ extends p{constructor(e){super(e,0)}setValue(e){if(this._lineSource.isSourceHidden()){const t=this._lineSource.normalizedPoints();return t[this._pointIndex].price=parseFloat(e.toString()),void this._lineSource.restorePoints(t,[])}const t=this._lineSource.points()[this._pointIndex];this._lineSource.startChanging(this._pointIndex,t),t.price=parseFloat(e.toString()),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.recalculate(),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this,""),this._lineSource.endChanging(!1,!1),this._lineSource.syncPriceLevels()}}class P extends p{constructor(e){super(e,1)}value(){const e=this._lineSource.stopPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.ownerSourceBase());this._lineSource.properties().childs().stopLevel.setValue(t),this._lineSource.syncPriceLevels()}}class v extends p{constructor(e){super(e,2)}value(){const e=this._lineSource.profitPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.ownerSourceBase());this._lineSource.properties().childs().profitLevel.setValue(t),this._lineSource.syncPriceLevels()}}var m=i(124829),g=i(419283),f=i(169532),y=i(758697);function T(e){return parseFloat(e.toFixed(2))}class C extends s.LineDataSource{constructor(e,t,n,s){super(e,t,n,s),this._syncStateExclusions=["points","entryPrice","stopPrice","targetPrice","stopLevel","profitLevel","riskSize","qty","amountTarget","amountStop"],this._riskInChange=!1,this.version=2,t.hasChild("stopLevel")||t.hasChild("profitLevel")||(t.addProperty("stopLevel",0),t.addProperty("profitLevel",0),this.ownerSourceChanged().subscribe(this,(()=>{const i=(0,
r.ensureNotNull)(e.timeScale().visibleBarsStrictRange()),n=i.firstBar(),s=i.lastBar(),l=(0,r.ensureNotNull)(this.ownerSource()),a=l.priceScale();if(a){let e=(0,r.ensureNotNull)(l.priceRange(n,s,{targetPriceScale:a,scaleSeriesOnly:null==a?void 0:a.isScaleSeriesOnly()}));if(a.isLog()){const t=a.logicalToPrice(e.minValue()),i=a.logicalToPrice(e.maxValue());e=new o.PriceRange(t,i)}if(e&&!e.isEmpty()){const i=Math.round(.2*e.length()*this.ownerSourceBase());t.merge({stopLevel:i,profitLevel:i})}}}),!0));const c=t.childs();c.stopLevel.listeners().subscribe(this,this.recalculate),c.stopLevel.listeners().subscribe(null,(()=>{this.properties().childs().stopPrice.childChanged(null,"")})),c.profitLevel.listeners().subscribe(this,this.recalculate),c.profitLevel.listeners().subscribe(null,(()=>{this.properties().childs().targetPrice.childChanged(null,"")})),t.addChild("entryPrice",new _(this)),t.addChild("stopPrice",new P(this)),t.addChild("targetPrice",new v(this)),t.hasChild("riskSize")||t.addProperty("riskSize",0),t.hasChild("qty")||t.addProperty("qty",0),t.hasChild("amountTarget")||t.addProperty("amountTarget",c.accountSize.value()),t.hasChild("amountStop")||t.addProperty("amountStop",c.accountSize.value()),t.addExcludedKey("riskSize",1),t.addExcludedKey("qty",1),t.addExcludedKey("amountTarget",1),t.addExcludedKey("amountStop",1),c.risk.subscribe(this,this._recalculateRiskSize),c.accountSize.subscribe(this,this._recalculateRiskSize),c.riskDisplayMode.subscribe(this,this._recalculateRisk),c.riskDisplayMode.subscribe(this,this._recalculateRiskSize),c.entryPrice.subscribe(this,this._recalculateRiskSize),c.stopPrice.subscribe(this,this._recalculateRiskSize),c.profitLevel.subscribe(this,this._recalculateRiskSize),c.profitLevel.subscribe(this,this.syncPriceLevels.bind(this)),c.stopLevel.subscribe(this,this._recalculateRiskSize),c.stopLevel.subscribe(this,this.syncPriceLevels.bind(this)),c.qty.subscribe(this,this._recalculateRiskSize),this.ownerSourceChanged().subscribe(null,((e,t)=>{e&&e.barsProvider().dataUpdated().unsubscribeAll(this),t&&t.barsProvider().dataUpdated().subscribe(this,this._onSeriesUpdated)})),this.pointAdded().subscribe(this,(e=>{switch(e){case a.RiskRewardPointIndex.Entry:case a.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}})),this.pointChanged().subscribe(this,(e=>{switch(e){case a.RiskRewardPointIndex.Entry:case a.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}})),c.riskDisplayMode.value()===l.RiskDisplayMode.Percentage&&c.risk.value()>100&&c.riskDisplayMode.setValueSilently(l.RiskDisplayMode.Money),c.entryPrice.subscribe(this,this._recalculateQty),c.stopPrice.subscribe(this,this._recalculateQty),c.riskSize.subscribe(this,this._recalculateQty),c.entryPrice.subscribe(this,this._recalculateAmount),c.profitLevel.subscribe(this,this._recalculateAmount),c.stopLevel.subscribe(this,this._recalculateAmount),c.accountSize.subscribe(this,this._recalculateAmount),c.riskSize.subscribe(this,this._recalculateAmount),c.qty.subscribe(this,this._recalculateAmount),
this._entryPriceAxisView=new h(this,{colorProperty:c.linecolor,priceProperty:c.entryPrice}),this._stopPriceAxisView=new h(this,{colorProperty:c.stopBackground,priceProperty:c.stopPrice}),this._profitPriceAxisView=new h(this,{colorProperty:c.profitBackground,priceProperty:c.targetPrice}),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,974363)).then((({RiskRewardPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}destroy(){var e;null===(e=this.ownerSource())||void 0===e||e.barsProvider().dataUpdated().unsubscribeAll(this),this.ownerSourceChanged().unsubscribeAll(this),super.destroy()}hasEditableCoordinates(){return!1}setOwnerSource(e){super.setOwnerSource(e);const t=this.ownerSource();t&&t.symbolSource().symbolInfo()&&(this._recalculateAmount(),this._recalculateRiskSize(),this._recalculateQty())}pointsCount(){return 2}priceAxisPoints(){if(!this._points.length)return[];const e=this._points[0],t=this._properties.childs();return[{...e,price:t.stopPrice.value()},{...e,price:t.entryPrice.value()},{...e,price:t.targetPrice.value()}]}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||this._model.paneForSource(this)!==e?null:[this._entryPriceAxisView,this._stopPriceAxisView,this._profitPriceAxisView]}updateAllViews(e){this.isActualSymbol()&&this.properties().childs().visible.value()&&((0,g.hideAllDrawings)().value()&&this.userEditEnabled()||(super.updateAllViews(e),this._entryPriceAxisView.update(e),this._stopPriceAxisView.update(e),this._profitPriceAxisView.update(e)))}migrateVersion(e,t,i){if(1===e&&this._points.length>=1){const e=[];e.push(this._points[0]);let t=this._points[0];if(t={price:t.price,index:this._getClosePointIndex(t.index),interval:this._properties.childs().interval.value()},e.push(t),this._points[1]&&e.push(this._points[1]),this._points[2]&&e.push(this._points[2]),this._points=e,this._timePoint.length>=1){const t=[],i=this._timePoint[0];t.push(i);const r={price:i.price,time_t:i.time_t,offset:this._getClosePointIndex(i.offset)};t.push(r),this._timePoint[1]&&e.push(this._points[1]),this._timePoint[2]&&e.push(this._points[2]),this._timePoint=t}}}restoreExternalState(e){if((0,m.isNumber)(e.entryPrice)){if(e=Object.assign({},e),!this.isActualSymbol()){this._timePoint[0].price=e.entryPrice,delete e.entryPrice}this.properties().merge(e)}else super.restoreExternalState(e)}addPoint(e,t,i){e.price=this._roundPrice(e.price),super.addPoint(e,void 0,!0);const r={price:e.price,index:this._getClosePointIndex(e.index)};super._addPointIntenal(r,void 0,!0);const n=this._calculateActualEntry(e,r);if(n){super._addPointIntenal(n,void 0,!0);const e=this._findClosePoint(n,r);e&&super._addPointIntenal(e,void 0,!0)}return this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}setPoint(e,t,i,r){if(this.isSourceHidden())return;const n=this.properties().childs();switch(this._muteSyncLineStyle(),e){case 0:this._changeEntryPoint({...t,interval:this._model.mainSeries().interval()});break;case 2:
n.stopPrice.setValue(this.prepareStopPrice(t.price));break;case 3:n.targetPrice.setValue(this.prepareProfitPrice(t.price));break;case 1:t.price=this._points[0].price,super.setPoint(1,t),this.recalculate()}this._unmuteSyncLineStyleWithoutApplyingChanges(),r||this.syncPriceLevels()}getPoint(e){if(this.isSourceHidden())return null;switch(e){case 0:return this._points[0];case 1:return{index:this._points[1].index,price:this._points[0].price};case 2:return{index:this._points[0].index,price:this.stopPrice()};case 3:return{index:this._points[0].index,price:this.profitPrice()}}return null}setPoints(e){this.isSourceHidden()||(this._muteSyncLineStyle(),super.setPoints(e),this.recalculate(),this._unmuteSyncLineStyleWithoutApplyingChanges(),this.syncPriceLevels())}start(){super.start(),this.recalculate()}startMoving(e,t,i,n){const o=(0,r.ensureDefined)(e.logical);o.price=this._roundPrice(o.price),super.startMoving(e,t,i)}move(e,t,i,n){const o=(0,r.ensureDefined)(e.logical);o.price=this._roundPrice(o.price),super.move(e,t,i),this.recalculate(),this._entryPriceAxisView.update((0,f.sourceChangeEvent)(this.id()))}axisPoints(){if(!this._points[a.RiskRewardPointIndex.ActualEntry])return[];const e=this._points[a.RiskRewardPointIndex.ActualEntry];let t=null;if(4===this._points.length)t=this._points[a.RiskRewardPointIndex.ActualClose];else{const e=this.lastBarData();if(!e)return[];t={index:e.index,price:e.closePrice}}return[e,t]}recalculateStateByData(){this.recalculate()}recalculate(){if(0===this.points().length)return;const e=this.properties().childs(),t=e.targetPrice.value(),i=e.stopPrice.value(),r=[this._points[0],this._points[1]],n=this._calculateActualEntry(this.points()[0],this.points()[1]),o=this._model.mainSeries().interval();if(n){r.push({...n,interval:o});const e=this._findClosePoint(n,this.points()[1]);e&&r.push({...e,interval:o})}this._points=r,t!==e.targetPrice.value()&&e.targetPrice.listeners().fire(e.targetPrice,""),i!==e.stopPrice.value()&&e.stopPrice.listeners().fire(e.stopPrice,"")}syncPriceLevels(){const e=this.linkKey().value();if(e){const t=this.properties().childs(),i={entryPrice:t.entryPrice.value(),stopLevel:t.stopLevel.value(),profitLevel:t.profitLevel.value()};(0,g.changeLineStyle)({linkKey:e,state:i,model:this._model})}}entryPrice(){const e=this.points();return 0===e.length?this._timePoint[0].price:e[0].price}lastBarData(){var e;const t=null===(e=this.ownerSource())||void 0===e?void 0:e.barsProvider();if(!t)return null;const i=t.bars().firstIndex(),o=t.bars().lastIndex();if(null===i||null===o||isNaN(i)||isNaN(o))return null;const s=this.points();if(4===s.length){const e=s[a.RiskRewardPointIndex.ActualClose];return e.index<i?null:{closePrice:e.price,index:Math.min(o,e.index)}}const l=s[a.RiskRewardPointIndex.Close];if(l.index<i)return null;const c=Math.min(o,l.index),u=t.bars().search(c,n.PlotRowSearchMode.NearestLeft);return null===u?null:{closePrice:(0,r.ensure)(u.value[4]),index:u.index}}ownerSourceBase(){var e;const t=null===(e=this.ownerSource())||void 0===e?void 0:e.symbolSource().symbolInfo()
;return t?t.pricescale/t.minmov:100}getOrderTemplate(){const e=this.ownerSource();if(null===e)return null;const t=this.properties().childs();return{symbol:e.symbolSource().symbol(),qty:t.qty.value()/t.lotSize.value(),limitPrice:t.entryPrice.value(),stopLoss:t.stopPrice.value(),takeProfit:t.targetPrice.value(),side:this._orderSide(),type:1,seenPrice:null}}template(){const e=this.properties().childs(),t=super.template();return t.stopLevel=e.stopLevel.value(),t.profitLevel=e.profitLevel.value(),t}_applyTemplateImpl(e){const{targetPrice:t,stopPrice:i,entryPrice:r,...n}=e;super._applyTemplateImpl(n);const o=this.properties().childs();void 0!==e.stopLevel&&o.stopLevel.setValue(e.stopLevel),void 0!==e.profitLevel&&o.profitLevel.setValue(e.profitLevel)}_propertiesStateExclusions(){return[...super._propertiesStateExclusions(),"entryPrice","stopPrice","targetPrice"]}_correctPoints(e,t){if(!this.isActualSymbol())return!1;const i=super._correctPoints(e.slice(0,this.pointsCount()),t);for(let t=0;t<e.length;t++){const i=e[t];i.price=this._roundPrice(i.price)}return i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,977503))).RiskRewardDefinitionsViewModel}_recalculateRiskSize(){if(this._riskInChange)return;const e=this.properties().childs(),t=e.risk.value(),i=e.riskDisplayMode.value(),r=e.accountSize.value();i===l.RiskDisplayMode.Percentage?e.riskSize.setValue(t/100*r):t>r?(e.risk.setValue(r),e.riskSize.setValue(r)):e.riskSize.setValue(t)}_roundPrice(e){const t=this.ownerSourceBase();return Math.round(e*t)/t}_ownerSourcePointValue(){var e,t,i;return null!==(i=null===(t=null===(e=this.ownerSource())||void 0===e?void 0:e.symbolSource().symbolInfo())||void 0===t?void 0:t.pointvalue)&&void 0!==i?i:1}static _configureProperties(e){s.LineDataSource._configureProperties(e),e.addExcludedKey("stopLevel",1),e.addExcludedKey("profitLevel",1),e.addExcludedKey("stopPrice",1),e.addExcludedKey("targetPrice",1),e.addExcludedKey("entryPrice",1)}_onSeriesUpdated(e,t,i){this.isSourceHidden()||this._points.length<2||null!==i&&i.index>Math.max(this._points[0].index,this._points[1].index)||this.recalculateStateByData()}_recalculateRisk(){const e=this.properties().childs(),t=e.riskDisplayMode.value(),i=e.riskSize.value(),r=e.accountSize.value();let n=e.risk.value();n=t===l.RiskDisplayMode.Percentage?T(i/r*100):T(r/100*n),this._riskInChange=!0,e.risk.setValue(parseFloat(this._riskFormatter(t).format(n,{ignoreLocaleNumberFormat:!0}))),this._riskInChange=!1}_recalculateAmount(){if(0===this.points().length)return;const e=this.properties().childs(),t=e.accountSize.value(),i=e.entryPrice.value(),r=e.qty.value(),n=e.stopPrice.value(),o=e.targetPrice.value(),s=this._ownerSourcePointValue();e.amountTarget.setValue(this._amountTarget(t,o,i,r,s)),e.amountStop.setValue(this._amountStop(t,n,i,r,s))}_recalculateQty(){if(0===this.points().length)return
;const e=this.properties().childs(),t=e.entryPrice.value(),i=e.stopPrice.value(),r=e.riskSize.value()/(Math.abs(t-i)*this._ownerSourcePointValue());e.qty.setValue(r)}_calculateActualEntry(e,t){const i=this.ownerSource();if(!i)return null;const n=i.barsProvider().bars();if(n.isEmpty())return null;const o=(0,r.ensureNotNull)(n.firstIndex()),s=Math.max(e.index,o),l=e.price,a=(0,r.ensureNotNull)(n.lastIndex()),c=Math.min(a,t.index-1);for(const e of n.rangeIterator(s,c+1)){const t=e.value;if(null!==t&&(0,r.ensure)(t[2])>=l&&(0,r.ensure)(t[3])<=l)return{index:e.index,price:l}}return null}_riskFormatter(e){return e===l.RiskDisplayMode.Percentage?(0,y.getNumericFormatter)(2):(0,y.getNumericFormatter)()}_getClosePointIndex(e){const t=this._model.timeScale(),i=Math.round(t.width()/t.barSpacing());return e+Math.max(3,Math.round(.15*i))}_findClosePoint(e,t){const i=this.ownerSource();if(!i)return null;const n=i.barsProvider().bars(),o=(0,r.ensureNotNull)(n.firstIndex()),s=Math.max(e.index,o),l=(0,r.ensureNotNull)(n.lastIndex()),a=Math.min(l,t.index-1);for(const e of n.rangeIterator(s,a+1)){const t=e.value;if(null===t)continue;const i=this._checkStopPrice(t);if(null!=i)return{index:e.index,price:i}}return null}_changeEntryPoint(e){const t=this.properties().childs(),i=t.stopPrice.value(),r=t.targetPrice.value(),n=1/this.ownerSourceBase(),o=Math.min(i,r)+n,s=Math.max(i,r)-n;e.price=Math.max(o,Math.min(s,this._roundPrice(e.price))),this.setPoints([e,{...this._points[1],price:e.price}]),t.stopPrice.setValue(i),t.targetPrice.setValue(r)}}var x=i(262624);class w extends C{constructor(e,t,i,r){super(e,null!=t?t:w.createProperties(),i,r)}name(){return"Risk/Reward short"}stopPrice(){return this.entryPrice()+this.properties().childs().stopLevel.value()/this.ownerSourceBase()}calculatePL(e){return this.entryPrice()-e}profitPrice(){return this.entryPrice()-this.properties().childs().profitLevel.value()/this.ownerSourceBase()}prepareStopPrice(e){e=this._roundPrice(e);const t=this.entryPrice()+1/this.ownerSourceBase();return Math.max(e,t)}prepareProfitPrice(e){e=this._roundPrice(e);const t=this.entryPrice()-1/this.ownerSourceBase();return Math.min(e,t)}static createProperties(e){const t=new x.DefaultProperty({defaultName:"linetoolriskrewardshort",state:e});return this._configureProperties(t),t}_amountTarget(e,t,i,r,n){return T(e+(i-t)*r*n)}_amountStop(e,t,i,r,n){return T(e-(t-i)*r*n)}_checkStopPrice(e){const t=this.stopPrice(),i=this.profitPrice();return(0,r.ensure)(e[2])>=t?this.stopPrice():(0,r.ensure)(e[3])<=i?this.profitPrice():null}_orderSide(){return-1}}class b extends C{constructor(e,t,i,r){super(e,null!=t?t:b.createProperties(),i,r)}name(){return"Risk/Reward long"}stopPrice(){return this.entryPrice()-this.properties().childs().stopLevel.value()/this.ownerSourceBase()}profitPrice(){return this.entryPrice()+this.properties().childs().profitLevel.value()/this.ownerSourceBase()}calculatePL(e){return e-this.entryPrice()}prepareStopPrice(e){e=this._roundPrice(e);const t=this.entryPrice()-1/this.ownerSourceBase();return Math.min(e,t)}
prepareProfitPrice(e){e=this._roundPrice(e);const t=this.entryPrice()+1/this.ownerSourceBase();return Math.max(e,t)}static createProperties(e){const t=new x.DefaultProperty({defaultName:"linetoolriskrewardlong",state:e});return this._configureProperties(t),t}_amountTarget(e,t,i,r,n){return T(e+(t-i)*r*n)}_amountStop(e,t,i,r,n){return T(e-(i-t)*r*n)}_checkStopPrice(e){const t=this.stopPrice(),i=this.profitPrice();return(0,r.ensure)(e[3])<=t?this.stopPrice():(0,r.ensure)(e[2])>=i?this.profitPrice():null}_orderSide(){return 1}}},723187:(e,t,i)=>{i.d(t,{LineToolRotatedRectangle:()=>c});var r=i(86441),n=i(204652),o=i(650151),s=i(929927),l=i(262624),a=i(23666);class c extends s.LineDataSource{constructor(e,t,r,n){super(e,t||c.createProperties(),r,n),this._distance=null,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,920140)).then((({RotatedRectanglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=this._points,t=(0,o.ensureNotNull)(this.pointToScreenPoint(e[0])),i=(0,o.ensureNotNull)(this.pointToScreenPoint(e[1])),r=(0,o.ensureNotNull)(this.pointToScreenPoint(e[2]));this._distance=(0,n.distanceToLine)(t,i,r).distance}}setPoint(e,t,i,n){if(super.setPoint(e,t,i),0===e||1===e){const e=this._points,t=(0,o.ensureNotNull)(this.pointToScreenPoint(e[0])),i=(0,o.ensureNotNull)(this.pointToScreenPoint(e[1])).subtract(t),n=new r.Point(i.y,-i.x).normalized().scaled((0,o.ensureNotNull)(this._distance)),s=t.add(n),l=(0,o.ensureNotNull)(this.screenPointToPoint(s)),a=this._model.mainSeries().interval();this._points[2]={...l,interval:a}}}endChanging(e,t,i){return this._distance=null,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Rotated Rectangle"}hasEditableCoordinates(){return!1}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,616816))).GeneralFiguresDefinitionsViewModelBase}snapTo45DegreesAvailable(){return!0}static createProperties(e){const t=new l.DefaultProperty({defaultName:"linetoolrotatedrectangle",state:e});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color]))}}},885247:(e,t,i)=>{i.d(t,{LineToolSchiffPitchfork:()=>o});var r=i(329944),n=i(99269);class o extends n.LineToolPitchfork{constructor(e,t,i,r){super(e,t||o.createProperties(),i,r)}name(){return"Modified Schiff Pitchfork"}static createProperties(e){const t=new r.LevelsProperty({defaultName:"linetoolschiffpitchfork",state:e,map:{range:[0,8]}});return this._configureProperties(t),t}}},250330:(e,t,i)=>{i.d(t,{LineToolSchiffPitchfork2:()=>o});var r=i(329944),n=i(99269);class o extends n.LineToolPitchfork{constructor(e,t,i,r){super(e,t||o.createProperties(),i,r)}name(){return"Schiff Pitchfork"}static createProperties(e){const t=new r.LevelsProperty({defaultName:"linetoolschiffpitchfork2",state:e,
map:{range:[0,8]}});return this._configureProperties(t),t}}},172666:(e,t,i)=>{i.d(t,{LineToolSignpost:()=>d});var r=i(960095),n=i(262624),o=i(658843),s=i(929927),l=i(23666),a=i(494927);class c extends o.Property{constructor(e){super(),this._source=e,e.pointAdded().subscribe(this,(()=>this.listeners().fire(this,""))),e.pointChanged().subscribe(this,(()=>this.listeners().fire(this,"")))}value(){const e=this._source.properties().childs().position.value();return parseFloat(e.toFixed(2))}setValue(e){this._source.properties().childs().position.setValue(e),this._source.model().updateSource(this._source),this.listeners().fire(this,""),this._source.syncMultichartState({pricesChanged:!1,indexesChanged:!1})}}var u=i(896123);class h extends u.LineDataSourcePointIndexProperty{constructor(e,t){super(e,t),this._source=e}_setPointImpl(e){this._source.setPointAndChangeIndex(this._pointIndex,e)}}class d extends a.LineToolWithRelativePriceCoordinate{constructor(e,t,n,s){super(e,null!=t?t:d.createProperties(),n,s),this._textColorProperty=new o.Property("transparent"),this._setTextColorByTheme=e=>{this._textColorProperty.setValue(e?(0,r.getHexColorByName)("color-cold-gray-200"):(0,r.getHexColorByName)("color-cold-gray-900"))},e.dark().subscribe(this._setTextColorByTheme,{callWithLast:!0}),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,702742)).then((t=>{this._setPaneViews([new t.SignpostPaneView(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this))])}))}destroy(){this._model.dark().unsubscribe(this._setTextColorByTheme),super.destroy()}pointsCount(){return 1}name(){return"Signpost"}customEvent(){return{index:()=>{var e,t;return null!==(t=null===(e=this.points()[0])||void 0===e?void 0:e.index)&&void 0!==t?t:null},position:()=>this.properties().childs().position.value()}}showInObjectTree(){return!this.isPhantom()&&super.showInObjectTree()}isPhantom(){return this._model.isPhantomLine(this)}clonePositionOffset(){return{barOffset:1,xCoordOffset:0,yCoordOffset:0}}template(){const e=super.template(),t=this.properties().childs();return e.text=t.text.value(),e.position=t.position.value(),e}shouldBeRemovedOnDeselect(){const e=this._properties.childs();if(e.showImage.value())return!1;return""===e.text.value().trim()}editableTextProperties(){return{text:this.properties().childs().text,textColor:this._textColorProperty}}activateEditingOnCreation(){return!0}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetoolsignpost",state:e});return this._configureProperties(t),t}_createPointProperty(e){super._createPointProperty(e);const t=this._pointsProperty.childs().points[e];t.removeProperty("price"),t.removeProperty("bar"),t.addChild("price",new c(this)),t.addChild("bar",new h(this,0))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text),this.properties().childs().position.setValue(e.position)}_normalizePoint(e,t){var i
;return null!==(i=super._normalizePointWithoutOffset(e))&&void 0!==i?i:super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,788937)).then((e=>e.SignpostDefinitionsViewModel))}static _configureProperties(e){s.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new o.Property("")),e.hasChild("position")||e.addChild("position",new o.Property(50)),e.addExcludedKey("text",1),e.addExcludedKey("position",1),e.addChild("backgroundsColors",new l.LineToolColorsProperty([e.childs().plateColor]))}}d.supportPhantomMode=!0},519659:(e,t,i)=>{i.d(t,{LineToolSineLine:()=>o});var r=i(262624),n=i(929927);class o extends n.LineDataSource{constructor(e,t,r,n){super(e,t||o.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,800504)).then((e=>{this._setPaneViews([new e.SineLinePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Sine Line"}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolsineline",state:e});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,305096))).CyclicAndSineLinesPatternDefinitionsViewModel}}},831745:(e,t,i)=>{i.d(t,{LineToolSticker:()=>y});var r=i(419283),n=i(965251),o=i(18686),s=i(338619),l=i(154834),a=i(998034),c=i(825446),u=i(985429),h=i(262624),d=i(436687);const p={intervalsVisibilities:{...u.intervalsVisibilitiesDefaults},size:110},_={sticker:"bitcoin",angle:.5*Math.PI},P=(0,h.extractAllPropertiesKeys)(p),v=(0,h.extractAllPropertiesKeys)(_),m=[...new Set([...v,...P,...d.commonLineToolPropertiesStateKeys])];class g extends c.LineDataSourceProperty{constructor(e){super(e)}static create(e,t){return new this({defaultName:"linetoolsticker",factoryDefaultsSupplier:()=>(0,l.default)(p),nonThemedDefaultsKeys:P,themedDefaultsKeys:[],allStateKeys:m,state:(0,a.default)({},_,{sticker:t},null!=e?e:{})})}}const f=(0,s.getLogger)("Chart.LineToolSticker");class y extends o.LineToolSvgIconBase{constructor(e,t,i,r){super(e,t||y.createProperties(),i,r),this.version=1,this._loadViews()}name(){return"Sticker"}static createProperties(e){const t=g.create(e,r.stickerTool.value());return y._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,296501))).LineDataSourceDefinitionsViewModel}async _loadViews(){const[{getSvgContentForSticker:e,getSvgRenderer:t},{StickerPaneView:r}]=await Promise.all([i.e(25598).then(i.bind(i,461186)),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,290894))]);if(!this._isDestroyed){const i=this._properties.childs().sticker.value();this._svgContent=e(i),this._onIconChanged.fire();const o=t(n.svgRenderer,i)
;null===o&&f.logWarn(`Couldn't create svg renderer for sticker ${i}`),this._setPaneViews([new r(this,this._model,o)])}}}},18686:(e,t,i)=>{i.d(t,{LineToolSvgIconBase:()=>a});var r=i(650151),n=i(86441),o=i(625422),s=i(942634),l=i(929927);class a extends l.LineDataSource{constructor(e,t,i,r){super(e,t,i,r),this._onIconChanged=new s.Delegate,this._svgContent=null,this._changePointData=null,this._loadViews()}pointsCount(){return 1}hasEditableCoordinates(){return!1}getAnchorLimit(){return 80}getChangePointForSync(e){return null}startChanging(e,t){const i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),s=this.properties().childs(),l=s.size.value();let a;if(t)a=(0,r.ensureNotNull)(this.pointToScreenPoint(t));else{let e=new n.Point(0,Math.max(80,l)/2);const t=(0,o.rotationMatrix)(s.angle.value());e=(0,o.transformPoint)(t,e),a=i.add(e)}const c=i.subtract(a).length();this._changePointData={centerPoint:i,initialLength:c,initialSize:l},super.startChanging(e,t)}setPoint(e,t,i){const{centerPoint:n,initialLength:o,initialSize:s}=(0,r.ensureNotNull)(this._changePointData),l=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),a=this.properties().childs();if(0===e||1===e){const t=l.subtract(n).normalized();let i=Math.acos(-t.x);Math.asin(t.y)>0&&(i=2*Math.PI-i),0===e&&(i+=Math.PI),a.angle.setValue(i)}else{const e=s*(n.subtract(l).length()/o);a.size.setValue(e)}}getSourceIcon(){const e=this.svgContent();return null===e?null:{type:"svgContent",content:e}}onSourceIconChanged(){return this._onIconChanged}svgContent(){return this._svgContent}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("angle",1)}}},63171:(e,t,i)=>{i.d(t,{LineToolText:()=>u,LineToolTextAbsolute:()=>h});var r=i(650151),n=i(86441),o=i(658843),s=i(262624),l=i(23666),a=i(169532),c=i(89282);class u extends c.InplaceTextLineDataSource{constructor(e,t,r,n){const o=t||u.createProperties();super(e,o,r,n),this._recalculatePointsOnCenter=!1,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,326317)).then((({TextPaneView:t})=>{const i=this._recalculatePointsOnCenter?(e,t)=>{this._recalculatePointsOnCenter&&this._recalculateCenterPosition(e,t)}:void 0;this._paneView=new t(this,e,void 0,void 0,void 0,void 0,void 0,i,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this)),this._setPaneViews([this._paneView])}))}centerPosition(){this._recalculatePointsOnCenter=!0}setPoint(e,t,i){const n=this.properties().childs();let o;if(1===e&&n.wordWrapWidth.value()){const e=this.model().timeScale();o=this.isFixed()?(0,r.ensureDefined)(this.fixedPoint()).x:e.indexToCoordinate(this.points()[0].index);const i=e.indexToCoordinate(t.index)-o-~~(n.fontsize.value()/6);if(!isFinite(i))return;n.wordWrapWidth.setValue(Math.max(100,i))}}pointsCount(){return 1}name(){return"Text"}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.color,wordWrap:e.wordWrap}}removeIfEditableTextIsEmpty(){return!0}
activateEditingOnCreation(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}state(e){const t=super.state(e);return e&&(t.state.barSpacing=this._model.timeScale().barSpacing()),t}hasEditableCoordinates(){return!1}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}static createProperties(e){const t=new s.DefaultProperty({defaultName:"linetooltext",state:e});return this._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,895601)).then((e=>e.TextDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new o.Property("")),e.addChild("linesColors",new l.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new l.LineToolColorsProperty([e.childs().color])),e.addExcludedKey("text",1),e.addExcludedKey("linesColors",3),e.addExcludedKey("textsColors",3)}_recalculateCenterPosition(e,t){const i=this.isFixed()?(0,r.ensureDefined)(this.fixedPoint()):(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=new n.Point(i.x-e/2,i.y-t/2),s=(0,r.ensureNotNull)(this.screenPointToPoint(o));this.setPoints([{...s,interval:this._model.mainSeries().interval()}]),this._normalizePoints(),this.createServerPoints(),this.updateAllViewsAndRedraw((0,a.sourceChangeEvent)(this.id()))}}class h extends u{constructor(e,t){super(e,t||h.createProperties())}name(){return"Anchored Text"}hasEditableCoordinates(){return!1}isFixed(){return!0}static createProperties(e){const t=new s.DefaultProperty({defaultName:"linetooltextabsolute",state:e});return this._configureProperties(t),t}}},196019:(e,t,i)=>{i.d(t,{LineToolThreeDrivers:()=>s});var r=i(262624),n=i(929927),o=i(23666);class s extends n.LineDataSource{constructor(e,t,r,n){const o=t||s.createProperties();super(e,o,r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,516708)).then((t=>{this._setPaneViews([new t.LineToolThreeDrivesPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Three Drives Pattern"}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolthreedrivers",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,508171)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new o.LineToolColorsProperty([e.childs().textcolor])),e.addChild("linesWidths",new o.LineToolWidthsProperty([e.childs().linewidth])),e.hasChild("backgroundsColors")&&e.removeProperty("backgroundsColors")}}},42978:(e,t,i)=>{i.d(t,{LineToolTimeCycles:()=>s})
;var r=i(154834),n=i(262624),o=i(929927);class s extends o.LineDataSource{constructor(e,t,r,n){super(e,null!=t?t:s.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,621449)).then((e=>{this._setPaneViews([new e.TimeCyclesPaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Time Cycles"}setPoint(e,t){const i=(0,r.default)(t),n=this._points[0],o=this._points[1];n.price=i.price,o.price=i.price,this._points[e]={...i,interval:this._model.mainSeries().interval()},this._normalizePoints()}addPoint(e,t,i){const r=super.addPoint(e,t,!0);if(r){const e=this._points[0];this._points[1].price=e.price,i||(this._normalizePoints(),this.createServerPoints())}return r}static createProperties(e){const t=new n.DefaultProperty({defaultName:"linetooltimecycles",state:e});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,740870))).TimeCyclesPatternDefinitionsViewModel}}},221542:(e,t,i)=>{i.d(t,{LineToolTrendAngle:()=>u});var r=i(86441),n=i(650151),o=i(262624),s=i(89282),l=i(658843),a=i(169532);class c extends l.Property{constructor(e){super(),this._lineSource=e}value(){return Math.round(180*this._lineSource.angle()/Math.PI)}setValue(e){const t=e*Math.PI/180,i=(0,n.ensureNotNull)(this._lineSource.pointToScreenPoint(this._lineSource.points()[0])),o=Math.cos(t),s=-Math.sin(t),l=new r.Point(o,s),c=i.addScaled(l,this._lineSource.distance()),u=(0,n.ensureNotNull)(this._lineSource.screenPointToPoint(c));this._lineSource.setPoint(1,u);const h=this._lineSource.model();h.updateSource(this._lineSource),this._lineSource.updateAllViews((0,a.sourceChangeEvent)(this._lineSource.id())),h.updateSource(this._lineSource)}notifyChanged(){this._listeners.fire(this,"")}}class u extends s.InplaceTextLineDataSource{constructor(e,t,r,n){const o=t||u.createProperties();super(e,o,r,n),this._angle=0,this._distance=0,o.addChild("angle",new c(this)),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,404969)).then((({TrendAnglePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}isSynchronizable(){return!1}pointsCount(){return 2}name(){return"Trend Angle"}angle(){return this._angle}distance(){return this._distance}addPoint(e,t){const i=super.addPoint(e,t);return i&&this._calculateAngle(),i}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this.points().length>1&&this._calculateAngle(),i}axisPoints(){if(this.points().length<2)return[];const e=[this.points()[0]],t=(0,n.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),i=Math.cos(this._angle)*this._distance,o=-Math.sin(this._angle)*this._distance,s=t.add(new r.Point(i,o)),l=(0,n.ensureNotNull)(this.screenPointToPoint(s));return e.push(l),e}timeAxisPoints(){return this.axisPoints()}priceAxisPoints(){return this.axisPoints()}setPoint(e,t,i){super.setPoint(e,t,i),
this.points().length>1&&1===e&&this._calculateAngle()}restoreData(e){var t,i;this._angle=null!==(t=e.angle)&&void 0!==t?t:0,this._distance=null!==(i=e.distance)&&void 0!==i?i:0}state(e){const t=super.state(e);return t.angle=this._angle,t.distance=this._distance,t}cloneData(e){this._angle=e.angle(),this._distance=e.distance()}canHasAlert(){return!0}editableTextProperties(){(0,n.assert)(!1,"unexpected method call")}snapTo45DegreesAvailable(){return!0}static createProperties(e){e&&void 0===e.showPercentPriceRange&&(e.showPercentPriceRange=e.showPriceRange,e.showPipsPriceRange=e.showPriceRange);const t=new o.DefaultProperty({defaultName:"linetooltrendangle",state:e});return this._configureProperties(t),t}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}_calculateAngle(){const e=(0,n.ensureNotNull)(this.pointToScreenPoint(this.points()[0]));let t=(0,n.ensureNotNull)(this.pointToScreenPoint(this.points()[1])).subtract(e);const i=t.length();i>0?(t=t.normalized(),this._angle=Math.acos(t.x),t.y>0&&(this._angle=-this._angle),this._distance=i):this._angle=0;this.properties().childs().angle.notifyChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,183326)).then((e=>e.TrendAngleDefinitionsViewModel))}}},733176:(e,t,i)=>{i.d(t,{LineToolTrendBasedFibExtension:()=>u});var r=i(444372),n=i(370407),o=i(329944),s=i(23666),l=i(469805),a=i(954578);const c=new n.TranslatedString("erase level line",r.t(null,void 0,i(735111)));class u extends a.LineToolFibWithInplaceTextBase{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=2,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,385750)).then((({TrendBasedFibExtensionPaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this))])}))}levelsCount(){return 24}pointsCount(){return 3}name(){return"Trend-Based Fib Extension"}migrateVersion(e,t){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,c,l.lineToolsDoNotAffectChartInvalidation)}fibLevelsBasedOnLogScale(){var e;return this.properties().childs().fibLevelsBasedOnLogScale.value()&&Boolean(null===(e=this.priceScale())||void 0===e?void 0:e.isLog())}template(){const e=super.template();for(let t=1;t<=24;t++){const i=(0,a.getLevelProps)(this._properties,t);e[`level${t}`].text=i.childs().text.value()}return e}static createProperties(e){const t=new o.LevelsProperty({defaultName:"linetooltrendbasedfibextension",state:e,map:{names:["coeff","color","visible","linestyle","linewidth","text"],range:[0,24]}});return this._configureProperties(t),t}_applyTemplateImpl(e){var t,i;for(let r=1;r<=24;r++){const n=(0,
a.getLevelProps)(this._properties,r),o=e[`level${r}`];n.childs().text.setValue(null!==(i=null!==(t=o.text)&&void 0!==t?t:o[3])&&void 0!==i?i:"")}super._applyTemplateImpl(e)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,763420))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){const t=e.childs();super._configureProperties(e);const i=[t.trendline.childs().color];for(let t=1;t<=24;t++){const r=(0,a.getLevelProps)(e,t);i.push(r.childs().color),e.addExcludedKey(`level${t}.text`,1)}e.addChild("linesColors",new s.LineToolColorsProperty(i));const r=[t.trendline.childs().linewidth,t.levelsStyle.childs().linewidth];e.addChild("linesWidths",new s.LineToolWidthsProperty(r))}}},337861:(e,t,i)=>{i.d(t,{LineToolTrendBasedFibTime:()=>u});var r=i(444372),n=i(370407),o=i(929927),s=i(329944),l=i(23666),a=i(469805);const c=new n.TranslatedString("erase level line",r.t(null,void 0,i(735111)));class u extends o.LineDataSource{constructor(e,t,r,n){super(e,t||u.createProperties(),r,n),this.version=1,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,557949)).then((({TrendBasedFibTimePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 3}name(){return"Trend-Based Fib Time"}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,c,a.lineToolsDoNotAffectChartInvalidation)}static createProperties(e){const t=new s.LevelsProperty({defaultName:"linetooltrendbasedfibtime",state:e,map:{range:[1,11]}});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,37209))).TrendBasedFibTimeDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs(),i=[t.trendline.childs().linewidth],r=[t.trendline.childs().color];for(let e=1;e<=11;e++)i.push(t["level"+e].childs().linewidth),r.push(t["level"+e].childs().color);e.addChild("linesColors",new l.LineToolColorsProperty(r)),e.addChild("linesWidths",new l.LineToolWidthsProperty(i))}}},815259:(e,t,i)=>{i.d(t,{LineToolTrendLine:()=>l});var r=i(262624),n=i(658843),o=i(89282),s=i(129824);class l extends o.InplaceTextLineDataSource{constructor(e,t,r,n){super(e,t||l.createProperties(),r,n),this._trendLinePaneView=null,Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,971158)).then((({TrendLinePaneView:e})=>{this._trendLinePaneView=new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this)),this._setPaneViews([this._trendLinePaneView])}))}dataAndViewsReady(){return super.dataAndViewsReady()&&null!==this._trendLinePaneView&&this._trendLinePaneView.iconsReady()}pointsCount(){return 2}name(){return"Trend Line"}canHasAlert(){
return!0}showPriceLabels(){return this._properties.childs().showPriceLabels.value()}createPriceAxisView(e){return new s.LineToolPriceAxisView(this,{pointIndex:e,backgroundPropertyGetter:()=>this.showPriceLabels()?this._properties.childs().linecolor.value():null})}isForcedDrawPriceAxisLabel(){return this.showPriceLabels()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textcolor,textVisible:e.showLabel}}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){return l._createPropertiesImpl("linetooltrendline",e,t)}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,120755))).TrendLineDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _createPropertiesImpl(e,t,i){t&&void 0===t.showPercentPriceRange&&(t.showPercentPriceRange=t.showPriceRange,t.showPipsPriceRange=t.showPriceRange);const n=new r.DefaultProperty({defaultName:e,state:t,useUserPreferences:i});return this._configureProperties(n),n}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new n.Property("")),e.addExcludedKey("text",1)}}},763337:(e,t,i)=>{i.d(t,{LineToolTrianglePattern:()=>s});var r=i(262624),n=i(929927),o=i(23666);class s extends n.LineDataSource{constructor(e,t,r,n){const o=t||s.createProperties();super(e,o,r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,245571)).then((t=>{this._setPaneViews([new t.LineToolTrianglePatternPaneView(this,e)])}))}pointsCount(){return 4}name(){return"Triangle Pattern"}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetooltrianglepattern",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,503929)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new o.LineToolColorsProperty([e.childs().textcolor])),e.addChild("backgroundsColors",new o.LineToolColorsProperty([e.childs().backgroundColor]))}}},466376:(e,t,i)=>{i.d(t,{LineToolTriangle:()=>s});var r=i(262624),n=i(929927),o=i(23666);class s extends n.LineDataSource{constructor(e,t,r,n){super(e,t||s.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,218074)).then((({TrianglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}
pointsCount(){return 3}name(){return"Triangle"}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetooltriangle",state:e});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,616816))).GeneralFiguresDefinitionsViewModelBase}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([e.childs().color]))}}},393747:(e,t,i)=>{i.d(t,{createTweetLineToolByUrl:()=>h,isTwitterProfileImageUrl:()=>u,isTwitterUrl:()=>c});var r=i(650151),n=i(62802),o=i(79342),s=i(716004),l=i(40495);const a=(0,i(125226).isFeatureEnabled)("mock_tweet_data_for_tests");function c(e){try{const t=new URL(e);return("twitter.com"===t.hostname||t.hostname.endsWith(".twitter.com")||"x.com"===t.hostname||t.hostname.endsWith(".x.com"))&&"https:"===t.protocol}catch(e){return!1}}function u(e){try{const t=new URL(e);return"pbs.twimg.com"===t.hostname&&"https:"===t.protocol&&t.pathname.startsWith("/profile_images/")}catch(e){return!1}}function h(e,t,i=!1){return async function(e){if(a)return{id:0x853cb08cfe8b,created_at:1638107940,text:"𝓭𝓪𝓲𝓵𝔂 𝓻𝓮𝓶𝓲𝓷𝓭𝓮𝓻\r\rAlways do your own research.",username:"tradingview",user:"TradingView",profile_image_url:"https://pbs.twimg.com/profile_images/1598328471729704963/D7slFVZN_400x400.jpg",tweet_url:"https://twitter.com/tradingview/status/1464957065621872641?s=20"};const t=new URL("/api/v1/get-tweet-data/",location.href);return t.searchParams.append("tweet_url",e),fetch(t.toString()).then((e=>{if(!e.ok)throw new Error(`Error processing tweet: ${e.statusText}`);return e.json()}))}(e).then((a=>{const c=function(e,t){var i;return{id:e.id,createdAt:e.created_at,text:(0,s.clean)(e.text,!0),username:`@${e.username}`,user:e.user,profileImageUrl:e.profile_image_url,tweetUrl:null!==(i=e.tweet_url)&&void 0!==i?i:t}}(a,e),u={price:0,time_t:c.createdAt,offset:0},h=t.mainSeries(),d=(0,r.ensureNotNull)(t.model().paneForSource(h)),p=d.newLineToolZOrder(!0),_={type:"drawing",source:{id:(0,o.randomHashN)(6),zorder:p,type:"LineToolTweet",position:50,state:{interval:"1",...l.LineToolTweet.createProperties().state()},tweetData:c,symbol:h.symbol(),ownerSource:h.id(),points:[u]},geometry:[],modelId:t.model().id()},P=t.pasteLineTool(d,_,!0,!0);return i&&n.setValue("hint.pasteTweet",!0,{forceFlush:!0}),P.pointAdded().subscribe(null,(()=>t.scrollToLineTool(P)),!0),P}))}},40495:(e,t,i)=>{i.d(t,{LineToolTweet:()=>x});var r=i(262624),n=i(444372),o=i(62802),s=i(345848),l=i(338619),a=i(457965),c=i(846778),u=i(26829),h=i(419283),d=i(994157),p=i(393747);const _=(0,l.getLogger)("Chart.TweetDialog"),P=n.t(null,void 0,i(636549)),v=n.t(null,void 0,i(247734));let m=null;function g(e){"LineToolTweet"===e?(window.is_authenticated||(0,h.resetToCursor)(!0),(0,a.runOrSigninWithFeature)((()=>{h.tool.setValue("LineToolTweet"),m=(0,d.showCustomUrlEventDialog)({onConfirm:f,onClose:()=>{m=null,"LineToolTweet"===h.tool.value()&&(0,h.resetToCursor)(!0)},
title:P,placeholderText:v}),(0,s.trackEvent)("Tweet","Open tweet dialog")}),{feature:"drawings",source:"Change drawing tool state"})):null!==m&&m.then((e=>e()))}function f(e){const t=(0,u.chartWidgetCollectionService)();if(null===t)return;if(!(0,p.isTwitterUrl)(e))return void _.logWarn(`Invalid tweet url: ${e}`);const i=!Boolean(o.getBool("hint.pasteTweet")),r=t.activeChartWidget.value();(0,p.createTweetLineToolByUrl)(e,r.model()).then((()=>{i&&(0,c.showPasteLineToolHint)(t.getContainer(),"hint.pasteTweet")}))}var y=i(658843),T=i(417667);class C extends T.CustomEventItem{constructor(e,t){super(t),this._data=e}tweetData(){return this._data}index(){return this._source.eventTimePointIndex()}time(){return this._data.createdAt}avatar(){return this._data.profileImageUrl}}class x extends T.LineToolCustomUrlEvent{constructor(e,t,r,n){super(e,t||x.createProperties(),r,n),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,589618)).then((t=>{this._setPaneViews([new t.TweetPaneView(this,e)])}))}name(){return"Tweet"}state(e){const t=super.state(e);return this._item&&(t.tweetData=this._item.tweetData()),e&&(t.eventTimePointIndex=this._eventTimePointIndex),t}restoreData(e){if(e.tweetData){if(!(0,p.isTwitterUrl)(e.tweetData.tweetUrl))throw new Error(`Invalid url for tweet line tool: ${e.tweetData.tweetUrl}`);this._item=new C(e.tweetData,this)}void 0!==e.eventTimePointIndex&&(this._eventTimePointIndex=e.eventTimePointIndex)}static createProperties(e){const t=new r.DefaultProperty({defaultName:"linetoolTweet",state:e});return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,664149)).then((e=>e.TweetDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("position")||e.addChild("position",new y.Property(50)),e.addExcludedKey("position",1)}}(0,h.runOnDrawingStateReady)((()=>{h.tool.subscribe(g)}))},285607:(e,t,i)=>{i.d(t,{LineToolVertLineTimeAxisView:()=>n});var r=i(735815);class n extends r.LineDataSourceTimeAxisView{constructor(e){super(e,0)}_getBgColor(){return this._source.properties().linecolor.value()}_getAlwaysInViewPort(){return!1}_getIndex(){const e=this._source.points();return 0===e.length?null:e[0].index}}},243009:(e,t,i)=>{i.d(t,{LineToolVertLine:()=>c});var r=i(650151),n=i(86441),o=i(262624),s=i(658843),l=i(89282),a=i(285607);class c extends l.InplaceTextLineDataSource{constructor(e,t,r,n){const o=t||c.createProperties();super(e,o,r,n),this._verticalLinePaneViews=new WeakMap,this._timeAxisView=new a.LineToolVertLineTimeAxisView(this),this._paneViewFactory=null,this.properties().childs().extendLine.subscribe(this,(()=>e.lightUpdate())),Promise.all([i.e(16969),i.e(22164),i.e(87393),i.e(52017),i.e(77916),i.e(90108),i.e(92384),i.e(19063),i.e(51583)]).then(i.bind(i,361907)).then((t=>{
this._paneViewFactory=i=>new t.VertLinePaneView(this,e,i,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),this.onSelectionChange.bind(this)),this._model.lightUpdate()})),this.setAdditionalCursorData(this._additionalCursorData.bind(this),this._positionToCoordinate.bind(this))}destroy(){this.properties().childs().extendLine.unsubscribeAll(this),super.destroy()}pointsCount(){return 1}name(){return"Vertical Line"}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._timeAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}isMultiPaneAvailable(){return!0}isMultiPaneEnabled(){return this.properties().childs().extendLine.value()}paneViews(e){if(e=(0,r.ensureDefined)(e),!this.isMultiPaneEnabled()&&this._model.paneForSource(this)!==e)return null;if(null===this._getPaneViews(e)&&null!==this._paneViewFactory){const t=this._paneViewFactory(e);this._verticalLinePaneViews.set(e,t),this._setPaneViews([t],e,!0)}return super.paneViews(e)}priceAxisViews(){return null}priceAxisPoints(){return[]}pointToScreenPoint(e){const t=this._model.timeScale();if(t.isEmpty())return null;const i=t.indexToCoordinate(e.index);return new n.Point(i,0)}convertYCoordinateToPriceForMoving(e){return 0}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textcolor,textVisible:e.showLabel}}static createProperties(e){null!=e&&(void 0===e.textOrientation&&(e.textOrientation="horizontal"),void 0===e.extendLine&&(e.extendLine=!1));const t=new o.DefaultProperty({defaultName:"linetoolvertline",state:e});return this._configureProperties(t),t}_normalizePoint(e,t){var i;return null!==(i=super._normalizePointWithoutOffset(e))&&void 0!==i?i:super._normalizePoint(e,t)}_getAlertPlots(){const e=this._points[0],t={index:e.index,price:e.price+1},i=this._linePointsToAlertPlot([e,t],null,!0,!0);return null===i?[]:[i]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(45642),i.e(24379),i.e(96501),i.e(83912),i.e(18537)]).then(i.bind(i,308898)).then((e=>e.VerticalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new s.Property("")),e.addExcludedKey("text",1)}_additionalCursorData(){return(0,r.ensureDefined)(this._verticalLinePaneViews.get((0,r.ensureNotNull)(this._model.paneForSource(this)))).additionalCursorData()}_positionToCoordinate(e){return(0,r.ensureDefined)(this._verticalLinePaneViews.get((0,r.ensureNotNull)(this._model.paneForSource(this)))).positionToCoordinate(e)}}},758697:(e,t,i)=>{i.d(t,{getNumericFormatter:()=>u,getPercentageFormatter:()=>h,getPipFormatter:()=>_,getVolumeFormatter:()=>d});var r=i(397566),n=i(142567),o=i(788387),s=i(735211);class l extends s.PriceFormatter{constructor(e){
const{priceScale:t,minMove:i=1,type:r,typespecs:n,minMove2:s,ignoreLocaleNumberFormat:l}=e;("forex"===r||(0,o.isCFDSymbol)(r,n))&&s?(super({priceScale:s,ignoreLocaleNumberFormat:l}),this._isForex=!0):(super({priceScale:1,ignoreLocaleNumberFormat:l}),this._isForex=!1),this._pipPriceScale=t,this._pipMinMove=i,this._pipMinMove2=s}format(e,t={}){const{signPositive:i,tailSize:r,ignoreLocaleNumberFormat:n}=t;let o=this._isForex?this._pipMinMove2:this._pipMinMove;return void 0===o&&(o=NaN),super.format(e*this._pipPriceScale/o,{signPositive:i,tailSize:r,ignoreLocaleNumberFormat:n})}}var a=i(957365),c=i(574313);const u=(0,c.numDependencyFormatter)((e=>new r.NumericFormatter({precision:e}))),h=(0,c.numDependencyFormatter)((e=>new n.PercentageFormatter({priceScale:Math.pow(10,null!=e?e:2),minMove:1}))),d=(0,c.numDependencyFormatter)((e=>new a.VolumeFormatter({precision:e}))),p=new WeakMap;function _(e){let t=p.get(e);return t||(t=new l({priceScale:e.pricescale,minMove:e.minmov,minMove2:e.minmove2,type:e.type,typespecs:e.typespecs}),p.set(e,t)),t}},286436:(e,t,i)=>{i.d(t,{coordinateIsValid:()=>v,extendAndClipLineSegment:()=>u,fillScaledRadius:()=>g,getArrowPoints:()=>h,interactionTolerance:()=>P,optimalBarWidth:()=>d,optimalCandlestickWidth:()=>p,optimalHiLoWidth:()=>_,setValidLineStyle:()=>m,strokeScaledRadius:()=>f});var r=i(86441),n=i(5531),o=i(937713),s=i(124829),l=i(665798);const a={common:13,line:13,minDistanceBetweenPoints:10,series:14,curve:10,anchor:13,esd:4},c={common:3,line:3,minDistanceBetweenPoints:5,series:2,curve:3,anchor:2,esd:0};function u(e,t,i,o,s,l){if((0,r.equalPoints)(e,t))return null;const a=new r.Point(0,0),c=new r.Point(i,o);if(s){if(l){const i=(0,n.intersectLineAndBox)((0,r.lineThroughPoints)(e,t),(0,r.box)(a,c));return Array.isArray(i)?i:null}{const i=(0,n.intersectRayAndBox)(t,e,(0,r.box)(a,c));return null===i||(0,r.equalPoints)(t,i)?null:(0,r.lineSegment)(t,i)}}if(l){const i=(0,n.intersectRayAndBox)(e,t,(0,r.box)(a,c));return null===i||(0,r.equalPoints)(e,i)?null:(0,r.lineSegment)(e,i)}{const i=(0,n.intersectLineSegmentAndBox)((0,r.lineSegment)(e,t),(0,r.box)(a,c));return Array.isArray(i)?i:null}}function h(e,t,i,r,n){const o=.5*i,s=Math.sqrt(2),l=t.subtract(e),a=l.normalized();let c=5*i;r&&(c=Math.min(c,.35*l.length()));const u=1*o;if(c*s*.2<=u)return[];const h=a.scaled(c),d=t.subtract(h),p=a.transposed(),_=1*c,P=p.scaled(_),v=d.add(P),m=d.subtract(P),g=v.subtract(t).normalized().scaled(u),f=m.subtract(t).normalized().scaled(u),y=n?t:t.add(g),T=n?t:t.add(f),C=o*(s-1),x=p.scaled(C),w=Math.min(c-1*o/s,o*s*1),b=a.scaled(w),S=t.subtract(x),L=t.add(x),V=t.subtract(b);return[[v,y],[T,m],[S,V.subtract(x)],[L,V.add(x)]]}function d(e,t){return t=t||1,Math.floor(.3*e*t)}function p(e,t){if(e>=2.5&&e<=4)return Math.floor(3*t);const i=1-.2*Math.atan(Math.max(4,e)-4)/(.5*Math.PI),r=Math.floor(e*i*t),n=Math.floor(e*t),o=Math.min(r,n);return Math.max(Math.floor(t),o)}function _(e){return.4*e}function P(){return(0,o.lastMouseOrTouchEventInfo)().isTouch?a:c}function v(e){return null!=e&&!(0,s.isNaN)(e)}
function m(e,t){void 0!==t&&(0,l.setLineStyle)(e,t)}function g(e,t){const i=Math.max(1,Math.floor(t))%2?.5:0;return Math.round(e*t)+i}function f(e,t,i){const r=Math.max(1,Math.floor(t))%2?.5:0;return Math.round(e*t)+(r!==i%2?.5:0)}},343272:(e,t,i)=>{i.d(t,{sortSources:()=>n,sortSourcesPreOrdered:()=>r});const r={KeyFactsToday:10000001,LatestUpdates:10000002,BarMarks:10000003,TimeScaleMarks:10000004,ChartEventsSource:10000005,Dividends:10000006,Splits:10000007,Earnings:10000008,RollDates:10000009,FutureContractExpiration:10000010,LineToolOrder:10000011,LineToolPosition:10000012,LineToolExecution:10000013,AlertLabelInactive:10000014,AlertLabel:10000015};function n(e,t){if(0===e.length)return[];if(!t)return[...e].sort(((e,t)=>e.zorder()-t.zorder()));if(!(t.model().mainPane()===t))return[...e].sort(((e,t)=>e.zorder()-t.zorder()));const i=t.model().panes(),r=i.indexOf(t),n=e=>i.findIndex((t=>t.hasDataSource(e)));return e.map((e=>{const i=!t.hasDataSource(e);return{source:e,isMultipane:i,aboveSeries:e.zorder()>t.model().mainSeries().zorder(),paneIndex:i?n(e):r}})).sort(((e,t)=>e.isMultipane||t.isMultipane?e.isMultipane&&!t.isMultipane?t.aboveSeries?-1:1:!e.isMultipane&&t.isMultipane?e.aboveSeries?1:-1:e.paneIndex-t.paneIndex:e.source.zorder()-t.source.zorder())).map((e=>e.source))}},968720:(e,t,i)=>{i.d(t,{PriceAxisViewRenderer:()=>d,hittestByData:()=>h});var r=i(86441),n=i(934026),o=i(937713),s=i(881025),l=i(631088),a=i(509078),c=i(665798);const u=new Path2D("M4.09.93c.4.16.75.4 1.02.73a5.47 5.47 0 0 0-3.78 3.27A2.5 2.5 0 0 1 3.2.77c.31 0 .61.06.89.16Zm8.24 3.35a2.5 2.5 0 0 0-3.27-3.23c-.38.16-.7.4-.97.7a5.47 5.47 0 0 1 3.56 3.5c.3-.26.53-.6.68-.97Zm-3.15-.84a4.5 4.5 0 1 0-5.5 7.12 4.5 4.5 0 0 0 5.5-7.12ZM6 4h1v4H4V7h2V4Z");function h(e,t){var i;const s=(0,o.lastMouseOrTouchEventInfo)().isTouch?10:0,l=e.hitTestData;if(void 0===l||!e.visible)return null;const{itemBox:c,clickHandler:u,tooltip:h}=l;if(c){const o=(0,r.box)(new r.Point(c.min.x-s,c.min.y-s),new r.Point(c.max.x+s,c.max.y+s));if((0,n.pointInBox)(t,o))return new a.HitTestResult(null!==(i=e.hitTarget)&&void 0!==i?i:a.HitTarget.Custom,{clickHandler:null==u?void 0:u.bind(null,t),tapHandler:null==u?void 0:u.bind(null,t),hoverModelFromAxis:l.hoverModelFromAxis,activeItem:l.activeItem,tooltip:h})}return null}class d{constructor(e,t){this._bodyBox=null,this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}lastDrawnBodyBox(){return this._bodyBox}draw(e,t,i,n,o){var a,u,h,d;const p=this._data,{mediaSize:_,bitmapSize:P,horizontalPixelRatio:v,verticalPixelRatio:m}=t;if(!p.visible||this._isOutOfScreen(i,_.height))return;const g=this._commonData,f=void 0!==p.labelIcon,y=i.paddingTop+g.additionalPaddingTop,T=i.paddingBottom+g.additionalPaddingBottom,{paddingOuter:C,paddingInner:x,fontSize:w,borderSize:b}=i,S=p.ignoreAdditionalPaddingInner?0:i.additionalPaddingInner;let L=p.text,V=p.textColor||g.textColor,D=p.secondLine||"",B=g.secondLineTextColor||V,A=p.thirdLine||"";const M=g.thirdLineTextColor||V;0===D.length&&(D=A,B=M,A=""),0===L.length&&(L=D,V=B,D=A,B=M,A=""),
e.save(),void 0!==g.globalAlpha&&(e.globalAlpha*=g.globalAlpha),e.font=i.font;const I=n.yMidCorrection(e,L)*m,N=w+y+T,k=(null!==(a=p.labelIconMinWidth)&&void 0!==a?a:0)*v,F=Boolean(D),E=Boolean(A),R=x+C+S,W=[Math.ceil(n.measureText(e,L)),F?Math.ceil(n.measureText(e,D)):0,E?Math.ceil(n.measureText(e,A)):0],z=Math.max(1,Math.floor(m));let O=Math.round(N*m);O%2!=z%2&&(O+=1);const H=Math.round((w+i.lineSpacing)*m),K=Math.round(2*(w+i.lineSpacing)*m),U=Math.max(1,Math.floor(b*v)),q=p.separatorVisible?U:0,j=p.borderVisible?U:0,G=f?Math.max(O,k):Math.round((Math.max(...W)+R)*v),Q=Math.round(S*v),$=P.width,Y=Math.ceil(x*v),Z=Math.round((null!==(u=g.fixedCoordinate)&&void 0!==u?u:g.coordinate)*m)-Math.floor(.5*m),X=Math.floor(Z+z/2-O/2),J=X+O,ee="right"===o,te=void 0!==p.xCoord?Math.round(p.xCoord*v)+(ee?1:-1)*Math.round(G/2):ee?$-q:q;let ie,re=te;const ne=null!==(h=p.backgroung)&&void 0!==h?h:g.background;e.fillStyle=ne;const oe=2*m;if(e.textAlign=ee?"right":"left",e.textBaseline="middle",ee?(re=te-G,ie=te-Q-Y+q):(re=te+G,ie=te+Q+Y-q),this._bodyBox=null,L||f){const i=E?O+K:F?O+H:O,n=null!==(d=g.borderColor)&&void 0!==d?d:ne,o=void 0!==p.xCoord?oe:0;if(((t,n,s)=>{if(ee){(0,c.drawRoundRectWithInnerBorder)(e,re,X,G,i,t,p.overridenRadius?(0,c.scaleDrawRoundRectRadii)(p.overridenRadius,m):[oe,o,o,oe],j,n,s);const l=(0,r.point)(re/v,X/m),a=l.add((0,r.point)(G/v,i/m));this._bodyBox=(0,r.box)(l,a)}else{(0,c.drawRoundRectWithInnerBorder)(e,te,X,G,i,t,p.overridenRadius?(0,c.scaleDrawRoundRectRadii)(p.overridenRadius,m):[o,oe,oe,o],j,n,s);const l=(0,r.point)(te/v,X/m),a=l.add((0,r.point)(G/v,i/m));this._bodyBox=(0,r.box)(l,a)}})(ne,n,g.borderStyle),f){switch(p.labelIcon){case 0:this._drawPlusIcon(e,te,re,X,Z,J,z);break;case 1:this._drawClockExistingAlertIcon(e,te,re,t,X,i)}return void e.restore()}e.save(),e.translate(ie,(X+J)/2+I),(0,l.drawScaled)(e,v,m,(()=>{e.fillStyle=V,e.fillText(L,0,0)})),e.restore()}F&&(e.fillStyle=B,e.save(),e.translate(ie,(X+J)/2+I+H),(0,l.drawScaled)(e,v,m,(()=>{e.fillText((0,s.startWithLTR)(D),0,0)})),e.restore()),E&&(e.fillStyle=M,e.save(),e.translate(ie,(X+J)/2+I+K),(0,l.drawScaled)(e,v,m,(()=>{e.fillText((0,s.startWithLTR)(A),0,0)})),e.restore()),e.restore()}topBottomTotalHeight(e){const t=this._lines();if(!this._data.visible||0===t)return{top:0,bottom:0,total:0};const i=e.fontSize/2+e.paddingTop+this._commonData.additionalPaddingTop,r=(t-.5)*e.fontSize+(t-1)*e.lineSpacing+e.paddingBottom+this._commonData.additionalPaddingBottom;return{top:i,bottom:r,total:i+r}}hitTest(e){return h(this._data,e)}_drawPlusIcon(e,t,i,r,n,o,s){e.fillStyle=this._commonData.textColor,e.strokeStyle=this._commonData.textColor,e.lineWidth=s;const l=Math.abs(t-i);let a=Math.round(.35*l);a%2!=s%2&&(a+=1);let c=Math.round(.65*l);c%2!=s%2&&(c+=1);const u=Math.floor((l-a)/2),h=Math.min(t,i),d=h+Math.floor(l/2-s/2);e.fillRect(h+u,n,a,s),e.fillRect(d,r+u,s,a),e.beginPath(),e.arc(d+s/2,n+s/2,c/2,0,2*Math.PI,!1),e.stroke()}_drawClockExistingAlertIcon(e,t,i,r,n,o){e.fillStyle=this._commonData.textColor
;const s=Math.abs(t-i),l=Math.min(t,i),{horizontalPixelRatio:a,verticalPixelRatio:c}=r,h=s/(23*a),d=s/(23*c),p=12*a*h,_=10.73*c*d,P=Math.floor((s-p)/2),v=Math.floor((o-_)/2)-1;e.save(),e.translate(l+P,n+v),e.scale(a*h,c*d),e.fill(u),e.restore()}_lines(){const e=this._data;return(e.text?1:0)+(e.secondLine?1:0)+(e.thirdLine?1:0)}_isOutOfScreen(e,t){var i;const r=this._commonData,n=null!==(i=r.fixedCoordinate)&&void 0!==i?i:r.coordinate,{total:o}=this.topBottomTotalHeight(e),s=o/this._lines();return n-s/2-3>t||n+(o-s/2)+3<0}}},704670:(e,t,i)=>{i.d(t,{PriceRange:()=>o,mergePriceRanges:()=>s});var r=i(124829);const n=(0,i(338619).getLogger)("Chart.PriceRange");class o{constructor(e,t){if(null!==e&&"object"==typeof e){const t=e;this._minValue=t.m_minValue,this._maxValue=t.m_maxValue}else{const i=e;this._minValue=i,void 0!==t&&(this._maxValue=t)}}equals(e){return this._minValue===e._minValue&&this._maxValue===e._maxValue}clone(){return new o(this._minValue,this._maxValue)}minValue(){return this._minValue}setMinValue(e){this._minValue=e}maxValue(){return this._maxValue}setMaxValue(e){this._maxValue=e}length(){return this._maxValue-this._minValue}isEmpty(){return this._maxValue===this._minValue||this._maxValue!=this._maxValue||this._minValue!=this._minValue}serialize(){return{m_maxValue:this._maxValue,m_minValue:this._minValue}}state(){return{max:this._maxValue,min:this._minValue}}merge(e){return new o(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))}apply(e,t){this._minValue=Math.min(this._minValue,e),this._maxValue=Math.max(this._maxValue,t)}set(e,t){this._minValue=e,this._maxValue=t}scaleAroundCenter(e){if(!(0,r.isNumber)(e))return void n.logDebug("PriceRange.scaleAroundCenter: invalid coeff");if(0===this._maxValue-this._minValue)return;const t=.5*(this._maxValue+this._minValue);let i=this._maxValue-t,o=this._minValue-t;i*=e,o*=e,this._maxValue=t+i,this._minValue=t+o}shift(e){(0,r.isNumber)(e)?(this._maxValue+=e,this._minValue+=e):n.logDebug("PriceRange.shift: invalid coeff")}containsStrictly(e){return e.minValue()>this._minValue&&e.maxValue()<this._maxValue}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}function s(e){return e.reduce(((e,t)=>e?t?e.merge(t):e:t),null)}},714512:(e,t,i)=>{i.d(t,{factoryDefaultsForCurrentTheme:()=>a});var r=i(998034),n=i(154834),o=i(650151),s=i(331633),l=i(61499);function a(e,t){var i;const a=null!==(i=s.watchedTheme.value())&&void 0!==i?i:l.StdTheme.Light,c=(0,n.default)(e);return(0,r.default)(c,(0,o.ensureDefined)(t.get(a))),c}},134392:(e,t,i)=>{i.d(t,{barSpacingByScaleRatio:()=>s,priceRangeByScaleRatio:()=>o,scaleRatio:()=>n});var r=i(704670);function n(e,t){if(t.isLog()||e.isEmpty()||t.isEmpty())return null;const i=function(e){if(e.isEmpty())return null;const t=e.priceRange();if(null===t)return null;const i=t.length();return e.internalHeight()/i}(t);if(null===i)return null;return e.getValidBarSpacing()/Math.max(1e-10,i)}function o(e,t,i){if(e.isLog()||null===i||e.isEmpty())return null;const n=e.priceRange()
;if(null===n||n.isEmpty())return null;const o=e.internalHeight()/(t/i),s=n.length();if(o===s)return n;const l=(o-s)/2;return new r.PriceRange(n.minValue()-l,n.maxValue()+l)}function s(e,t){if(e.isLog()||null===t||e.isEmpty())return null;const i=e.priceRange();if(null===i)return null;const r=i.length();return e.internalHeight()/r*t}},259638:(e,t,i)=>{i.d(t,{SeriesTimeRangeVolumeCalculator:()=>r});class r{constructor(e){this._value=null,this._series=e,this._series.dataEvents().dataUpdated().subscribe(this,this._onSeriesUpdated)}destroy(){this._series.dataEvents().dataUpdated().unsubscribeAll(this)}volume(e,t){if(null!==this._value&&this._value.from===e&&this._value.to===t)return this._value.value;let i=0;const r=this._series.data().bars(),n=r.firstIndex(),o=r.lastIndex();if(null!==n&&e<n&&t<n||null!==o&&e>o&&t>o)i=NaN;else{const r=this._series.data().bars().rangeIterator(Math.min(e,t),Math.max(e,t));for(const e of r){const t=e.value[5];if(void 0===t){i=NaN;break}i+=t}}return this._value={from:e,to:t,value:i},i}_onSeriesUpdated(e,t){if(null===this._value)return;if(t)return void(this._value=null);const i=this._series.data().bars().lastIndex();(null===i||i<=this._value.to)&&(this._value=null)}}},218049:(e,t,i)=>{i.d(t,{ChartColorDependentStudyInputNames:()=>d,InputDisplayFlags:()=>r,RangeDependentStudyInputNames:()=>h,areStudyInputsEqual:()=>u,editableStudyInputs:()=>P,getInputValue:()=>l,isExtendedInput:()=>o,isExtendedInputSource:()=>s,isStudyInputDependsOnChart:()=>m,isStudyInputDependsOnChartColors:()=>v,isStudyInputOptionsInfo:()=>c,isTimeOrPriceNotHiddenInput:()=>_,rangeDependentStudyInputsToTimeRange:()=>p,studyAvailableConstSources:()=>a});var r,n=i(182433);function o(e){return(0,n.default)(e)}function s(e){return"source"===e.t}function l(e){return o(e)?e.v:e}!function(e){e[e.None=0]="None",e[e.DataWindow=2]="DataWindow",e[e.StatusLine=8]="StatusLine",e[e.All=15]="All"}(r||(r={}));const a=["open","high","low","close","hl2","hlc3","ohlc4","hlcc4"];function c(e){return["text","integer","float","price","session","resolution"].includes(e.type)&&e.hasOwnProperty("options")}function u(e,t,i){for(const r of e)if(t[r.id]!==i[r.id])return!1;return!0}var h,d;function p(e){return{from:Math.round(e.first_visible_bar_time/1e3),to:Math.round(e.last_visible_bar_time/1e3)}}function _(e){return("time"===e.type||"price"===e.type)&&!0!==e.isHidden}function P(e){const t=e.filter(_);if(0===t.length)return[];const i=new Map,r=[];t.forEach((e=>{var t;const{group:n,inline:o}=e;if(void 0===o)return void r.push(e);const s=o+(n||"");if(i.has(s))null===(t=i.get(s))||void 0===t||t.push(e);else{const t=[e];i.set(s,t),r.push(t)}}));const n=[];for(let e=0;e<r.length;e++){const t=r[e];Array.isArray(t)?2===t.length&&t[0].type!==t[1].type?n.push(t):n.push(...t):n.push(t)}return n}function v(e){return Object.values(d).map((e=>e)).includes(e.id)}function m(e){return!!v(e)||Object.values(h).map((e=>e)).includes(e.id)}!function(e){e.FirstBar="first_visible_bar_time",e.LastBar="last_visible_bar_time",e.Realtime="subscribeRealtime"}(h||(h={})),
function(e){e.FgColor="__chart_fgcolor",e.BgColor="__chart_bgcolor"}(d||(d={}))},669763:(e,t,i)=>{i.d(t,{UndoCommand:()=>n});var r=i(370407);class n{constructor(e,t=!0,i=!0){this._text=e||new r.TranslatedString("",""),this._executeOnPush=t,this._affectsState=i}text(){return this._text}executeOnPush(){return this._executeOnPush}affectsState(){return this._affectsState}canMerge(e){return!1}merge(e){throw new Error("Should be re-implemented in child classes")}}},383851:(e,t,i)=>{i.d(t,{getAlertsFiresFocusHandler:()=>r});const r=(0,i(412235).default)((async()=>{const{AlertsFiresFocusHandler:e}=await i.e(69581).then(i.bind(i,14048));return new e}))},653801:(e,t,i)=>{i.d(t,{getChartSourceIdsGetter:()=>r});const r=(0,i(412235).default)((async()=>{const{ChartSourceIdsGetter:e}=await Promise.all([i.e(35706),i.e(50030),i.e(35907),i.e(44572),i.e(1867),i.e(86561),i.e(79979)]).then(i.bind(i,742240));return new e}))},694852:(e,t,i)=>{function r(e,t,i,r){return`${r?r+" ":""}${i?i+" ":""}${e}px ${t}`}i.d(t,{makeFont:()=>r,parseFont:()=>o});const n=/(bold )?(italic )?(\d+)(px|pt) (.*)$/;function o(e){const t=n.exec(e);return null===t?null:{family:t[5],size:parseInt(t[3])*("pt"===t[4]?.75:1),bold:Boolean(t[1]),italic:Boolean(t[2])}}},708050:(e,t,i)=>{async function r(e){(await Promise.all([i.e(37570),i.e(55570),i.e(75816),i.e(46445),i.e(22164),i.e(65857),i.e(36010),i.e(33253),i.e(491),i.e(88778),i.e(34693),i.e(43311),i.e(35955),i.e(20431),i.e(82321),i.e(24229),i.e(29147),i.e(45113),i.e(94913)]).then(i.bind(i,358507))).renderRunOrSigninWithFeatureDialog(e)}i.d(t,{createRunOrSigniWithFeatureDialog:()=>r})},469959:(e,t,i)=>{i.d(t,{paidAccountCheck:()=>s});var r=i(49437),n=i(638456);const o=(0,i(338619).getLogger)("PaidAccountCheck");async function s(e){const{onlyCheck:t,successButtonText:s,isNeedCancelButton:l}=e,a=window.user,c=r.TVLocalStorage.getItem("previous_username");if(a&&window.is_authenticated&&!a.is_pro&&c&&!(0,n.isSymphonyEmbed)()){const{getProfile:e}=await Promise.all([i.e(35256),i.e(90254)]).then(i.bind(i,219173));try{const r=await e(c);if(Boolean(r.pro_plan)){if(t)return c;{const{showWrongAccountDialog:e}=await Promise.all([i.e(18607),i.e(15190),i.e(12019)]).then(i.bind(i,277019));return e({userName:c,isNeedCancelButton:l,successButtonText:s})}}}catch(e){o.logError(e.message)}}return!1}},387964:(e,t,i)=>{function r(e){let t;if("object"!=typeof e||null==e||"number"==typeof e.nodeType)t=e;else if(e instanceof Date)t=new Date(e.valueOf());else if(Array.isArray(e)){t=[];let i=0;const n=e.length;for(;i<n;i++)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=r(e[i]))}else{t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=r(e[i]))}return t}i.d(t,{deepCopy:()=>r})},524561:(e,t,i)=>{i.d(t,{getTwemojiUrl:()=>n,twemoji:()=>r.default});var r=i(818438);function n(e,t){let i="";return r.default.parse(e,(e=>(i=r.default.base+("svg"===t?`svg/${e}.svg`:`72x72/${e}.png`),!1))),i}r.default.base="https://cdnjs.cloudflare.com/ajax/libs/twemoji/13.0.1/"}}]);